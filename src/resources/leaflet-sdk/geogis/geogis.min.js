/*!
 * 
 *          Copyright© 1999 - 2020 Geoway Software Co.Ltd
 *          license: 
 *          version: v1.0.0
 *         
 */!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=37)}([function(t,e){t.exports=L},function(t,e,i){"use strict";var n=i(0),r=i.n(n);i(20);r.a.geoway=r.a.geoway||{},r.a.geoway.control=r.a.geoway.control||{},r.a.geoway.format=r.a.geoway.format||{},r.a.geoway.service=r.a.geoway.service||{},r.a.Map.mergeOptions({crs:r.a.CRS.EPSG4326,attributionControl:!1,minZoom:1}),r.a.Map.include({getScales:function(){return this.options.scales?this.options.scales:this.defaultScales()},defaultScales:function(){return[591658710.9091312,295829355.4545656,147914677.7272828,73957338.8636414,36978669.4318207,18489334.71591035,9244667.357955175,4622333.678977588,2311166.839488794,1155583.419744397,577791.7098721985,288895.85493609926,144447.92746804963,72223.96373402482,36111.98186701241,18055.990933506204,9027.995466753102,4513.997733376551,2256.998866688275,1128.4994333441375,564.2497166720685]}})},function(t,e,i){"use strict";i.d(e,"a",function(){return r}),i.d(e,"c",function(){return a}),i.d(e,"d",function(){return h}),i.d(e,"b",function(){return s});var n=i(43),r=function(){this.promise=new Promise(function(t,e){this.resolve=t,this.reject=e}.bind(this)),this.then=this.promise.then.bind(this.promise),this.catch=this.promise.catch.bind(this.promise)},a=function(t){return t.type||(t.type="GET"),t.dataType||(t.dataType="json"),new Promise(function(e,i){o(e,i,t)})},s=function(t){var e;t.type||(t.type="GET"),t.dataType||(t.dataType="arraybuffer");var i=new Promise(function(i,n){e=o(i,n,t,!0)});return i.xhr=e,i},o=function(t,e,i,r){var a,s=i.type.toUpperCase();"GET"==s&&(a=n.get(i.url)),"POST"==s&&(a=n.post(i.url,i.data)),"arraybuffer"==i.dataType&&(a=n.get(i.url,!0));var o=!1,h=setTimeout(function(){(a.request.status>=300||a.request.status<200)&&(o=!0,a.request.abort(),console.warn("timeout: "+i.url),e({param:i,data:"getParamJSON: "+i.url+" timeout "}))},3e4);return a.success(function(e){o?clearTimeout(h):("json"==i.dataType&&"string"==typeof e&&(e=JSON.parse(e)),t(r?{param:i,data:e}:e))}),a.error(function(t,n){o?clearTimeout(h):e({param:i,data:"getParamJSON: "+i.url+" failed with status: "+n.status})}),a.request},h=function(t){var e;t.type||(t.type="GET"),t.dataType||(t.dataType="json");var i=new Promise(function(i,n){e=o(i,n,t,!0)});return i.xhr=e,i}},function(t,e,i){"use strict";i(39),i(42);var n=i(33),r=i.n(n),a=i(0),s=i.n(a);i(1);function o(t){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t});var h="object"===("undefined"==typeof window?"undefined":o(window))&&window.fetch||r.a,l={request:function(t,e,i,n){var r={method:t.toUpperCase(),credentials:"same-origin",strictErrors:!1};Object.assign(r,n);var a="GET"===r.method,s={Accept:"application/json"};!a&&i&&(s["Content-Type"]="application/json"),r.headers=Object.assign(s,n&&n.headers);var o=a&&i&&Object.keys(i);o&&o.length&&(e=e+(-1!=e.indexOf("?")?"&":"?")+o.map(function(t){return t+"="+encodeURIComponent(i[t])}).join("&")),!a&&i&&(r.body=JSON.stringify(i));var u=e.replace(/[?].*/,""),c=u.replace(/.*:[/][/]/,"").replace(/[:/].*/,"");return l.logger&&l.logger((new Date).toISOString(),"request",r.method,c,u),h(e,r).then(function(t){var e=t.headers.get("content-type"),i=/json|javascript/.test(e);if(l.logger&&l.logger((new Date).toISOString(),"response",r.method,c,u,t.ok,t.status,t.statusText,e),r.strictErrors&&!t.ok)throw Error('HTTP response status ("strictErrors" mode enabled): '+t.status);return i?t.json():t.text().then(function(i){return t.error=!t.ok,t.contentType=e,t.bodyText=i,t})})},get:function(t,e,i){return l.request("GET",t,e,i)},post:function(t,e,i){return l.request("POST",t,e,i)},put:function(t,e,i){return l.request("PUT",t,e,i)},patch:function(t,e,i){return l.request("PATCH",t,e,i)},delete:function(t,e,i){return l.request("DELETE",t,e,i)},logger:null,getLogHeaders:function(){return["Timestamp","HTTP","Method","Domain","URL","Ok","Status","Text","Type"]},getLogHeaderIndex:function(){return{timestamp:0,http:1,method:2,domain:3,url:4,ok:5,status:6,text:7,type:8}},enableLogger:function(t){var e="function"==typeof t;return l.logger=e?t:!1===t?null:console.log,l.logger}},u={get:function(t,e,i){return l.get(t,e,i)},post:function(t,e,i){return l.post(t,e,i)},put:function(t,e,i){return l.put(t,e,i)},delete:function(t,e,i){return l.delete(t,e,i)}};e.a=u,s.a.geoway.Request=u},function(t,e,i){"use strict";i.d(e,"a",function(){return d}),i.d(e,"p",function(){return M}),i.d(e,"n",function(){return E}),i.d(e,"e",function(){return B}),i.d(e,"k",function(){return G}),i.d(e,"b",function(){return V}),i.d(e,"h",function(){return Z}),i.d(e,"c",function(){return Lt}),i.d(e,"i",function(){return xt}),i.d(e,"l",function(){return St}),i.d(e,"g",function(){return Tt}),i.d(e,"j",function(){return tt}),i.d(e,"d",function(){return At}),i.d(e,"f",function(){return Ot}),i.d(e,"q",function(){return a}),i.d(e,"m",function(){return h}),i.d(e,"o",function(){return u});var n=i(0),r=i.n(n),a=(i(1),r.a.TileLayer.extend({defaultWmtsParams:{service:"WMTS",request:"GetTile",version:"1.0.0",layer:"",style:"",tilematrixSet:"",format:"image/jpeg"},initialize:function(t,e){this._url=t;var i=r.a.extend({},this.defaultWmtsParams),n=e.tileSize||this.options.tileSize;for(var a in e.rowSign=e.rowSign||"tl",e.detectRetina&&r.a.Browser.retina?i.width=i.height=2*n:i.width=i.height=n,e)this.options.hasOwnProperty(a)||"matrixIds"==a||(i[a]=e[a]);this.wmtsParams=i,this.matrixIds=e.matrixIds||this.getDefaultMatrix(),r.a.setOptions(this,e)},onAdd:function(t){r.a.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=e.options.crs,n=this.options.tileSize,a=t.multiplyBy(n);a.x+=1,a.y-=1;var s=a.add(new r.a.Point(n,n)),o=i.project(e.unproject(a)),h=i.project(e.unproject(s)).x-o.x,l=this._getZoomForUrl()-this.getZoomOffset(),u=e.getScales()[l],c=this.getMatrixIdByScale(u);c||(c=this.getMatrixIdByDefaultScale(u));var f,p=c.identifier,d=c.topLeftCorner.lng,g=c.topLeftCorner.lat,y=Math.round((o.x-d)/h);f="tl"==this.options.rowSign?-Math.round((o.y-g)/h):-Math.round((g-o.y)/h)-1;var v=r.a.Util.template(this._url,{s:this._getSubdomain(t)});return v+r.a.Util.getParamString(this.wmtsParams,v)+"&tilematrix="+p+"&tilerow="+f+"&tilecol="+y},getTileXY:function(t){var e=this._map,i=e.options.crs,n=this.options.tileSize,a=t.multiplyBy(n);a.x+=1,a.y-=1;var s=a.add(new r.a.Point(n,n)),o=i.project(e.unproject(a)),h=i.project(e.unproject(s)).x-o.x,l=this._getZoomForUrl()-this.getZoomOffset(),u=e.getScales()[l],c=this.getMatrixIdByScale(u);c||(c=this.getMatrixIdByDefaultScale(u));var f=c.topLeftCorner.lng,p=c.topLeftCorner.lat;return{col:Math.round((o.x-f)/h),row:"tl"==this.options.rowSign?-Math.round((o.y-p)/h):-Math.round((p-o.y)/h)-1}},setParams:function(t,e){return r.a.extend(this.wmtsParams,t),e||this.redraw(),this},getMatrixIdByScale:function(t){for(var e,i=0;i<this.matrixIds.length;i++){var n=this.matrixIds[i].scaleDenominator,r=parseFloat(n)/parseFloat(t);if(r>.9&&r<1.1){e=this.matrixIds[i];break}}return e},getZoomOffset:function(){var t=0;if(this._map.options.scales)for(var e=this.matrixIds[0].scaleDenominator,i=this._map.defauleScales(),n=0;n<i.length;n++){var r=i[n],a=parseFloat(r)/parseFloat(e);if(a>.9&&a<1.1){t=n;break}}return t},get3857Matrix:function(){for(var t=this._map.getScales(),e=[],i=0;i<21;i++)e[i]={identifier:""+i,scaleDenominator:t[i],topLeftCorner:new r.a.LatLng(20037508.3428,-20037508.3428)};return e},get4326Matrix:function(){for(var t=this._map.getScales(),e=[],i=0;i<21;++i)e[i]={identifier:""+i,scaleDenominator:t[i],topLeftCorner:new r.a.LatLng(90,-180)};return e},getDefaultMatrix:function(){return"EPSG:4326"==this._map.options.crs.code?this.get4326Matrix():this.get3857Matrix()},getMatrixIdByDefaultScale:function(t){for(var e,i=this.getDefaultMatrix(),n=0;n<i.length;n++){var r=i[n].scaleDenominator,a=parseFloat(r)/parseFloat(t);if(a>.9&&a<1.1){e=i[n];break}}return e}})),s=function(t,e){return new a(t,e)};r.a.geoway.wmtsLayer=s,r.a.geoway.WMTSLayer=a,r.a.TileLayer.WMTS=a,r.a.tileLayer.wmts=s;var o=i(3),h=r.a.TileLayer.extend({initialize:function(t,e){this._url=t,r.a.setOptions(this,e)},getTileUrl:function(t){var e={r:r.a.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}r.a.extend(e,this.options);var n=this._url+"/map/data?tileSize="+e.tileSize+"&row="+e.y+"&col="+e.x+"&level="+e.z;return e.style&&(n+="&style="+e.style),e.code&&(n+="&code="+e.code),n},saveStyle:function(t,e){var i=this._url+"/styleConfig",n={styleconfigjson:t?JSON.stringify(t):""};o.a.post(i,n).then(function(t){e&&e(t)})},setStyle:function(t){this.options.style=encodeURIComponent(JSON.stringify(t)),this.redraw()},setCode:function(t){this.options.code=t,this.redraw()},clearStyle:function(){this.options.style=null,this.options.code=null,this.redraw()}}),l=function(t,e){return new h(t,e)};r.a.geoway.imageMapLayer=l,r.a.geoway.ImageMapLayer=h,r.a.ImageMapLayer=h,r.a.tileLayer.image=l;var u=r.a.Layer.extend({options:{opacity:1,zIndex:1,pane:"tilePane"},_params:null,initialize:function(t,e,i){this.url=t,this._params=e,r.a.Util.setOptions(this,i)},onAdd:function(t){t.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?t.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update()},onRemove:function(){this._currentImage&&this._map.removeLayer(this._currentImage),this._map.off("moveend",this._update,this)},getOpacity:function(){return this.options.opacity},setOpacity:function(t){return this.options.opacity=t,this._currentImage&&this._currentImage.setOpacity(t),this},getZIndex:function(){return this.options.zIndex},setZIndex:function(t){return this.options.zIndex=t,this._currentImage&&this._currentImage.setZIndex(t),this},redraw:function(){this._update()},_renderImage:function(t,e,i){this._map&&(i&&(t="data:"+i+";base64,"+t),new r.a.ImageOverlay(t,e,{opacity:this.options.opacity,crossOrigin:this.options.useCors,pane:this.options.pane||this.getPane(),interactive:this.options.interactive,zIndex:this.options.zIndex}).addTo(this._map).once("load",function(t){if(this._map){var i=t.target,n=this._currentImage;i._bounds.equals(e)&&i._bounds.equals(this._map.getBounds())?(this._currentImage=i,this._map&&this._currentImage._map?(this._currentImage.setOpacity(this.options.opacity),this._currentImage.setZIndex(this.options.zIndex)):this._currentImage._map.removeLayer(this._currentImage),n&&this._map&&this._map.removeLayer(n),n&&n._map&&n._map.removeLayer(n)):this._map.removeLayer(i)}this.fire("load",{bounds:e})},this),this.fire("loading",{bounds:e}))},_buildExportParams:function(){var t=this._map.getBounds(),e=this._map.getSize(),i=this._map.options.crs.project(t._northEast),n=this._map.options.crs.project(t._southWest),r=this._map.latLngToLayerPoint(t._northEast),a=this._map.latLngToLayerPoint(t._southWest);return(r.y>0||a.y<e.y)&&(e.y=a.y-r.y),{xmin:n.x,ymin:n.y,xmax:i.x,ymax:i.y,width:e.x,height:e.y}},_update:function(){if(this._map){var t=this._map.getZoom(),e=this._map.getBounds();if(!(this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress))if(t>this.options.maxZoom||t<this.options.minZoom)this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);else{var i=this._buildExportParams();this._requestExport(i,e)}}},_requestExport:function(t,e){var i=r.a.Util.template(this.url,r.a.Util.extend(t));this._params&&(i+=r.a.Util.getParamString(this._params,i)),this._renderImage(i,e)}});function c(){this.id=this.createUUID()}r.a.geoway.singleImageLayer=function(t,e){return new u(t,e)},r.a.geoway.SingleImageLayer=u,c.prototype.valueOf=function(){return this.id},c.prototype.toString=function(){return this.id},c.prototype.createUUID=function(){var t=new Date(1582,10,15,0,0,0,0),e=(new Date).getTime()-t.getTime();return c.getIntegerBits(e,0,31)+c.getIntegerBits(e,32,47)+(c.getIntegerBits(e,48,59)+"2")+c.getIntegerBits(c.rand(4095),0,7)+c.getIntegerBits(c.rand(4095),0,7)+(c.getIntegerBits(c.rand(8191),0,7)+c.getIntegerBits(c.rand(8191),8,15)+c.getIntegerBits(c.rand(8191),0,7)+c.getIntegerBits(c.rand(8191),8,15)+c.getIntegerBits(c.rand(8191),0,15))},c.getIntegerBits=function(t,e,i){var n=c.returnBase(t,16),r=new Array,a="",s=0;for(s=0;s<n.length;s++)r.push(n.substring(s,s+1));for(s=Math.floor(e/4);s<=Math.floor(i/4);s++)r[s]&&""!=r[s]?a+=r[s]:a+="0";return a},c.returnBase=function(t,e){var i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];if(t<e)var n=i[t];else{var r=""+Math.floor(t/e),a=t-r*e;if(r>=e)n=this.returnBase(r,e)+i[a];else n=i[r]+i[a]}return n},c.rand=function(t){return Math.floor(Math.random()*t)};var f=c;var p=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=(new f).valueOf(),this.type="",this.textures={}};r.a.geoway.DataSource=p;var d=p,g=i(2),y="jssdk_bate@ leaflet 3.0.10";function v(t){"@babel/helpers - typeof";return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var i,n=b(t);if(e){var r=b(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===v(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(a,d);var e,i,n,r=w(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=r.call(this)).urlArray=[],t.type="URLDataSource",t.url=null,t.styleUrl=null,t.styleId="style",t.filter=null,t.textures={},t.control=null,t.controlId=null,t.sourceUrl=null,t.host="",t.servername="",t.newEngine=!1,t.serverInfo={},t}return e=a,(i=[{key:"loadStyle",value:function(t){var e=new g.a,i=new g.a,n=new g.a,r=new g.a;this.parseUrl(),this.newEngine&&this.loadServerInfo();var a=this.url.split("?")[1];if(this.sourceUrl||(this.sourceUrl=this.url+"&clientVersion="+y,this.url=this.url+"&clientVersion="+y),this.control&&this.isIE()?Object(g.c)({type:"post",url:this.host+"/mapserver/vmap/"+this.servername+"/setControl",data:"control="+this.control,dataType:"json"}).then(function(t){this.controlId=t.id,this.url=this.sourceUrl+"&controlId="+t.id,e.resolve()}.bind(this)):(this.control?this.url=this.sourceUrl+"&control="+encodeURIComponent(this.control):this.url=this.sourceUrl,e.resolve()),t||(t="label"),"_default__"==this.styleId){return this.styleFun=new Function("drawer","level",'let layers = drawer.getAllLayer(); layers.setStyle(function(level , get){ return {"type":"_default__","_id":"1","show":true,"pointFillStyle":"#ff0000","radius":5,"lineFillStyle":"#00ff00","lineWidth":3 }})'),[e]}return Object(g.c)({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/"+t+"/style.js?"+Math.random()+"&"+a,dataType:"text"}).then(function(t){this.newEngine?this.styleFun=new Function("render","level",t):this.styleFun=new Function("drawer","level",t),i.resolve()}.bind(this)),Object(g.c)({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/label/texture.js?"+Math.random()+"&"+a,dataType:"text"}).then(function(t){var e=JSON.parse(t),i=0;for(var r in e)e[r]&&i++;if(0!=i){var a=0;for(var s in e){var o=new Image;o.name=s,o.onload=function(t){a++;var e=t.target.name;this.textures[e]=t.target,a==i&&n.resolve()}.bind(this),o.src=e[s]}}else n.resolve()}.bind(this)),this.loadFonts(a,r),[e,i,n,r]}},{key:"loadServerInfo",value:function(){var t=this;this.host&&this.servername&&Object(g.c)({type:"get",url:this.host+"/mapserver/serverInfo/"+this.servername+".json",dataType:"json"}).then(function(e){if(e&&e.layerMap)for(var i in e.layerMap)t.serverInfo[i]={geometryType:e.layerMap[i].geometryType,fieldsConfig:e.layerMap[i].fields}})}},{key:"loadFonts",value:function(t,e){Object(g.c)({url:this.host+"/mapserver/styleInfo/fonts/"+this.servername+"/"+this.styleId+"/list.json?"+Math.random()+"&"+t,dataType:"json"}).then(function(t){for(var i=[],n=0;n<t.length;n++){var r=t[n];i.push(this.loadFont(r))}Promise.all(i).then(function(){e.resolve()})}.bind(this),function(t){e.resolve()})}},{key:"loadFont",value:function(t){var e=new g.a,i=t["font-family"],n=this.getBrowserFontUrl(t.urls);console.log(n);var r=new XMLHttpRequest,a=this;return r.addEventListener("readystatechange",function(){if(4==r.readyState)if("fonts"in document)new FontFace(i,r.response).load().then(function(t){document.fonts.add(t),e.resolve()}).catch(function(t){console.log("加载字体失败"+i+t)});else if("head"in document){for(var t=new Uint8Array(r.response),n="",s=0;s<t.byteLength;s++)n+=String.fromCharCode(t[s]);var o=btoa(n),h="@font-face{font-family:"+i+";src:url('"+("data:application/x-font-eot;charset=utf-8;base64,"+o)+"');}";a.createStyleTag(h),e.resolve()}}),r.open("GET",n),r.responseType="arraybuffer",r.send(),e}},{key:"checkFont",value:function(t){for(var e=document.fonts.values(),i=!1,n=e.next();!n.done&&!i;){n.value.family==t&&(i=!0),n=e.next()}return i}},{key:"createStyleTag",value:function(t){if(t){var e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.appendChild(document.createTextNode(t)),e.appendChild(i)}}},{key:"parseUrl",value:function(){var t=this.url.split("?"),e=t[0].split("/mapserver/");this.host=e[0],this.servername=e[1].split("/")[1];for(var i=t[1].split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if("styleId"==r[0])return void(this.styleId=r[1])}}},{key:"setFilter",value:function(t){if(this.control=null,this.url&&t&&(0!=t.layers.length||0!=t.order.length)){for(var e=0;e<t.layers.length;e++){t.layers[e].id||t.layers.splice(e,1)}this.control=JSON.stringify(t)}}},{key:"getTexture",value:function(t){return this.textures[t]}},{key:"addTexture",value:function(t,e){this.textures[t]=e}},{key:"isIE",value:function(){if(window.ActiveXObject||"ActiveXObject"in window){var t=navigator.appVersion.split(";");if(t[1])if("MSIE9.0"==t[1].replace(/[ ]/g,""))return!1;return!0}return!1}},{key:"getBrowserFontUrl",value:function(t){var e=this.host+"/mapserver/styleInfo/fonts/",i=navigator.userAgent,n=!!window.ActiveXObject||"ActiveXObject"in window;return i.indexOf("MSIE")>0||n?e+t.eot.url:i.indexOf("Firefox")>0?e+t.woff.url:i.indexOf("Chrome")>0?e+t.ttf.url:null}}])&&m(e.prototype,i),n&&m(e,n),a}();r.a.geoway.URLDataSource=x;var M=x;function L(t){"@babel/helpers - typeof";return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var i,n=T(t);if(e){var r=T(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(a,d);var e,i,n,r=C(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=r.call(this)).type="LocalDataSource",t.features=[],t.textureUrls={},t}return e=a,(i=[{key:"addFeature",value:function(t){this.features.push(t)}},{key:"addTextureUrl",value:function(t,e){this.textureUrls[t]=e}},{key:"removeTextureUrl",value:function(t){delete this.textureUrls[t]}},{key:"loadTexture",value:function(){var t=new g.a,e=0;for(var i in this.textureUrls)this.textureUrls[i]&&e++;if(0!=e){var n=0;for(var r in this.textureUrls){var a=new Image;a.name=r,a.onload=function(i){n++;var r=i.target.name;this.textures[r]=i.target,n==e&&t.resolve()}.bind(this),a.src=this.textureUrls[r]}return t}t.resolve()}},{key:"removeFeatureById",value:function(t){for(var e=0;e<this.features.length;e++){this.features[e].id==t&&this.features.splice(e,1)}}}])&&k(e.prototype,i),n&&k(e,n),a}();r.a.geoway.LocalDataSource=P;var E=P,A=i(19),I=i(16);function D(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var O=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tileSize=256}var e,i,n;return e=t,(i=[{key:"setFilter",value:function(t,e){for(var i=0;i<t.layers.length;i++){t.layers[i].id||t.layers.splice(i,1)}var n=JSON.stringify(t);if(this.isIE())Object(g.c)({type:"post",url:this.host+"/mapserver/vmap/"+this.servername+"/setControl",data:"control= "+n,dataType:"json"}).then(function(t){t.isIE=!0,e(t)}.bind(this));else{var r={isIE:!1,id:encodeURIComponent(n)};e(r)}}},{key:"parseUrl",value:function(t){var e=t.split("?"),i=e[0].split("/mapserver/");this.host=i[0],this.servername=i[1].split("/")[1];for(var n=e[1].split("&"),r=0;r<n.length;r++){var a=n[r].split("=");if("styleId"==a[0])return void(this.styleId=a[1])}}},{key:"pickupFeaturesBylatlng",value:function(t,e,i,n,r,a){var s=this.host+"/mapserver/"+this.servername+"/"+this.styleId+"/pickup?level="+t+"&lon="+r+"&lat="+n+"&clientVersion="+y;e&&(s=s+"&control="+e),i&&(s=s+"&controlId="+i),Object(g.c)({url:s,dataType:"json"}).then(function(t){a(t)},function(){a([])})}},{key:"pickupFeatures",value:function(t,e,i,n,r,a,s,o){var h=this.host+"/mapserver/pickup/"+this.servername+"/getData?x="+e+"&y="+t+"&l="+i+"&pixelX="+n+"&pixelY="+r+"&styleId="+this.styleId+"&tilesize="+this.tileSize+"&clientVersion="+y;a&&(h=h+"&control="+a),s&&(h=h+"&controlId="+s),Object(g.c)({url:h,dataType:"json"}).then(function(t){o(t)},function(){o([])})}},{key:"CreateHighlightFilter",value:function(t,e){var i=new A.a;for(var n in i.otherDisplay=!1,t){var r=t[n],a=new I.a;a.id=n,a.color=e;var s="";for(var o in r)s=s+o+",";s.length>0&&(s=s.substr(0,s.length-1),a.idFilter=s),i.addFilterLayer(a)}return i}},{key:"CreateEveryHighlightFilter",value:function(t){var e=new A.a;for(var i in e.otherDisplay=!1,t){var n=t[i],r=n.style,a=!1;for(var s in n){var o=n[s].style,h=new I.a;h.id=i,h.idFilter=s,h.color=o,e.addFilterLayer(h),a=!0}if(!a&&r){var l=new I.a;l.id=i,l.color=r,e.addFilterLayer(l)}}return e}},{key:"isIE",value:function(){if(window.ActiveXObject||"ActiveXObject"in window){var t=navigator.appVersion.split(";");if(t[1])if("MSIE9.0"==t[1].replace(/[ ]/g,""))return!1;return!0}return!1}}])&&D(e.prototype,i),n&&D(e,n),t}();r.a.geoway.GXYZUtil=O;var F=O,R=i(14),N=r.a.TileLayer.extend({urlArray:[],sourceUrl:null,textures:{},tileQueue:[],ratio:1,tilesize:256,control:null,controlId:null,hitDetection:!1,initialize:function(t,e){window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize&&(this.tilesize=e.tileSize),this.gxyzUtil=new F,this.gxyzUtil.tileSize=this.tilesize,this.gxyzUtil.parseUrl(t),this._url=t+"&tilesize="+this.tilesize+"&clientVersion="+y,r.a.setOptions(this,e),e&&(this.hitDetection=e.hitDetection),this.on("tileunload",this._onTileRemove),this.on("tileload",this._onTileLoad),this.on("tileerror",this._onTileError)},_initContainer:function(){this._container||(this._container=r.a.DomUtil.create("div","leaflet-pane leaflet-overlay-pane"),this.getPane().appendChild(this._container))},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+y+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+y+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={},Object(g.c)({url:this.gxyzUtil.host+"/mapserver/styleInfo/"+this.gxyzUtil.servername+"/"+this.gxyzUtil.styleId+"/label/texture.js",dataType:"text"}).then(function(t){var e=JSON.parse(t),i=0;for(var n in e)i++;0==i&&(this._resetView(),this._update());var r=0;for(var a in e){var s=new Image;s.name=a,s.onload=function(t){r++;var e=t.target.name;this.textures[e]=t.target,r==i&&(this._resetView(),this._update())}.bind(this),s.src=e[a]}}.bind(this))},createTile:function(t,e){var i=this.tileQueue.pop();i?this._cleanTile(i):i=this.initTile();var n=this.getTileUrl(t);return Object(g.c)({url:n,dataType:"json"}).then(function(t){i.data=t,this._tileOnLoad.apply(this,[e,i])}.bind(this),function(t){this._tileOnError.apply(this,[e,i,t])}.bind(this)),i},getTileUrl:function(t){var e={r:r.a.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}if(0==this.urlArray.length)return r.a.Util.template(this._url,r.a.extend(e,this.options));var n=this.urlArray.length-1,a=Math.round(Math.random()*n),s=this.urlArray[a];return s=s+"/mapserver"+this._url.split("/mapserver")[1],r.a.Util.template(s,r.a.extend(e,this.options))},initTile:function(){var t=document.createElement("canvas");t.style.width=this.tilesize+"px",t.style.height=this.tilesize+"px",t.width=this.tilesize,t.height=this.tilesize;var e=t.getContext("2d",{isQuality:!0});if(t.ctx=e,this.hitDetection){var i=document.createElement("canvas");i.style.width=this.tilesize+"px",i.style.height=this.tilesize+"px",i.width=this.tilesize,i.height=this.tilesize;var n=i.getContext("2d",{isQuality:!0});t.hitCtx=n}return t},_onTileRemove:function(t){this.tileQueue.push(t.tile)},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,r.a.DomUtil.remove(e))},_onTileLoad:function(t){var e=t.tile;this._drawTile(e,e.data),e.complete=!0},_onTileError:function(t){var e=t.tile;e.complete=!0,this.tileQueue.push(e)},_tileOnError:function(t,e,i){t(i,e)},_drawTile:function(t,e){for(var i=t.ctx,n=(t.hitCtx,{}),r=0;r<e.length;r++){var a=e[r];1!=a.type?2==a.type&&R.a.drawLine(i,a,this.ratio):(a.id=Math.round(256*Math.random()*256*256),n[a.id]=a,a.iconImg=this.textures[a.style.texture],R.a.drawPointIcon(i,a,this.ratio,!1,t.hitCtx,this.hitDetection),R.a.drawPoint(i,a,this.ratio,!1,!1,t.hitCtx,this.hitDetection))}t.featureIdMap=n},_cleanTile:function(t){t.ctx.clearRect(0,0,this.tilesize,this.tilesize),t.hitCtx&&t.hitCtx.clearRect(0,0,this.tilesize,this.tilesize)},getFeatureByXY:function(t,e){var i=null;if(this.hitDetection){var n,a=this._map.containerPointToLatLng(new r.a.point(t,e)),s=this._map.options.crs.projection.bounds,o=this._map.getBounds(),h=this._map.getPixelBounds(),l=(o._northEast.lat-o._southWest.lat)/(h.max.y-h.min.y),u=this.tilesize,c=(s.max.y-a.lat)/(l*u),f=(a.lng-s.min.x)/(l*u),p=Math.floor(c),d=Math.floor(f),g=this._map.getZoom(),y=this._tiles[d+":"+p+":"+g].el,v=(f-d)*u,m=(c-p)*u,_=y.hitCtx.getImageData(v,m,1,1).data;if(255===_[3]){var w=_[2]+256*(_[1]+256*_[0]);if(w){n=w-1;try{i=y.featureIdMap[n]}catch(t){console.log(t)}}}}return i},_update:function(t){this.isSetIngFilter||r.a.TileLayer.prototype._update.call(this)},setFilter:function(t){if(this.isSetIngFilter=!0,!this._url||!t||0==t.layers.length&&0==t.order.length)return this.isSetIngFilter=!1,this.controlId=null,this.control=null,void this.setUrl(this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+y);this.gxyzUtil.setFilter(t,function(t){this.isSetIngFilter=!1,t.isIE?(this.controlId=t.id,this.setUrl(this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+y+"&controlId="+t.id)):(this.control=t.id,this.setUrl(this.sourceUrl+"&tilesize="+this.tilesize+"&clientVersion="+y+"&control="+t.id))}.bind(this))}});r.a.geoway.GLabelGrid=N,r.a.GLabelGrid=N;var B=N,z=i(34),U=r.a.Layer.extend({canvasLayer:null,currLevel:2,ratio:1,hitDetection:!0,cellsize:4,options:{tileSize:256,opacity:1},initialize:function(t){r.a.setOptions(this,t),this.options.hasOwnProperty("hitDetection")&&(this.hitDetection=this.options.hitDetection),this.options.hasOwnProperty("cellsize")&&(this.cellsize=this.options.cellsize),window.devicePixelRatio>1.5&&(this.ratio=2),this.canvasLayer=new z.a,this.canvasLayer.tileSize=this.options.tileSize,this.options.hasOwnProperty("ableAvoid")&&(this.canvasLayer.ableAvoid=this.options.ableAvoid),this.options.hasOwnProperty("debug")&&(this.debug=this.options.debug,this.canvasLayer.setDebug(this.debug)),this.animating=!1},onAdd:function(){this.canvasLayer.hitDetection=this.hitDetection,this.canvasLayer.ratio=this.ratio;var t=this._map.options.crs.projection.bounds;this.canvasLayer.init(this._map._size.x,this._map._size.y,this.options.tileSize,this),this.canvasLayer.maxExtent=[t.min.x,t.min.y,t.max.x,t.max.y],this._container=this.canvasLayer.root,this._zoomAnimated&&r.a.DomUtil.addClass(this._container,"leaflet-zoom-animated"),this.canvasLayer.root.style.opacity=this.options.opacity,this.getPane().appendChild(this.canvasLayer.root),this._update()},setOpacity:function(t){this.options.opacity=t,this.canvasLayer.root&&(this.canvasLayer.root.style.opacity=this.options.opacity)},setAbleAvoid:function(t){this.canvasLayer&&(this.canvasLayer.ableAvoid=t,this.redraw())},getEvents:function(){var t={resize:this.onResize,movestart:this.onMoveStart,zoom:this._onZoom,moveend:this._onMoveend};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},onResize:function(t){this.canvasLayer.tileSize=this.options.tileSize,this.canvasLayer.gwvtAnno=this,this.canvasLayer.initCanvas(this._map._size.x,this._map._size.y),this._update()},_onAnimZoom:function(t){this.updateTransform(t.center,t.zoom)},_onZoom:function(){this.updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveend:function(){this.animating=!1,this._update()},updateTransform:function(t,e){this._zoom&&this._center||(this._zoom=this._map.getZoom(),this._center=this._map.getCenter());var i=this._map.getZoomScale(e,this._zoom),n=this.getCanvasXY(),a=this._map.getSize().multiplyBy(.5),s=this._map.project(this._center,e),o=this._map.project(t,e).subtract(s),h=a.multiplyBy(-i).add(n).add(a).subtract(o);r.a.Browser.any3d?r.a.DomUtil.setTransform(this.canvasLayer.root,h,i):r.a.DomUtil.setPosition(this.canvasLayer.root,h)},onMoveStart:function(){this.animating=!0},_update:function(){var t=this._map;if(t){var e=t.getBounds(),i=t.getPixelBounds(),n=t.options.crs.projection.project(e._northEast),r=t.options.crs.projection.project(e._southWest),a=(n.y-r.y)/(i.max.y-i.min.y),s=t.options.crs.projection.bounds,o=Math.floor((s.max.y-n.y)/(a*this.options.tileSize)),h=Math.ceil((s.max.y-r.y)/(a*this.options.tileSize)),l=Math.floor((r.x-s.min.x)/(a*this.options.tileSize)),u=Math.ceil((n.x-s.min.x)/(a*this.options.tileSize)),c=t.getZoom(),f=this.currLevel!=c,p=this.getGrid(o,h,l,u,c);this.canvasLayer.extent=[r.x,r.y,n.x,n.y],this.canvasLayer.res=a,this.canvasLayer.requestLabelTiles(p,f),this.currLevel=c}},getGrid:function(t,e,i,n,r){for(var a=[],s=i;s<n;s++)for(var o=t;o<e;o++)a.push({row:o,col:s,level:r});return a},resetCanvasDiv:function(){var t=this.getCanvasXY();r.a.DomUtil.setPosition(this._container,t),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},getCanvasXY:function(){var t,e=this._map.dragging._draggable._element.style;return{x:-(t=e.transform?e.transform.match(/(-?\d+\.?\d*)(px)/g):[e.left,e.top])[0].replace("px",""),y:-t[1].replace("px","")}},redraw:function(){this.canvasLayer&&this.canvasLayer.redraw()},addDataSource:function(t){this.canvasLayer.addDataSource(t)},removeDataSourceById:function(t){this.canvasLayer.removeDataSourceById(t)},onRemove:function(t){r.a.DomUtil.remove(this.canvasLayer.root)},addToMap:function(t){t.addLayer(this)},getFeatureByXY:function(t,e){return this.canvasLayer.getFeatureByXY(t,e)},setHasImportant:function(t){this.canvasLayer&&(this.canvasLayer.hasImportant=t)},getHasImportant:function(){return!this.canvasLayer||this.canvasLayer.hasImportant},setDebug:function(t){this.debug!=t&&(this.debug=t,this.canvasLayer&&(this.canvasLayer.setDebug(this.debug),this._update()))},getFeaturesByXY:function(t,e){return this.canvasLayer.getFeaturesByXY(t,e)},highlightLabel:function(t,e){e||(e="#ff0000"),this.canvasLayer.highlightLabel(t,e),this._update()},getCurrentLabels:function(){return this.canvasLayer.features},CLASS_NAME:"L.GWVTAnno"});r.a.geoway.GWVTAnno=U,r.a.GWVTAnno=U;var G=U;function j(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var q=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=Math.round(256*Math.random()*256*256),this.type=1,this.sourceData=[],this.datas=[],this.sourceAngleData=[],this.attributes={},this.style={}}var e,i,n;return e=t,(i=[{key:"addAttribute",value:function(t,e){this.attributes[t]=e}},{key:"removeAttributeByKey",value:function(t){delete this.attributes[t]}},{key:"getMaxExtent",value:function(){if(0==this.sourceData.length)return null;for(var t=this.sourceData[0],e=this.sourceData[0],i=this.sourceData[1],n=this.sourceData[1],r=2;r<this.sourceData.length;r++){var a=this.sourceData[r],s=this.sourceData[r+1];a>e&&(e=a),a<t&&(t=a),s>n&&(n=s),s<i&&(i=s),r++}return[t,i,e,n]}},{key:"inBounds",value:function(t){var e=this.getMaxExtent();return!!e&&(e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1])}},{key:"transformData",value:function(t,e){if(this.datas=[],0!=this.sourceData.length){for(var i=t[0],n=t[3],r=[],a=0;a<this.sourceAngleData.length;a++){var s=this.sourceAngleData[a][0],o=[(s[0]-i)/e,(n-s[1])/e];r.push([o,this.sourceAngleData[a][1]])}this.datas=r}}},{key:"getFeatureLabel",value:function(){var t=this.style.labelfield;return t&&this.attributes[t]?this.attributes[t]+"":null}}])&&j(e.prototype,i),n&&j(e,n),t}();r.a.geoway.Feature=q;var V=q;function W(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var H=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.style={},this.style.id=e,this.style.layer=i,this.style.type="style",this.style.children=[]}var e,i,n;return e=t,(i=[{key:"queryFilter",value:function(t,e){t?(this.style.query=t,this.style.fields=e):this.style.query=""}},{key:"setStyle",value:function(t){this.style.style=t}},{key:"addSubStyle",value:function(t){this.style.children.push(t.style)}}])&&W(e.prototype,i),n&&W(e,n),t}();r.a.geoway.GStyleItem=H;var Z=H;function X(t){"@babel/helpers - typeof";return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var i,n=K(t);if(e){var r=K(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===X(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var $=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(a,F);var e,i,n,r=J(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=r.call(this)).textures={},e.isDynamicMap=t,e.styleObj={},e}return e=a,(i=[{key:"setStyle",value:function(t){this.styleObj=t}},{key:"formatStyle",value:function(t,e){this.styleObj=t;var i=JSON.stringify(this.styleObj);Object(g.c)({type:"post",url:this.host+"/mapserver/styleInfo/format.do",data:"styleJson= "+i,dataType:"json"}).then(function(t){this.styleFun=new Function("drawer","level",t.styleJs),e()}.bind(this))}},{key:"loadStyle",value:function(t){var e=new g.a,i=new g.a;if(t||(t="label"),this.isDynamicMap){var n=JSON.stringify(this.styleObj);Object(g.c)({type:"post",url:"http://127.0.0.1/mapserver/styleInfo/format.do",data:"styleJson= "+n,dataType:"json"}).then(function(t){this.styleFun=new Function("drawer","level",t.styleJs),e.resolve()}.bind(this))}else Object(g.c)({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/"+t+"/style.js?"+Math.random(),dataType:"text"}).then(function(t){this.styleFun=new Function("drawer","level",t),e.resolve()}.bind(this));return Object(g.c)({url:this.host+"/mapserver/styleInfo/"+this.servername+"/"+this.styleId+"/label/texture.js?"+Math.random(),dataType:"text"}).then(function(t){var e=JSON.parse(t),n=0;for(var r in e)e[r]&&n++;if(0!=n){var a=0;for(var s in e){var o=new Image;o.name=s,o.onload=function(t){a++;var e=t.target.name;this.textures[e]=t.target,a==n&&i.resolve()}.bind(this),o.src=e[s]}}else i.resolve()}.bind(this)),[e,i]}}])&&Y(e.prototype,i),n&&Y(e,n),a}();r.a.geoway.GVMapGridUtil=$;var tt=$;function et(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var it=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.propertyConfig={};for(var i=0;i<e.length;i++)"true"!=e[i].id&&1!=e[i].id||(this.idIndex=e[i].index),this.propertyConfig[e[i].name]=parseInt(e[i].index)}var e,i,n;return e=t,(i=[{key:"get",value:function(t,e){return t[this.propertyConfig[e]]}},{key:"getId",value:function(t){return t[this.idIndex]}}])&&et(e.prototype,i),n&&et(e,n),t}();function nt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var rt=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.layerDataMap=e.layerDataMap,this.extent=e.extent,this.ctx=e.ctx,this.ratio=e.ratio,this.control=e.control,this.drawerCalss=i,this.config=e,this.textures=e.textures}var e,i,n;return e=t,(i=[{key:"_emptyDrawer",value:function(t){return new this.drawerCalss(null)}},{key:"getLayer",value:function(t,e){if(null==e&&(e=t),null==this.layerDataMap)return this._emptyDrawer(e);if(null!=this.control&&0==this.control.controlObj.otherDisplay&&-1==this.control.controlObj.controlLayersArr.indexOf(e))return this._emptyDrawer(e);var i=this.layerDataMap[t];if(null==i)return this._emptyDrawer(e);if(i.datas&&(i.features=i.datas),null==i.features)return this._emptyDrawer(e);var n=null;null!==i.fieldsConfig&&(n=new it(i.fieldsConfig)),this.config.dataLayerID=t,this.config.styleLayerID=e,this.config.propertyGetter=n,this.config.control=this.control,this.config.textures=this.textures;var r=new this.drawerCalss(this.config);if(Array.isArray(i.features)){var a=i.features;a.type=i.type,r.addFeatures(a)}else for(var s in i.features){var o=i.features[s];o.type=i.type,r.addFeatures(o)}return r}},{key:"getGroupLayer",value:function(t,e,i){if(null==this.layerDataMap)return this._emptyDrawer(i);if(null==i&&(i=t),null!=this.control&&0==this.control.controlObj.otherDisplay&&-1==this.control.controlObj.controlLayersArr.indexOf(i))return this._emptyDrawer(i);var n=this.layerDataMap[t];if(null==this.layerDataMap)return this._emptyDrawer(i);if(null==n)return this._emptyDrawer(i);if(null==n.datas&&null==n.data)return this._emptyDrawer(i);var r=e.split(","),a=r.length;if(0==a)return this._emptyDrawer(i);var s=null;null!=n.fieldsConfig&&(s=new it(n.fieldsConfig)),this.config.dataLayerID=t,this.config.styleLayerID=i,this.config.propertyGetter=s,this.config.control=this.control,this.config.textures=this.textures;var o=new this.drawerCalss(this.config);null==n.data?n.features=n.datas:n.features=n.data;for(var h=0;h<a;h++){var l=n.features[r[h]];null!=l&&(l.type=n.type,o.addFeatures(l))}return o}}])&&nt(e.prototype,i),n&&nt(e,n),t}();function at(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var st=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&(this.featuresArr=[],this.propertyGetter=e.propertyGetter,this.extent=e.extent,this.ratio=e.ratio,this.resize=!1,1!=this.ratio&&(this.resize=!0),this.level=this.extent.level,this.dataLayerID=e.dataLayerID,this.styleLayerID=e.styleLayerID,this.control=e.control)}var e,i,n;return e=t,(i=[{key:"addFeatures",value:function(t){this.featuresArr.push(t)}},{key:"setStyle",value:function(t){this.styleOperator=t}},{key:"process",value:function(){if(null!=this.featuresArr){var t=this.featuresArr.length;if(0!=t)for(var e=0;e<t;e++){var i=this.featuresArr[e];this._processFeatures(i)}}}},{key:"_processFeature",value:function(t){throw"抽象方法"}},{key:"_processFeatures",value:function(t){for(var e=0;e<t.length;e++){var i=t[e];this._processFeature(i)}}},{key:"_getProperty",value:function(t){return t[1]}},{key:"_getPoints",value:function(t){return t[2]}},{key:"_getType",value:function(t){return t[0]}},{key:"_filterByStyle",value:function(t){var e=this._getType(t),i=this._getPoints(t),n=this._getProperty(t);if(null==i)throw"绘制失败,数据中缺少Geometry";null==e&&(e="POLYGON");var r=null,a=null;if(null==this.styleOperator)return null;this.propertyGetter;var s=this.propertyGetter.getId(n),o=this.propertyGetter,h=function(t){return o.get(n,t)};return!this.control||"function"!=typeof this.control.controlFn||0!=(r=this.control.controlFn.call({},s,h,this.styleLayerID))&&null!=r?null==(a=this.styleOperator.call({},this.level,h))?null:null!=a.display&&0==a.display?{display:!1}:(null!=r&&(a.customeColor=r),a):{display:!1}}}])&&at(e.prototype,i),n&&at(e,n),t}();function ot(t){"@babel/helpers - typeof";return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ht(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lt(t,e){return(lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var i,n=ct(t);if(e){var r=ct(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===ot(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function ct(t){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lt(t,e)}(a,st);var e,i,n,r=ut(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e=r.call(this,t),t&&(e.ctx=t.ctx,e.shadowDatas=[],e.textures=t.textures),e}return e=a,(i=[{key:"draw",value:function(){if(null!=this.featuresArr){this.process();for(var t=0;t<this.shadowDatas.length;t++){var e=this.shadowDatas[t];this._drawShape(e.data),this._processShadowEnd(e.style)}}}},{key:"_processShadowEnd",value:function(t){this.ctx.closePath(),t.shadowColor&&(this.ctx.globalAlpha=1,this.ctx.fillStyle=t.shadowColor,this.ctx.fill())}},{key:"_drawShape",value:function(t){var e=this.ctx;if(t.length){if(e.beginPath(),this.resize){e.moveTo(t[0]*this.ratio,t[1]*this.ratio);for(var i=2,n=t.length;i<n;i+=2)e.lineTo(t[i]*this.ratio,t[i+1]*this.ratio)}else{e.moveTo(t[0],t[1]);for(i=2,n=t.length;i<n;i+=2)e.lineTo(t[i],t[i+1])}e.closePath()}}},{key:"_processFeature",value:function(t){var e=this._filterByStyle(t);null!=e&&0!=e.display&&(this._beginDraw(),this._drawFeature(t,e))}},{key:"_beginDraw",value:function(){this.ctx.beginPath()}},{key:"_drawFeature",value:function(t,e){var i=this._getType(t),n=this._getPoints(t);this._getProperty(t);if(null==n)throw"绘制失败,数据中缺少Geometry";null==i&&(i="POLYGON");var r=null;switch(null!=e.sparsity&&(r=parseFloat(e.sparsity)),i){case"PT":this._processPoint(n);break;case"LINESTRING":case"MULTILINESTRING":this._processLineString(n,r),this._processLineStringEnd(e);break;case"MULTIPOLYGON":case"POLYGON":this._processPolygon(n,r),this._processPolygonEnd(e)}e.shadowColor&&this._processShadow(n,e,i)}},{key:"_processShadow",value:function(t,e,i){for(var n=t.length,r=0;r<n;r++){var a=t[r];if(Array.isArray(a)){if(0==a.length)return;Array.isArray(a[0])?this._processShadow(a):this._drawShadow(a,e,i)}else{var s=a.PS;this._drawShadow(s,e,i)}}}},{key:"_drawShadow",value:function(t,e,i){if("MULTIPOLYGON"==i||"POLYGON"==i)for(var n=0;n<t.length-3;n+=2){var r={},a={};r.x=t[n],r.y=t[n+1],a.x=t[n+2],a.y=t[n+3];var s=r.x,o=r.y+-3.5,h=a.x,l=a.y+-3.5;if((h-s)*(r.y-o)<(r.x-s)*(l-o)){var u={};u.data=[h,l,s,o,r.x,r.y,a.x,a.y],u.style=e,this.shadowDatas.push(u)}}}},{key:"_processPoint",value:function(t){}},{key:"_processLineString",value:function(t,e){if(Array.isArray(t[0]))for(var i=t.length,n=0;n<i;n++){var r=t[n];this._processLineString(r,e)}else this._renderLinePath(t,!1,e)}},{key:"_processLineStringEnd",value:function(t){var e=!0;if(0==t.stroke&&(e=!1),0!=e){this.resize?this.ctx.lineWidth=t.strokeWidth*this.ratio:this.ctx.lineWidth=t.strokeWidth,this.ctx.strokeStyle=t.strokeColor,this.ctx.globalAlpha=t.strokeOpacity,null!=t.dash&&this.ctx.setLineDash(t.dash),t.lineCap&&(this.ctx.lineCap=t.lineCap),this.ctx.stroke();var i=t.customeColor;"object"==ot(i)&&null!=i.color&&(this.ctx.strokeStyle=i.color,this.ctx.globalAlpha=i.opacity,this.ctx.stroke()),this.ctx.setLineDash([]),this.ctx.lineJoin="round",this.ctx.lineCap="butt"}}},{key:"_processPolygon",value:function(t,e){if(Array.isArray(t[0]))for(var i=t.length,n=0;n<i;n++){var r=t[n];this._processPolygon(r,e)}else this._renderLinePath(t,!0,e)}},{key:"_processPolygonEnd",value:function(t){var e=!1,i=!1;if(1==t.stroke&&(e=!0),1==t.fill&&(i=!0),i&&(t.fillColor&&(this.ctx.fillStyle=t.fillColor),t.fillOpacity?this.ctx.globalAlpha=t.fillOpacity:this.ctx.globalAlpha=1,this.ctx.fill()),e&&(t.strokeWidth&&(this.resize?this.ctx.lineWidth=t.strokeWidth*this.ratio:this.ctx.lineWidth=t.strokeWidth),t.strokeColor&&(this.ctx.strokeStyle=t.strokeColor),t.strokeOpacity?this.ctx.globalAlpha=t.strokeOpacity:this.ctx.globalAlpha=1,this.ctx.stroke()),t.texture){var n=t.texture,r=this.textures(n);if(null!=r){var a=t.textureratio,s=this.ctx.createPattern(r.toPattern(a),"repeat");this.ctx.fillStyle=s,this.ctx.fill()}}var o=t.customeColor;"object"==ot(o)&&null!=o.color&&(this.ctx.fillStyle=o.color,this.ctx.globalAlpha=o.opacity,this.ctx.fill())}},{key:"_isSavePoint",value:function(t,e,i,n){if(null==t||null==i)return!0;var r=e[0]-t[0],a=e[1]-t[1],s=i[0]-e[0],o=i[1]-e[1];return!(Math.sqrt(r*r+a*a)<n&&Math.sqrt(s*s+o*o)<n)}},{key:"_renderLinePath",value:function(t,e,i){this.resize?this.ctx.moveTo(t[0]*this.ratio,t[1]*this.ratio):this.ctx.moveTo(t[0],t[1]);var n=2,r=t.length;r%2!=0&&(r-=1);for(var a=[t[0],t[1]],s=null,o=null;n<r;){var h=0;if(s=[t[n],t[n+1]],null!=i)for(o=n+2>r?null:[t[n+2],t[n+3]];!this._isSavePoint(a,s,o,i*this.ratio);)s=[t[n+(h+=2)],t[n+1+h]],o=n+2+h>r?null:[t[n+2+h],t[n+3+h]];this.resize?this.ctx.lineTo(s[0]*this.ratio,s[1]*this.ratio):this.ctx.lineTo(s[0],s[1]),a=s,n=n+h+2}e&&(this.resize?this.ctx.lineTo(t[0]*this.ratio,t[1]*this.ratio):this.ctx.lineTo(t[0],t[1]),this.ctx.closePath())}}])&&ht(e.prototype,i),n&&ht(e,n),a}();function pt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var dt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ratio=e.ratio,this.datasArr=[],this.ctx=e.ctx,this.extent=e.extent,this.control=e.control,this.styleFn=null,this.drawable=!1}var e,i,n;return e=t,(i=[{key:"getName",value:function(){return this.name}},{key:"setStyle",value:function(t){this.styleFn=t}},{key:"draw",value:function(){this.drawable=!0,this.doDraw()}},{key:"doDraw",value:function(t){}}])&&pt(e.prototype,i),n&&pt(e,n),t}();function gt(t){"@babel/helpers - typeof";return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var i,n=_t(t);if(e){var r=_t(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===gt(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var wt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vt(t,e)}(a,rt);var e,i,n,r=mt(a);function a(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),r.call(this,t,ft)}return e=a,(i=[{key:"getBackground",value:function(){return new dt({extent:this.extent,ctx:this.ctx,control:this.control,ratio:this.ratio})}},{key:"getWatermark",value:function(){}}])&&yt(e.prototype,i),n&&yt(e,n),a}(),bt=r.a.TileLayer.extend({urlArray:[],sourceUrl:null,textures:{},tileQueue:[],ratio:1,control:null,controlId:null,tilesize:256,initialize:function(t,e){window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize&&(this.tilesize=e.tileSize),this.gVMapGridUtil=new tt,this.gVMapGridUtil.tileSize=this.tilesize,this.gVMapGridUtil.parseUrl(t),this._url=t+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y,r.a.setOptions(this,e),this.on("tileunload",this._onTileRemove),this.on("tileload",this._onTileLoad),this.on("tileerror",this._onTileError)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={};var t=this.gVMapGridUtil.loadStyle("layer");Promise.all(t).then(function(){this._resetView(),this._update()}.bind(this))},createTile:function(t,e){var i=this.tileQueue.pop();i?this._cleanTile(i):i=this.initTile();var n=this.getTileUrl(t);return Object(g.c)({url:n,dataType:"json"}).then(function(t){i.data=t,this._tileOnLoad.apply(this,[e,i])}.bind(this),function(t){this._tileOnError.apply(this,[e,i,t])}.bind(this)),i},getTileUrl:function(t){var e={r:r.a.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}if(0==this.urlArray.length)return r.a.Util.template(this._url,r.a.extend(e,this.options));var n=this.urlArray.length-1,a=Math.round(Math.random()*n),s=this.urlArray[a];return s=s+"/mapserver"+this._url.split("/mapserver")[1],r.a.Util.template(s,r.a.extend(e,this.options))},initTile:function(){var t=document.createElement("canvas");t.style.width=this.tilesize+"px",t.style.height=this.tilesize+"px",t.width=this.tilesize,t.height=this.tilesize;var e=t.getContext("2d",{isQuality:!0});return t.ctx=e,t},_onTileRemove:function(t){this.tileQueue.push(t.tile)},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).complete||r.a.DomUtil.remove(e))},_onTileLoad:function(t){var e=t.tile;this._drawTile(e,e.data),e.complete=!0},_onTileError:function(t){var e=t.tile;e.complete=!0,this.tileQueue.push(e)},_tileOnError:function(t,e,i){t(i,e)},_drawTile:function(t,e){var i=t.ctx,n=Math.floor(this._map.getZoom()),r=new wt({layerDataMap:e,ctx:i,ratio:1,control:null,textures:this.gVMapGridUtil.textures,extent:{level:n}});this.gVMapGridUtil.styleFun.call({},r,n)},_cleanTile:function(t){t.ctx.clearRect(0,0,this.tilesize,this.tilesize)},_update:function(){this.isSetIngFilter||r.a.TileLayer.prototype._update.call(this)},setFilter:function(t){if(this.isSetIngFilter=!0,!this._url||!t||0==t.layers.length&&0==t.order.length)return this.isSetIngFilter=!1,this.controlId=null,this.control=null,void this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y);this.gVMapGridUtil.setFilter(t,function(t){this.isSetIngFilter=!1,t.isIE?(this.controlId=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&controlId="+t.id)):(this.control=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&control="+t.id))}.bind(this))},getFeatureByXY:function(t,e,i){var n=this._map.containerPointToLatLng(new r.a.point(t,e));this.getFeatureByLonlat(n,i)},getFeatureByLonlat:function(t,e){var i=this._map.options.crs.projection.bounds,n=this._map.getBounds(),r=this._map.getPixelBounds(),a=(n._northEast.lat-n._southWest.lat)/(r.max.y-r.min.y),s=this.options.tileSize,o=(i.max.y-t.lat)/(a*s),h=(t.lng-i.min.x)/(a*s),l=this._map.getZoom(),u=(h-Math.floor(h))*s,c=(o-Math.floor(o))*s;this.gVMapGridUtil.pickupFeatures(o,h,l,u,c,this.control,this.controlId,function(t){e(t)})},highlightFeatures:function(t,e){var i=this.gVMapGridUtil.CreateHighlightFilter(t,e);if(0!=i.layers.length){if(!this.highlightLayer){var n=this.gVMapGridUtil.host+"/mapserver/vmap/"+this.gVMapGridUtil.servername+"/getMAP?x={x}&y={y}&l={z}&styleId="+this.gVMapGridUtil.styleId;this.control&&(n=n+"&control="+this.control),this.controlId&&(n=n+"&controlId="+this.controlId),this.highlightLayer=new r.a.GXYZ(n,this.options),this._map.addLayer(this.highlightLayer)}this.highlightLayer.options.opacity=e.opacity,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(i);var a=this.options.zIndex;this.highlightLayer.setZIndex(a+1)}},highlightByFilter:function(t){if(0!=t.layers.length){if(!this.highlightLayer){var e=this.gVMapGridUtil.host+"/mapserver/vmap/"+this.gVMapGridUtil.servername+"/getMAP?x={x}&y={y}&l={z}&styleId="+this.gVMapGridUtil.styleId;this.control&&(e=e+"&control="+this.control),this.controlId&&(e=e+"&controlId="+this.controlId),this.highlightLayer=new r.a.GXYZ(e,this.options),this._map.addLayer(this.highlightLayer)}this.highlightLayer.options.opacity=1,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(t);var i=this.options.zIndex;this.highlightLayer.setZIndex(i+1)}},cancelHighlight:function(){this.highlightLayer&&(this._map.removeLayer(this.highlightLayer),this.highlightLayer=null)}});r.a.geoway.GVMapGrid=bt,r.a.GVMapGrid=bt;var xt=bt,Mt=xt.extend({styleObj:{},styleJs:null,initialize:function(t,e){e.isDynamicMap=!0,window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize&&(this.tilesize=e.tileSize),this.gVMapGridUtil=new tt(e.isDynamicMap),this.gVMapGridUtil.tileSize=this.tilesize,this.gVMapGridUtil.parseUrl(t),this._url=t+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y,r.a.setOptions(this,e),this.on("tileunload",this._onTileRemove),this.on("tileload",this._onTileLoad),this.on("tileerror",this._onTileError)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={},this.gVMapGridUtil.setStyle(this.styleObj);var t=this.gVMapGridUtil.loadStyle("layer");Promise.all(t).then(function(){this._resetView(),this._update()}.bind(this))},addLevels:function(t){this.styleObj[t.levelsKey]=t.levelsData},redraw:function(){return this.gVMapGridUtil.formatStyle(this.styleObj,function(){this._map&&(this._removeAllTiles(),this._update())}),this}});r.a.geoway.GDynamicMap=Mt,r.a.GDynamicMap=Mt;var Lt=Mt,kt=r.a.TileLayer.extend({urlArray:[],sourceUrl:null,gxyzUtil:null,highlightLayer:null,ratio:1,control:null,controlId:null,tilesize:256,initialize:function(t,e){window.devicePixelRatio>1.5&&(this.ratio=2),this.sourceUrl||(this.sourceUrl=t),e&&e.tileSize&&(this.tilesize=e.tileSize),this.gxyzUtil=new F,this.gxyzUtil.tileSize=this.tilesize,this.gxyzUtil.parseUrl(t),this._url=t+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y,r.a.setOptions(this,e)},onAdd:function(){this.control&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&control="+this.control),this.controlId&&(this._url=this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&controlId="+this.controlId),this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},_update:function(){this.isSetIngFilter||r.a.TileLayer.prototype._update.call(this)},getTileUrl:function(t){var e={r:r.a.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}if(0==this.urlArray.length)return r.a.Util.template(this._url,r.a.extend(e,this.options));var n=this.urlArray.length-1,a=Math.round(Math.random()*n),s=this.urlArray[a];return s=s+"/mapserver"+this._url.split("/mapserver")[1],r.a.Util.template(s,r.a.extend(e,this.options))},setFilter:function(t){if(this.isSetIngFilter=!0,!this._url||!t||0==t.layers.length&&0==t.order.length)return this.isSetIngFilter=!1,this.controlId=null,this.control=null,void this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y);this.gxyzUtil.setFilter(t,function(t){this.isSetIngFilter=!1,t.isIE?(this.controlId=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&controlId="+t.id)):(this.control=t.id,this.setUrl(this.sourceUrl+"&ratio="+this.ratio+"&tilesize="+this.tilesize+"&clientVersion="+y+"&control="+t.id))}.bind(this))},getFeatureByXY:function(t,e,i){var n=this._map.containerPointToLatLng(new r.a.point(t,e)),a=this._map.getZoom(),s=this._map.options.crs.project(n);this.gxyzUtil.pickupFeaturesBylatlng(a,this.control,this.controlId,s.y,s.x,i)},getFeatureByLonlat:function(t,e){var i=this._map.options.crs.projection.project(t),n=this._map.options.crs.projection.bounds,r=this._map.getBounds(),a=this._map.getPixelBounds(),s=this._map.options.crs.projection.project(r._northEast),o=this._map.options.crs.projection.project(r._southWest),h=(s.y-o.y)/(a.max.y-a.min.y),l=this.options.tileSize,u=(n.max.y-i.y)/(h*l),c=(i.x-n.min.x)/(h*l),f=this._map.getZoom(),p=(c-Math.floor(c))*l,d=(u-Math.floor(u))*l;this.gxyzUtil.pickupFeatures(u,c,f,p,d,this.control,this.controlId,function(t){e(t)})},highlightFeatures:function(t,e){var i=this.gxyzUtil.CreateHighlightFilter(t,e);if(0!=i.layers.length){this.highlightLayer||(this.highlightLayer=new r.a.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=e.opacity,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(i);var n=this.options.zIndex;this.highlightLayer.setZIndex(n+1)}},highlightEveryFeatures:function(t,e){var i=this.gxyzUtil.CreateEveryHighlightFilter(t);if(0!=i.layers.length){this.highlightLayer||(this.highlightLayer=new r.a.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=e,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(i);var n=this.options.zIndex;this.highlightLayer.setZIndex(n+1)}},highlightByFilter:function(t){if(0!=t.layers.length){this.highlightLayer||(this.highlightLayer=new r.a.GXYZ(this.sourceUrl,this.options),this._map.addLayer(this.highlightLayer)),this.highlightLayer.options.opacity=1,this.highlightLayer._updateOpacity(),this.highlightLayer.setFilter(t);var e=this.options.zIndex;this.highlightLayer.setZIndex(e+1)}},cancelHighlight:function(){this.highlightLayer&&(this._map.removeLayer(this.highlightLayer),this.highlightLayer=null)}});r.a.geoway.GXYZ=kt,r.a.GXYZ=kt;var St=kt;function Ct(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Tt=function(){function t(e,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map=null,this.layer=null,this.label=null,this.layerType=0,this.labelType=2,this.map=n,this.url=i,this.layerId=e,this.styleId=null,this.tileSize=256,this.options=r}var e,i,n;return e=t,(i=[{key:"addServiceGroup",value:function(){switch(this.options&&this.options.styleId&&(this.styleId=this.options.styleId),this.options&&this.options.tileSize&&(this.tileSize=this.options.tileSize),this.layerType){case 0:this.addBaseLayer();break;case 1:this.addFrontBaseLayer()}switch(this.labelType){case 2:this.addFrontLabel();break;case 3:this.AddImgLabel();break;case 4:this.addAvoidLabel()}}},{key:"addBaseLayer",value:function(){this.layer=new r.a.GXYZ(this.url+"&x={x}&y={y}&l={z}&tileType="+this.layerType,{sphericalMercator:!1,isBaseLayer:!1,tileSize:this.tileSize}),this.map.addLayer(this.layer)}},{key:"addFrontBaseLayer",value:function(){this.layer=new r.a.GVMapGrid(this.url+"&x={x}&y={y}&l={z}&tileType="+this.layerType,{maxZoom:21,keepBuffer:0,updateWhenZooming:!1,tileSize:this.tileSize}),this.map.addLayer(this.layer)}},{key:"AddImgLabel",value:function(){this.label=new r.a.GXYZ(this.url+"&x={x}&y={y}&l={z}&tileType="+this.labelType,{sphericalMercator:!1,isBaseLayer:!1,tileSize:this.tileSize}),this.map.addLayer(this.label)}},{key:"addAvoidLabel",value:function(){this.label=new r.a.GLabelGrid(this.url+"&x={x}&y={y}&l={z}&tileType="+this.labelType,{hitDetection:!0,keepBuffer:0,updateWhenZooming:!1,tileSize:this.tileSize}),this.map.addLayer(this.label)}},{key:"addFrontLabel",value:function(){this.label=new r.a.GWVTAnno("GWVTanno",{tileSize:this.tileSize});var t=new M;t.url=this.url+"&x=${x}&y=${y}&l=${z}&tileType="+this.labelType,this.label.addDataSource(t),this.map.addLayer(this.label)}},{key:"setLayerType",value:function(t){"Img"==t?this.layerType=0:"Data"==t&&(this.layerType=1)}},{key:"setLabelType",value:function(t){"Data"==t?this.labelType=2:"Img"==t?this.labelType=3:"AvoidImg"==t&&(this.labelType=4)}},{key:"setTileSize",value:function(t){this.tileSize=t}},{key:"getLayer",value:function(){return this.layer}},{key:"getLabel",value:function(){return this.label}},{key:"removeGroupLayer",value:function(){this.layer&&this.map.removeLayer(this.layer),this.label&&this.map.removeLayer(this.label)}}])&&Ct(e.prototype,i),n&&Ct(e,n),t}();function Pt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Et=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.group={},this.group.id=e,this.group.type="group",this.group.children=[]}var e,i,n;return e=t,(i=[{key:"addStyle",value:function(t){this.group.children.push(t.style)}}])&&Pt(e.prototype,i),n&&Pt(e,n),t}();r.a.geoway.GGroup=Et;var At=Et;function It(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Dt=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.levelsData=[],this.levelsKey=e+"-"+i}var e,i,n;return e=t,(i=[{key:"addGroup",value:function(t){this.levelsData.push(t.group)}},{key:"addStyleItem",value:function(t){this.levelsData.push(t.style)}}])&&It(e.prototype,i),n&&It(e,n),t}();r.a.geoway.GLevels=Dt;var Ot=Dt},function(t,e,i){"use strict";var n=i(0),r=i.n(n),a=i(17),s=(i(10),a.a.extend({namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(t){for(var e in window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),a.a.prototype.initialize.apply(this,[t]),this.namespaces=r.a.extend({},this.namespaces),this.namespaceAlias={},this.namespaces)this.namespaceAlias[this.namespaces[e]]=e},destroy:function(){this.xmldom=null,a.a.prototype.destroy.apply(this,arguments)},setNamespace:function(t,e){this.namespaces[t]=e,this.namespaceAlias[e]=t},read:function(t){var e=t.indexOf("<");return e>0&&(t=t.substring(e)),r.a.Util.tryFunc(r.a.Util.bind(function(){var e;return(e=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom).loadXML(t),e},this),function(){return(new DOMParser).parseFromString(t,"text/xml")},function(){var e=new XMLHttpRequest;return e.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(t),!1),e.overrideMimeType&&e.overrideMimeType("text/xml"),e.send(null),e.responseXML})},write:function(t){var e;if(this.xmldom)e=t.xml;else{var i=new XMLSerializer;if(1==t.nodeType){var n=document.implementation.createDocument("","",null);n.importNode&&(t=n.importNode(t,!0)),n.appendChild(t),e=i.serializeToString(n)}else e=i.serializeToString(t)}return e},createElementNS:function(t,e){return this.xmldom?"string"==typeof t?this.xmldom.createNode(1,e,t):this.xmldom.createNode(1,e,""):document.createElementNS(t,e)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(t){return"string"!=typeof t&&(t=String(t)),this.xmldom?this.xmldom.createTextNode(t):document.createTextNode(t)},getElementsByTagNameNS:function(t,e,i){var n=[];if(t.getElementsByTagNameNS)n=t.getElementsByTagNameNS(e,i);else for(var r,a,s=t.getElementsByTagName("*"),o=0,h=s.length;o<h;++o)a=(r=s[o]).prefix?r.prefix+":"+i:i,"*"!=i&&a!=r.nodeName||"*"!=e&&e!=r.namespaceURI||n.push(r);return n},getAttributeNodeNS:function(t,e,i){var n=null;if(t.getAttributeNodeNS)n=t.getAttributeNodeNS(e,i);else for(var r,a=t.attributes,s=0,o=a.length;s<o;++s)if((r=a[s]).namespaceURI==e&&(r.prefix?r.prefix+":"+i:i)==r.nodeName){n=r;break}return n},getAttributeNS:function(t,e,i){var n="";if(t.getAttributeNS)n=t.getAttributeNS(e,i)||"";else{var r=this.getAttributeNodeNS(t,e,i);r&&(n=r.nodeValue)}return n},getChildValue:function(t,e){var i=e||"";if(t)for(var n=t.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 3:case 4:i+=n.nodeValue}return i},isSimpleContent:function(t){for(var e=!0,i=t.firstChild;i;i=i.nextSibling)if(1===i.nodeType){e=!1;break}return e},hasAttributeNS:function(t,e,i){return t.hasAttributeNS?t.hasAttributeNS(e,i):!!this.getAttributeNodeNS(t,e,i)},setAttributeNS:function(t,e,i,n){if(t.setAttributeNS)t.setAttributeNS(e,i,n);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(e){var r=t.ownerDocument.createNode(2,i,e);r.nodeValue=n,t.setAttributeNode(r)}else t.setAttribute(i,n)}},createElementNSPlus:function(t,e){var i=(e=e||{}).uri||this.namespaces[e.prefix];if(!i){var n=t.indexOf(":");i=this.namespaces[t.substring(0,n)]}i||(i=this.namespaces[this.defaultPrefix]);var r=this.createElementNS(i,t);e.attributes&&this.setAttributes(r,e.attributes);var a=e.value;return null!=a&&r.appendChild(this.createTextNode(a)),r},setAttributes:function(t,e){var i,n;for(var r in e)null!=e[r]&&e[r].toString&&(i=e[r].toString(),n=this.namespaces[r.substring(0,r.indexOf(":"))]||null,this.setAttributeNS(t,n,r,i))},readNode:function(t,e){e||(e={});var i=this.readers[t.namespaceURI?this.namespaceAlias[t.namespaceURI]:this.defaultPrefix];if(i){var n=i[t.localName||t.nodeName.split(":").pop()]||i["*"];n&&n.apply(this,[t,e])}return e},readChildNodes:function(t,e){e||(e={});for(var i,n=t.childNodes,r=0,a=n.length;r<a;++r)1==(i=n[r]).nodeType&&this.readNode(i,e);return e},writeNode:function(t,e,i){var n,r,a=t.indexOf(":");a>0?(n=t.substring(0,a),r=t.substring(a+1)):(n=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,r=t);var s=this.writers[n][r].apply(this,[e]);return i&&i.appendChild(s),s},getChildEl:function(t,e,i){return t&&this.getThisOrNextEl(t.firstChild,e,i)},getNextEl:function(t,e,i){return t&&this.getThisOrNextEl(t.nextSibling,e,i)},getThisOrNextEl:function(t,e,i){t:for(var n=t;n;n=n.nextSibling)switch(n.nodeType){case 1:if(!(e&&e!==(n.localName||n.nodeName.split(":").pop())||i&&i!==n.namespaceURI))break t;n=null;break t;case 3:if(/^\s*$/.test(n.nodeValue))break;case 4:case 6:case 12:case 10:case 11:n=null;break t}return n||null},lookupNamespaceURI:function(t,e){var i=null;if(t)if(t.lookupNamespaceURI)i=t.lookupNamespaceURI(e);else t:switch(t.nodeType){case 1:if(null!==t.namespaceURI&&t.prefix===e){i=t.namespaceURI;break t}var n=t.attributes.length;if(n)for(var r,a=0;a<n;++a){if("xmlns"===(r=t.attributes[a]).prefix&&r.name==="xmlns:"+e){i=r.value||null;break t}if("xmlns"===r.name&&null===e){i=r.value||null;break t}}i=this.lookupNamespaceURI(t.parentNode,e);break t;case 2:i=this.lookupNamespaceURI(t.ownerElement,e);break t;case 9:i=this.lookupNamespaceURI(t.documentElement,e);break t;case 6:case 12:case 10:case 11:break t;default:i=this.lookupNamespaceURI(t.parentNode,e)}return i},getXMLDoc:function(){return!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),this.xmldom}}));e.a=s},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=null,a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,a;return e=t,a=[{key:"getRealLength",value:function(t){for(var e=t.length,i=0,n=0;n<e;n++){var r=t.charCodeAt(n);i+=r>=0&&r<=128?.5:1}return i}},{key:"isNotNull",value:function(t){return!(!t&&0!=t)&&("string"!=typeof t||""!=(t=t.toLowerCase())&&"undefined"!=t&&"null"!=t)}},{key:"formatFont",value:function(t,e,i){var n=t;if(i){null==r&&(r=null);var a=t.split(" ");a.length-1!=0&&"italic"==a[0].toLowerCase()?"simhei"!=a[a.length-1]&&(a[a.length-1]=r.getDefaultFont()+"_italic"):a[a.length-1]=r.getDefaultFont(),n=a.join(" ")}return n.replace(/(\d+\.?\d*)(px|em|rem|pt)/g,function(t,i,n){return(i=Math.round(i)*e)+n})}},{key:"formatLabel",value:function(t){return t&&t.length>0&&(t=(t=(t=t.replace(/([\x00-\x1f\x7f])/g,"")).replace(/(\s*$)/g,"")).replace(/<br\/>/g,"")),t}},{key:"getAngle",value:function(t,e){if(e[0]-t[0]==0)return e[1]>t[0]?90:-90;var i=(e[1]-t[1])/(e[0]-t[0]);return 360*Math.atan(i)/(2*Math.PI)}}],(i=null)&&n(e.prototype,i),a&&n(e,a),t}();e.a=a},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,r;return e=t,r=[{key:"measureText",value:function(t,e,i){return i.measureText(t).width}},{key:"sort",value:function(t,e,i){if(t.length>0)return t.sort(function(t,n){if(i){var r=e[t.styleId],a=e[n.styleId];if(r.isImportant&&!a.isImportant)return-1;if(a.isImportant&&!r.isImportant)return 1}var s=t.weight,o=n.weight,h=t.primaryId,l=n.primaryId;return s||(s=-1),o||(o=-1),s<o?1:s==o&&h<l?1:-1}.bind(this))}},{key:"sortPrimaryId",value:function(t){if(t.length>0)return t.sort(function(t,e){var i=t.weight,n=e.weight,r=t.primaryId,a=e.primaryId;return i||(i=-1),n||(n=-1),i<n?1:i==n&&r<a?1:-1}.bind(this))}},{key:"groupByLabel",value:function(t){for(var e={},i=0;i<t.length;i++){var n=t[i];null==n.label&&null!=n.iconImg?(null==e[n.attributeId]&&(e[n.attributeId]=[]),e[n.attributeId].push(n)):(e[n.type+"_"+n.label]||(e[n.type+"_"+n.label]=[]),e[n.type+"_"+n.label].push(n))}return e}}],(i=null)&&n(e.prototype,i),r&&n(e,r),t}();e.a=r},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,r;return e=t,r=[{key:"pointDistToLine",value:function(t,e,i,n,r,a){var s=((t-i)*(r-i)+(e-n)*(a-n))/((i-r)*(i-r)+(n-a)*(n-a)),o=i+s*(r-i),h=n+s*(a-n);return Math.sqrt((t-o)*(t-o)+(e-h)*(e-h))}},{key:"isPointOnSegment",value:function(e,i,n,r,a,s){return e-5>n&&e+5>a||e+5<n&&e-5<a?0:i-5>r&&i+5>s||i+5<r&&i-5<s?0:t.pointDistToLine(e,i,n,r,a,s)<5?1:0}},{key:"pointInLine",value:function(e,i,n){var r=[];Array.isArray(n[0])?r=n:r.push(n);for(var a=0;a<r.length;a++)for(var s=r[a],o=s.length/2,h=0;h<o-1;h++){var l;l=h+1;var u=s[2*h],c=s[2*h+1],f=s[2*l],p=s[2*l+1];if(1==t.isPointOnSegment(e,i,u,c,f,p))return 1}return 0}},{key:"pointInPolygon",value:function(t,e,i){var n=0,r=[];Array.isArray(i[0])?r=i:r.push(i);for(var a=0;a<r.length;a++)for(var s=r[a],o=0,h=s.length/2,l=h-1;o<h;l=o,o++){var u=s[2*o],c=s[2*o+1],f=s[2*l],p=s[2*l+1];if(u===t&&c===e||f===t&&p===e)return 1;if(c<e&&p>=e||c>=e&&p<e){var d=u+(e-c)*(f-u)/(p-c);if(d===t)return 1;d>t&&(n=!n)}}return n?1:0}},{key:"lineIntersects",value:function(t,e,i,n,r,a,s,o){var h,l,u,c,f=[null,null];return 0===(h=(o-a)*(i-t)-(s-r)*(n-e))?null!==f[0]&&null!==f[1]&&f:(c=(i-t)*(l=e-a)-(n-e)*(u=t-r),l=((s-r)*l-(o-a)*u)/h,u=c/h,f[0]=t+l*(i-t),f[1]=e+l*(n-e),u>0&&u<1&&f)}},{key:"polyWith",value:function(e,i){for(var n,r,a,s,o,h,l,u,c=e.length/2,f=i.length/2,p=0;p<c;p++){p!=c-1?(r=e[2*p],a=e[2*p+1],s=e[2*p+2],n=e[2*p+3]):(r=e[2*p],a=e[2*p+1],s=e[0],n=e[1]);for(var d=0;d<f;d++)if(d!=f-1?(h=i[2*d],l=i[2*d+1],u=i[2*d+2],o=i[2*d+3]):(h=i[2*d],l=i[2*d+1],u=i[0],o=i[1]),0!=t.lineIntersects(r,a,s,n,h,l,u,o))return 1}var g=i[0],y=i[1];return t.pointInPolygon(g,y,e)?2:3}},{key:"boxToPolyArr",value:function(t,e,i,n){var r=[];return r.push(t),r.push(e),r.push(t),r.push(n),r.push(i),r.push(n),r.push(i),r.push(e),r.push(t),r.push(e),r}},{key:"getExtensionPoint",value:function(t,e,i){var n=e[0]-t[0],r=e[1]-t[1],a=e[0],s=e[1];if(0==n)s=r>0?e[1]+i:e[1]-i;else{var o=Math.sqrt(i*i/(r/n*(r/n)+1));n<0&&(o=-o),a=e[0]+o,s=e[1]+r/n*o}return[a,s]}},{key:"lineOffset",value:function(e,i){var n=[],r=[];return e.forEach(function(a,s){if(s!==e.length-1){var o=t.processSegment(a,e[s+1],i);if(n.push(o),s>0){var h=n[s-1],l=t.lineIntersects(o[0][0],o[0][1],o[1][0],o[1][1],h[0][0],h[0][1],h[1][0],h[1][1]);!1!==l&&(h[1]=l,o[0]=l),r.push(h[0]),s===e.length-2&&(r.push(o[0]),r.push(o[1]))}2===e.length&&(r.push(o[0]),r.push(o[1]))}}),r}},{key:"processSegment",value:function(t,e,i){var n=t[0],r=e[0],a=Math.sqrt((n[0]-r[0])*(n[0]-r[0])+(n[1]-r[1])*(n[1]-r[1])),s=n[0]+i*(r[1]-n[1])/a,o=r[0]+i*(r[1]-n[1])/a,h=n[1]+i*(n[0]-r[0])/a,l=r[1]+i*(n[0]-r[0])/a;return[[[s,h],t[1]],[[o,l],e[1]]]}},{key:"isInBox",value:function(t,e){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]<=e[2]&&t[3]<=e[3]}}],(i=null)&&n(e.prototype,i),r&&n(e,r),t}();e.a=r},function(t,e,i){"use strict";i.d(e,"e",function(){return l}),i.d(e,"d",function(){return u}),i.d(e,"f",function(){return f}),i.d(e,"a",function(){return p}),i.d(e,"c",function(){return d}),i.d(e,"b",function(){return g}),i.d(e,"i",function(){return v}),i.d(e,"h",function(){return m}),i.d(e,"k",function(){return _}),i.d(e,"g",function(){return x}),i.d(e,"j",function(){return L});var n={draw:{toolbar:{actions:{title:"取消绘制",text:"取消"},finish:{title:"完成绘制",text:"完成"},undo:{title:"清除最后一个绘制点",text:"清除最后一个点"},buttons:{polyline:"绘制折线",polygon:"绘制多边形",rectangle:"绘制矩形",circle:"绘制圆形",marker:"绘制标注"}},handlers:{circle:{tooltip:{start:"点击并且拖动绘制圆形"},radius:"半径"},marker:{tooltip:{start:"点击地图放置标记"}},polygon:{tooltip:{start:"点击开始绘制面",cont:"点击继续绘制面",end:"点击起点或双击结束绘制"}},polyline:{error:"<strong>错误:</strong> 形状边缘不能交叉!",tooltip:{start:"点击开始绘制线",cont:"点击继续绘制线",end:"点击最后一个点或双击结束绘制"}},rectangle:{tooltip:{start:"点击并且拖动绘制矩形"}},simpleshape:{tooltip:{end:"松开鼠标完成绘制"}}}},edit:{toolbar:{actions:{save:{title:"保存编辑",text:"保存"},cancel:{title:"取消编辑",text:"取消"}},buttons:{edit:"编辑图层",editDisabled:"没有可编辑的图层",remove:"删除图层",removeDisabled:"没有可删除的图层"}},handlers:{edit:{tooltip:{text:"拖动编辑要素",subtext:""}},remove:{tooltip:{text:"点击一个要素删除它"}}}}},r=i(0),a=i.n(r),s=a.a.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?a.a.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(a.a.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(a.a.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(i.style.visibility="inherit",a.a.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&a.a.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&a.a.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}});a.a.Map.mergeOptions({drawControlTooltips:!0});var o=s,h=(i(1),a.a.Handler.extend({includes:a.a.Evented.prototype,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=a.a.Util.extend({},this.options.shapeOptions,e.shapeOptions)),a.a.setOptions(this,e)},enable:function(){this._enabled||(a.a.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type}))},disable:function(){this._enabled&&(a.a.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(a.a.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new o(this._map),a.a.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(a.a.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,a.a.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){a.a.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){this._map.fire("draw:canceled",{layerType:this.type}),27===t.keyCode&&this.disable()}})),l=(i(10),h.extend({statics:{TYPE:"polyline"},Poly:a.a.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new a.a.DivIcon({iconSize:new a.a.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new a.a.DivIcon({iconSize:new a.a.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,showLength:!0,zIndexOffset:2e3},initialize:function(t,e){a.a.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=n.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=a.a.Util.extend({},this.options.drawError,e.drawError)),this.type=l.TYPE,h.prototype.initialize.call(this,t,e)},addHooks:function(){h.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new a.a.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new a.a.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=a.a.marker(this._map.getCenter(),{icon:a.a.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),a.a.Browser.touch||this._map.on("mouseup",this._onMouseUp,this),this._mouseMarker.on("mousedown",this._onMouseDown,this).on("mouseout",this._onMouseOut,this).on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("click",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){h.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){if(this._markers.length>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t))return this._showErrorTooltip(),!1;this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0)},completeShape:function(){this._markers.length<=1||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[this._poly.getLatLngs().length-1]);!this.options.allowIntersection&&t||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),a.a.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._map.fire("draw:drawvertex",{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=a.a.point(e.clientX,e.clientY)},_onMouseUp:function(t){if(this._mouseDownOrigin){var e=a.a.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(e)<9*(window.devicePixelRatio||1)&&this.addVertex(t.latlng)}this._mouseDownOrigin=null},_onTouch:function(t){},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new a.a.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers?this._markers.length:0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,n,r,s=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),o=this.options.guidelineDistance,h=this.options.maxGuideLineLength,l=s>h?s-h:o;for(this._guidesContainer||(this._guidesContainer=a.a.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));l<s;l+=this.options.guidelineDistance)i=l/s,n={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},(r=a.a.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer)).style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,a.a.DomUtil.setPosition(r,n)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,i=this.options.showLength;return 0===this._markers.length?t={text:n.draw.handlers.polyline.tooltip.start}:(e=i?this._getMeasurementString():"",t=1===this._markers.length?{text:n.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:n.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var i,n,r=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=r-(e?2:1),n=t.distanceTo(this._markers[i].getLatLng()),this._measurementRunningTotal+=n*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=this._measurementRunningTotal+e.distanceTo(i),a.a.Util.readableDistance(t,this.options.metric,this.options.feet)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(a.a.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);h.prototype._fireCreatedEvent.call(this,t)}}));a.a.geoway.control.drawPolyline=function(t,e){return new l(t,e)},a.a.geoway.control.DrawPolyline=l,a.a.Draw=a.a.Draw?a.a.Draw:{},a.a.Draw.Polyline=l;var u=l.extend({statics:{TYPE:"polygon"},Poly:a.a.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0},initialize:function(t,e){this.type=u.TYPE,l.prototype.initialize.call(this,t,e)},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=n.draw.handlers.polygon.tooltip.start:this._markers.length<3?t=n.draw.handlers.polygon.tooltip.cont:(t=n.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?a.a.Util.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=a.a.Util.geodesicArea(i)),l.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}});a.a.geoway.control.drawPolygon=function(t,e){return new u(t,e)},a.a.geoway.control.DrawPolygon=u,a.a.Draw=a.a.Draw?a.a.Draw:{},a.a.Draw.Polygon=u;var c=h.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=n.draw.handlers.simpleshape.tooltip.end,h.prototype.initialize.call(this,t,e)},addHooks:function(){h.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this))},removeHooks:function(){h.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),a.a.DomEvent.off(document,"mouseup",this._onMouseUp,this),a.a.DomEvent.off(document,"touchend",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,a.a.DomEvent.on(document,"mouseup",this._onMouseUp,this).on(document,"touchend",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),f=c.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0},initialize:function(t,e){this.type=f.TYPE,this._initialLabelText=n.draw.handlers.rectangle.tooltip.start,c.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setBounds(new a.a.LatLngBounds(this._startLatLng,t)):(this._shape=new a.a.Rectangle(new a.a.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new a.a.Rectangle(this._shape.getBounds(),this.options.shapeOptions);c.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,n=c.prototype._getTooltipText.call(this);return this._shape&&(t=this._shape.getLatLngs(),e=a.a.Util.geodesicArea(t),i=a.a.Util.readableArea(e,this.options.metric)),{text:n.text,subtext:i}}});a.a.geoway.control.drawRectangle=function(t,e){return new f(t,e)},a.a.geoway.control.DrawRectangle=f,a.a.Draw=a.a.Draw?a.a.Draw:{},a.a.Draw.Rectangle=f;var p=c.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0},initialize:function(t,e){this.type=p.TYPE,this._initialLabelText=n.draw.handlers.circle.tooltip.start,c.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new a.a.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new a.a.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);c.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,r=this.options.showRadius,s=this.options.metric;this._tooltip.updatePosition(i),this._isDrawing&&(this._drawShape(i),e=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:r?n.draw.handlers.circle.radius+": "+a.a.Util.readableDistance(e,s,this.options.feet):""}))}});a.a.geoway.control.drawCircle=function(t,e){return new p(t,e)},a.a.geoway.control.DrawCircle=p,a.a.Draw=a.a.Draw?a.a.Draw:{},a.a.Draw.Circle=p;var d=h.extend({statics:{TYPE:"marker"},options:{icon:new a.a.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=d.TYPE,h.prototype.initialize.call(this,t,e)},addHooks:function(){h.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:n.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=a.a.marker(this._map.getCenter(),{icon:a.a.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){h.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).off("click",this._onTouch,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=new a.a.Marker(e,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(t){this._onMouseMove(t),this._onClick()},_fireCreatedEvent:function(){var t=new a.a.Marker(this._marker.getLatLng(),{icon:this.options.icon});h.prototype._fireCreatedEvent.call(this,t)}});a.a.geoway.control.drawMarker=function(t,e){return new d(t,e)},a.a.geoway.control.DrawMarker=d,a.a.Draw=a.a.Draw?a.a.Draw:{},a.a.Draw.Marker=d;var g=a.a.Handler.extend({statics:{TYPE:"edit"},includes:a.a.Evented.prototype,initialize:function(t,e){if(a.a.Handler.prototype.initialize.call(this,t),a.a.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof a.a.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=g.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),a.a.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),a.a.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new o(this._map),this._tooltip.updateContent({text:n.edit.handlers.edit.tooltip.text,subtext:n.edit.handlers.edit.tooltip.subtext}),t._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on("draw:editvertex",this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off("click",this._editStyle,this).off("draw:editvertex",this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new a.a.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire("draw:edited",{layers:t})},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(t){var e=a.a.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof a.a.Polyline||t instanceof a.a.Polygon||t instanceof a.a.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof a.a.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof a.a.Marker&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}))},_backupLayer:function(t){var e=a.a.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof a.a.Polyline||t instanceof a.a.Polygon||t instanceof a.a.Rectangle?this._uneditedLayerProps[e]={latlngs:a.a.Util.cloneLatLngs(t.getLatLngs())}:t instanceof a.a.Circle?this._uneditedLayerProps[e]={latlng:a.a.Util.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:t instanceof a.a.Marker&&(this._uneditedLayerProps[e]={latlng:a.a.Util.cloneLatLng(t.getLatLng())}))},_getTooltipText:function(){return{text:n.edit.handlers.edit.tooltip.text,subtext:n.edit.handlers.edit.tooltip.subtext}},_enableLayerEdit:function(t){var e,i,n=t.layer||t.target||t;this._backupLayer(n),this.options.poly&&(i=a.a.Util.extend({},this.options.poly),n.options.poly=i),this.options.selectedPathOptions&&((e=a.a.Util.extend({},this.options.selectedPathOptions)).maintainColor&&(e.color=n.options.color,e.fillColor=n.options.fillColor),n.options.original=a.a.extend({},n.options),n.options.editing=e),this.isMarker?(n.dragging.enable(),n.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):n.editing.enable()},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,e.editing.disable(),delete e.options.editing,delete e.options.original,this._selectedPathOptions&&(e instanceof a.a.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof a.a.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):e.editing.disable()},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_onTouchMove:function(t){var e=t.originalEvent.changedTouches[0],i=this._map.mouseEventToLayerPoint(e),n=this._map.layerPointToLatLng(i);t.target.setLatLng(n)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}});a.a.geoway.control.drawEdit=function(t,e){return new g(t,e)},a.a.geoway.control.DrawEdit=g;var y=i(15),v=l.extend({initialize:function(t,e){l.prototype.initialize.call(this,t,e),this._cache=[]},addHooks:function(){l.prototype.addHooks.call(this),this._map&&(this._markerGroup=new a.a.LayerGroup,this._map.addLayer(this._markerGroup),this._markers=[],this._popups=[],this._map.on("click",this._onClick,this),this._startShape())},removeHooks:function(){this._clearHideErrorTimeout(),this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this).off("click",this._onClick,this),this._clearGuides(),this._container.style.cursor="",this._tooltip.dispose()},_startShape:function(){this._drawing=!0,this._poly=new a.a.Polyline([],this.options.shapeOptions),this._poly._onClick=function(){},this._container.style.cursor="crosshair",this._updateTooltip(),this._map.on("pointermove",this._onMouseMove,this).on("mousemove",this._onMouseMove,this)},_finishShape:function(){this._drawing=!1,this._cleanUpShape(),this._clearGuides(),this._updateTooltip(),this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this),this._container.style.cursor="",this.disable();var t="measure-"+a.a.stamp(this._poly),e={id:t,popups:this._popups,markers:this._markers,poly:this._poly};if(this._cache.push(e),this._tippopup){var i=a.a.DomUtil.create("div","leaflet-measure-tipclose");i.id=t,i.title="清除本次测距",this._tippopup._contentNode.appendChild(i);var n=this._tippopup._contentNode.offsetWidth;this._tippopup._contentNode.style.width=n+30+"px",a.a.DomEvent.on(i,"click",this._onTipClose,this)}},_removeShape:function(){if(!this._poly)return!1;this._map.removeLayer(this._poly),delete this._poly,this._markers.splice(0),this._markerGroup.clearLayers()},_onClick:function(){if(!this._drawing)return this._removeShape(),void this._startShape()},_getTooltipText:function(){var t=l.prototype._getTooltipText.call(this);return this._drawing||(t.text=""),t},addVertex:function(t){if(this._markers.length>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t))this._showErrorTooltip();else{this._errorShown&&this._hideErrorTooltip();var e=this._createMarker(t);a.a.DomEvent.on(e,"dblclick",this._preventMouseEvent,this);var i,n=this._getTooltipText(),r="";n.subtext?(r=n.subtext,i=46):(r="起点",i=40);var s=new y.a({offset:new a.a.Point(i,24)});s.setLatLng(t).setContent(r).openOn(this._map),s._sort="tip-popup",this._tippopup=s,this._popups.push(s),this._markers.push(e),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0)}},_onTipClose:function(t){var e=(t.target||t.srcElement).id,i=this._getCacheById(e);if(i){var n=i.popups,r=i.markers,a=i.poly;this._map.removeLayer(a);for(var s=0;s<r.length;s++)r[s]&&n[s]&&(this._map.removeLayer(r[s]),this._map.removeLayer(n[s]));this._deleteCacheById(e)}},_getCacheById:function(t){for(var e,i=0;i<this._cache.length;i++)if(this._cache[i].id==t){e=this._cache[i];break}return e},_deleteCacheById:function(t){for(var e=this._cache.length-1;e>=0;e--)if(this._cache[e].id==t){this._cache.splice(e,1);break}},_preventMouseEvent:function(t){"contextmenu"===t.type&&this.hasEventListeners(t.type)&&a.a.DomEvent.preventDefault(t),"mousedown"!==t.type?a.a.DomEvent.stopPropagation(t):a.a.DomEvent.preventDefault(t)},clear:function(){for(var t=this._cache,e=0;e<t.length;e++){var i=t[e],n=i.popups,r=i.markers,a=i.poly;this._map.removeLayer(a);for(var s=0;s<r.length;s++)r[s]&&n[s]&&(this._map.removeLayer(r[s]),this._map.removeLayer(n[s]))}this._popups=[],this._markers=[],this._poly=null,this._cache=[]}});a.a.geoway.control.measurePath=function(t,e){return new v(t,e)},a.a.geoway.control.MeasurePath=v,a.a.Measure=a.a.Measure?a.a.Measure:{},a.a.Measure.Path=v;var m=u.extend({options:{showArea:!0,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0},initialize:function(t,e){u.prototype.initialize.call(this,t,e),this._cache=[]},addHooks:function(){u.prototype.addHooks.call(this),this._map&&!this._areaGroup&&(this._areaGroup=new a.a.LayerGroup,this._map.addLayer(this._areaGroup))},removeHooks:function(){this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("click",this._onTouch,this),this._container.style.cursor="",this._tooltip.dispose()},_finishShape:function(){this._cleanUpShape(),this._clearGuides();var t=this._poly.getLatLngs(),e=t[t.length-1],i=this._poly.newLatLngIntersects(e);if(!this.options.allowIntersection&&i||!this._shapeIsValid())this._showErrorTooltip();else{var n=a.a.Util.geodesicArea(t);n=a.a.Util.readableArea(n,this.options.metric);var r=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);this._areaGroup.addLayer(r);var s="measure-"+a.a.stamp(r),o=new y.a({offset:new a.a.Point(36,-4)});o.setLatLng(e).setContent(n).openOn(this._map),o._sort="tip-popup";var h=a.a.DomUtil.create("div","leaflet-measure-tipclose");h.id=s,h.title="清除本次测面",o._contentNode.appendChild(h);var l=o._contentNode.offsetWidth;o._contentNode.style.width=l+30+"px",a.a.DomEvent.on(h,"click",this._onTipClose,this);var u={id:s,popup:o,poly:r};this._cache.push(u),this.disable()}},_onTipClose:function(t){var e=(t.target||t.srcElement).id,i=this._getCacheById(e);if(i){var n=i.popup,r=i.poly;this._map.removeLayer(r),this._map.removeLayer(n),this._deleteCacheById(e)}},_getCacheById:function(t){for(var e,i=0;i<this._cache.length;i++)if(this._cache[i].id==t){e=this._cache[i];break}return e},_deleteCacheById:function(t){for(var e=this._cache.length-1;e>=0;e--)if(this._cache[e].id==t){this._cache.splice(e,1);break}},clear:function(){for(var t=this._cache,e=0;e<t.length;e++){var i=t[e],n=i.popup,r=i.poly;this._map.removeLayer(r),this._map.removeLayer(n)}this._cache=[]}});a.a.geoway.control.measureArea=function(t,e){return new m(t,e)},a.a.geoway.control.MeasureArea=m,a.a.Measure=a.a.Measure?a.a.Measure:{},a.a.Measure.Area=m;var _=a.a.Control.extend({_map:null,includes:a.a.Evented?a.a.Evented.prototype:a.a.Mixin.Events,onAdd:function(t){this._map=t,this._container=a.a.DomUtil.create("div","leaflet-zoom-box-control leaflet-bar");var e=t.boxZoom._onMouseDown;return t.boxZoom._onMouseDown=function(i){2!==i.button&&e.call(t.boxZoom,{clientX:i.clientX,clientY:i.clientY,which:1,shiftKey:!0})},t.boxZoom._onMouseUp=function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){setTimeout(a.a.bind(this._resetState,this),0);var e=this._map.containerPointToLatLng(this._startPoint),i=this._map.containerPointToLatLng(this._point),n=new a.a.LatLngBounds(e,i);if(this.out){var r=n.getCenter(),s=this._map.getZoom()-1>=0?this._map.getZoom()-1:0;this._map.setView(r,s).fire("boxzoomend",{boxZoomBounds:n})}else this._map.fitBounds(n).fire("boxzoomend",{boxZoomBounds:n})}},t.on("boxzoomend",this.deactivate,this),this._container},activate:function(t){this._map.boxZoom.out=t.out,this._map.dragging.disable(),this._map.boxZoom.addHooks(),a.a.DomUtil.addClass(this._map.getContainer(),"leaflet-zoom-box-crosshair")},deactivate:function(){this._map.dragging.enable(),this._map.boxZoom.removeHooks(),a.a.DomUtil.removeClass(this._map.getContainer(),"leaflet-zoom-box-crosshair")}}),w=function(){return new _};a.a.geoway.control.zoomBox=w,a.a.geoway.control.ZoomBox=_,a.a.Control.ZoomBox=_,a.a.control.zoomBox=w;var b=a.a.Class.extend({initialize:function(t,e){this.zoom=t,this.centerPoint=e}}),x=a.a.Control.extend({options:{position:"topright",maxMovesToSave:100,useExternalControls:!0,backImage:"fa fa-caret-left",backText:"",backTooltip:"Go to Previous Extent",backImageBeforeText:!0,forwardImage:"fa fa-caret-right",forwardText:"",forwardTooltip:"Go to Next Extent",forwardImageBeforeText:!1,orientation:"horizontal",shouldSaveMoveInHistory:function(){return!0}},initialize:function(t){a.a.Util.setOptions(this,t),this._state.maxMovesToSave=this.options.maxMovesToSave},onAdd:function(t){this._map=t;var e=a.a.DomUtil.create("div","history-control leaflet-bar leaflet-control "+this.options.orientation);return this.options.useExternalControls||(this._backButton=this._createButton("back",e,this.goBack,this),this._forwardButton=this._createButton("forward",e,this.goForward,this)),this._updateDisabled(),this._addMapListeners(),e},onRemove:function(t){t.off("movestart")},performActionWithoutTriggeringEvent:function(t){this._state.ignoringEvents=!0,"function"==typeof t&&t()},moveWithoutTriggeringEvent:function(t){var e=this;this.performActionWithoutTriggeringEvent(function(){e._map.setView(t.centerPoint,t.zoom)})},goBack:function(){return this._invokeBackOrForward("historyback",this._state.history,this._state.future)},goForward:function(){return this._invokeBackOrForward("historyforward",this._state.future,this._state.history)},clearHistory:function(){this._state.history.items=[],this._updateDisabled()},clearFuture:function(){this._state.future.items=[],this._updateDisabled()},_map:null,_backButton:null,_forwardButton:null,_state:{backDisabled:null,forwardDisabled:null,ignoringEvents:!1,maxMovesToSave:0,history:{items:[]},future:{items:[]}},_createButton:function(t,e,i,n){var r=this.options[t+"Text"]||"",s=this.options[t+"Image"]||"",o=this.options[t+"Tooltip"]||"",h=a.a.DomUtil.create("a","history-"+t+"-button",e);if(s){var l='<i class="'+s+'"></i>';this.options[t+"ImageBeforeText"]?r=l+" "+r:r+=" "+l}h.innerHTML=r,h.href="#",h.title=o;var u=a.a.DomEvent.stopPropagation;return a.a.DomEvent.on(h,"click",u).on(h,"mousedown",u).on(h,"dblclick",u).on(h,"click",a.a.DomEvent.preventDefault).on(h,"click",i,n).on(h,"click",this._refocusOnMap,n),h},_updateDisabled:function(){var t=0===this._state.history.items.length,e=0===this._state.future.items.length;t!==this._state.backDisabled&&(this._state.backDisabled=t,this._map.fire("historyback"+(t?"disabled":"enabled"))),e!==this._state.forwardDisabled&&(this._state.forwardDisabled=e,this._map.fire("historyforward"+(e?"disabled":"enabled"))),this.options.useExternalControls||(this._setButtonDisabled(this._backButton,t),this._setButtonDisabled(this._forwardButton,e))},_setButtonDisabled:function(t,e){e?a.a.DomUtil.addClass(t,"leaflet-disabled"):a.a.DomUtil.removeClass(t,"leaflet-disabled")},_pop:function(t){if(t=t.items,a.a.Util.isArray(t)&&t.length>0)return t.splice(t.length-1,1)[0]},_push:function(t,e){var i=this._state.maxMovesToSave;t=t.items,a.a.Util.isArray(t)&&(t.push(e),i>0&&t.length>i&&t.splice(0,1))},_invokeBackOrForward:function(t,e,i){var n=this._popStackAndUseLocation(e,i);return!!n&&(this._map.fire(t,n),!0)},_popStackAndUseLocation:function(t,e){if(a.a.Util.isArray(t.items)&&t.items.length>0){var i=this._buildZoomCenterObjectFromCurrent(this._map),n=this._pop(t);return this._push(e,i),this.moveWithoutTriggeringEvent(n),{previousLocation:n,currentLocation:i}}},_buildZoomCenterObjectFromCurrent:function(t){return new b(t.getZoom(),t.getCenter())},_addMapListeners:function(){var t=this;this._map.on("movestart",function(e){if(t._state.ignoringEvents)t._state.ignoringEvents=!1;else{var i=t._buildZoomCenterObjectFromCurrent(e.target);t.options.shouldSaveMoveInHistory(i)&&(t._state.future.items=[],t._push(t._state.history,i))}t._updateDisabled()})}}),M=function(){return new x};a.a.geoway.control.history=M,a.a.geoway.control.History=x,a.a.Control.History=x,a.a.control.history=M;var L=a.a.Control.extend({options:{position:"bottomleft",separator:" : ",emptyString:"",lngFirst:!0,numDigits:5,lngFormatter:void 0,latFormatter:void 0,prefix:""},onAdd:function(t){return this._container=a.a.DomUtil.create("div","leaflet-control-mouseposition"),a.a.DomEvent.disableClickPropagation(this._container),t.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(t){t.off("mousemove",this._onMouseMove)},_onMouseMove:function(t){var e=this.options.lngFormatter?this.options.lngFormatter(t.latlng.lng):a.a.Util.formatNum(t.latlng.lng,this.options.numDigits),i=this.options.latFormatter?this.options.latFormatter(t.latlng.lat):a.a.Util.formatNum(t.latlng.lat,this.options.numDigits),n=this.options.lngFirst?e+this.options.separator+i:i+this.options.separator+e,r=this.options.prefix+" "+n;this._container.innerHTML=r}}),k=function(){return new L};a.a.geoway.control.mousePosition=k,a.a.geoway.control.MousePosition=L,a.a.Control.MousePosition=L,a.a.control.mousePosition=k,a.a.Map.mergeOptions({positionControl:!1}),a.a.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new a.a.geoway.control.MousePosition,this.addControl(this.positionControl))});var S=a.a.Marker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon"},initialize:function(t,e,i,n){this.latlng=t,this.latlngs=e,this.editor=i,a.a.Marker.prototype.initialize.call(this,t,n),this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.latlng.__vertex=this,this.editor.editLayer.addLayer(this),this.setZIndexOffset(i.tools._lastZIndex+1)},onAdd:function(t){a.a.Marker.prototype.onAdd.call(this,t),this.on("drag",this.onDrag),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("mouseup",this.onMouseup),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu),this.on("mousedown touchstart",this.onMouseDown),this.on("mouseover",this.onMouseOver),this.on("mouseout",this.onMouseOut),this.addMiddleMarkers()},onRemove:function(t){this.middleMarker&&this.middleMarker.delete(),delete this.latlng.__vertex,this.off("drag",this.onDrag),this.off("dragstart",this.onDragStart),this.off("dragend",this.onDragEnd),this.off("mouseup",this.onMouseup),this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),this.off("mousedown touchstart",this.onMouseDown),this.off("mouseover",this.onMouseOver),this.off("mouseout",this.onMouseOut),a.a.Marker.prototype.onRemove.call(this,t)},onDrag:function(t){t.vertex=this,this.editor.onVertexMarkerDrag(t);var e=a.a.DomUtil.getPosition(this._icon),i=this._map.layerPointToLatLng(e);this.latlng.update(i),this._latlng=this.latlng,this.editor.refresh(),this.middleMarker&&this.middleMarker.updateLatLng();var n=this.getNext();n&&n.middleMarker&&n.middleMarker.updateLatLng()},onDragStart:function(t){t.vertex=this,this.editor.onVertexMarkerDragStart(t)},onDragEnd:function(t){t.vertex=this,this.editor.onVertexMarkerDragEnd(t)},onClick:function(t){t.vertex=this,this.editor.onVertexMarkerClick(t)},onMouseup:function(t){a.a.DomEvent.stop(t),t.vertex=this,this.editor.map.fire("mouseup",t)},onContextMenu:function(t){t.vertex=this,this.editor.onVertexMarkerContextMenu(t)},onMouseDown:function(t){t.vertex=this,this.editor.onVertexMarkerMouseDown(t)},onMouseOver:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOver(t)},onMouseOut:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOut(t)},delete:function(){var t=this.getNext();this.latlngs.splice(this.getIndex(),1),this.editor.editLayer.removeLayer(this),this.editor.onVertexDeleted({latlng:this.latlng,vertex:this}),this.latlngs.length||this.editor.deleteShape(this.latlngs),t&&t.resetMiddleMarker(),this.editor.refresh()},getIndex:function(){return this.latlngs.indexOf(this.latlng)},getLastIndex:function(){return this.latlngs.length-1},getPrevious:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),e=t-1;0===t&&this.editor.CLOSED&&(e=this.getLastIndex());var i=this.latlngs[e];return i?i.__vertex:void 0}},getNext:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),e=t+1;t===this.getLastIndex()&&this.editor.CLOSED&&(e=0);var i=this.latlngs[e];return i?i.__vertex:void 0}},addMiddleMarker:function(t){this.editor.hasMiddleMarkers()&&(t=t||this.getPrevious())&&!this.middleMarker&&(this.middleMarker=this.editor.addMiddleMarker(t,this,this.latlngs,this.editor))},addMiddleMarkers:function(){if(this.editor.hasMiddleMarkers()){var t=this.getPrevious();t&&this.addMiddleMarker(t);var e=this.getNext();e&&e.resetMiddleMarker()}},resetMiddleMarker:function(){this.middleMarker&&this.middleMarker.delete(),this.addMiddleMarker()},split:function(){this.editor.splitShape&&this.editor.splitShape(this.latlngs,this.getIndex())},continue:function(){if(this.editor.continueBackward){var t=this.getIndex();0===t?this.editor.continueBackward(this.latlngs):t===this.getLastIndex()&&this.editor.continueForward(this.latlngs)}}}),C=a.a.Marker.extend({options:{opacity:.5,className:"leaflet-div-icon leaflet-middle-icon",draggable:!0},initialize:function(t,e,i,n,r){this.left=t,this.right=e,this.editor=n,this.latlngs=i,a.a.Marker.prototype.initialize.call(this,this.computeLatLng(),r),this._opacity=this.options.opacity,this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.editor.editLayer.addLayer(this),this.setVisibility()},setVisibility:function(){var t=this._map.latLngToContainerPoint(this.left.latlng),e=this._map.latLngToContainerPoint(this.right.latlng),i=a.a.point(this.options.icon.options.iconSize);t.distanceTo(e)<3*i.x?this.hide():this.show()},show:function(){this.setOpacity(this._opacity)},hide:function(){this.setOpacity(0)},updateLatLng:function(){this.setLatLng(this.computeLatLng()),this.setVisibility()},computeLatLng:function(){var t=this.editor.map.latLngToContainerPoint(this.left.latlng),e=this.editor.map.latLngToContainerPoint(this.right.latlng),i=(t.y+e.y)/2,n=(t.x+e.x)/2;return this.editor.map.containerPointToLatLng([n,i])},onAdd:function(t){a.a.Marker.prototype.onAdd.call(this,t),a.a.DomEvent.on(this._icon,"mousedown touchstart",this.onMouseDown,this),t.on("zoomend",this.setVisibility,this)},onRemove:function(t){delete this.right.middleMarker,a.a.DomEvent.off(this._icon,"mousedown touchstart",this.onMouseDown,this),t.off("zoomend",this.setVisibility,this),a.a.Marker.prototype.onRemove.call(this,t)},onMouseDown:function(t){var e=a.a.DomUtil.getPosition(this._icon);if(t={originalEvent:t,latlng:this.editor.map.layerPointToLatLng(e)},0!==this.options.opacity&&(O.makeCancellable(t),this.editor.onMiddleMarkerMouseDown(t),!t._cancelled)){this.latlngs.splice(this.index(),0,t.latlng),this.editor.refresh();var i=this._icon,n=this.editor.addVertexMarker(t.latlng,this.latlngs);this.editor.onNewVertex(n);var r=n._icon.parentNode;r.removeChild(n._icon),n._icon=i,r.appendChild(n._icon),n._initIcon(),n._initInteraction(),n.setOpacity(1),a.a.Draggable._dragging=!1,n.dragging._draggable._onDown(t.originalEvent),this.delete()}},delete:function(){this.editor.editLayer.removeLayer(this)},index:function(){return this.latlngs.indexOf(this.right.latlng)}}),T=a.a.DivIcon.extend({options:{iconSize:new a.a.Point(8,8)}}),P=T.extend({options:{iconSize:new a.a.Point(20,20)}}),E=a.a.Evented.extend({statics:{FORWARD:1,BACKWARD:-1},options:{zIndex:1e3,polygonClass:a.a.Polygon,polylineClass:a.a.Polyline,markerClass:a.a.Marker,rectangleClass:a.a.Rectangle,circleClass:a.a.Circle,drawingCSSClass:"leaflet-editable-drawing",drawingCursor:"crosshair",editLayer:void 0,featuresLayer:void 0,polylineEditorClass:void 0,polygonEditorClass:void 0,markerEditorClass:void 0,rectangleEditorClass:void 0,circleEditorClass:void 0,lineGuideOptions:{},skipMiddleMarkers:!1},initialize:function(t,e){a.a.setOptions(this,e),this._lastZIndex=this.options.zIndex,this.map=t,this.editLayer=this.createEditLayer(),this.featuresLayer=this.createFeaturesLayer(),this.forwardLineGuide=this.createLineGuide(),this.backwardLineGuide=this.createLineGuide()},fireAndForward:function(t,e){(e=e||{}).editTools=this,this.fire(t,e),this.map.fire(t,e)},createLineGuide:function(){var t=a.a.extend({dashArray:"5,10",weight:1,interactive:!1},this.options.lineGuideOptions);return a.a.polyline([],t)},createVertexIcon:function(t){return a.a.Browser.mobile&&a.a.Browser.touch?new P(t):new T(t)},createEditLayer:function(){return this.options.editLayer||(new a.a.LayerGroup).addTo(this.map)},createFeaturesLayer:function(){return this.options.featuresLayer||(new a.a.LayerGroup).addTo(this.map)},moveForwardLineGuide:function(t){this.forwardLineGuide._latlngs.length&&(this.forwardLineGuide._latlngs[1]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw())},moveBackwardLineGuide:function(t){this.backwardLineGuide._latlngs.length&&(this.backwardLineGuide._latlngs[1]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw())},anchorForwardLineGuide:function(t){this.forwardLineGuide._latlngs[0]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw()},anchorBackwardLineGuide:function(t){this.backwardLineGuide._latlngs[0]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw()},attachForwardLineGuide:function(){this.editLayer.addLayer(this.forwardLineGuide)},attachBackwardLineGuide:function(){this.editLayer.addLayer(this.backwardLineGuide)},detachForwardLineGuide:function(){this.forwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.forwardLineGuide)},detachBackwardLineGuide:function(){this.backwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.backwardLineGuide)},blockEvents:function(){this._oldTargets||(this._oldTargets=this.map._targets,this.map._targets={})},unblockEvents:function(){this._oldTargets&&(this.map._targets=a.a.extend(this.map._targets,this._oldTargets),delete this._oldTargets)},registerForDrawing:function(t){this._drawingEditor&&this.unregisterForDrawing(this._drawingEditor),this.blockEvents(),t.reset(),this._drawingEditor=t,this.map.on("mousemove touchmove",t.onDrawingMouseMove,t),this.map.on("mousedown",this.onMousedown,this),this.map.on("mouseup",this.onMouseup,this),a.a.DomUtil.addClass(this.map._container,this.options.drawingCSSClass),this.defaultMapCursor=this.map._container.style.cursor,this.map._container.style.cursor=this.options.drawingCursor},unregisterForDrawing:function(t){this.unblockEvents(),a.a.DomUtil.removeClass(this.map._container,this.options.drawingCSSClass),this.map._container.style.cursor=this.defaultMapCursor,(t=t||this._drawingEditor)&&(this.map.off("mousemove touchmove",t.onDrawingMouseMove,t),this.map.off("mousedown",this.onMousedown,this),this.map.off("mouseup",this.onMouseup,this),t===this._drawingEditor&&(delete this._drawingEditor,t._drawing&&t.cancelDrawing()))},onMousedown:function(t){1==t.originalEvent.which&&(this._mouseDown=t,this._drawingEditor.onDrawingMouseDown(t))},onMouseup:function(t){if(this._mouseDown){var e=this._drawingEditor,i=this._mouseDown;if(this._mouseDown=null,e.onDrawingMouseUp(t),this._drawingEditor!==e)return;var n=a.a.point(i.originalEvent.clientX,i.originalEvent.clientY),r=a.a.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(n);Math.abs(r)<9*(window.devicePixelRatio||1)&&this._drawingEditor.onDrawingClick(t)}},drawing:function(){return this._drawingEditor&&this._drawingEditor.drawing()},stopDrawing:function(){this.unregisterForDrawing()},commitDrawing:function(t){this._drawingEditor&&this._drawingEditor.commitDrawing(t)},connectCreatedToMap:function(t){return this.featuresLayer.addLayer(t)},startPolyline:function(t,e){var i=this.createPolyline([],e);return i.enableEdit(this.map).newShape(t),i},startPolygon:function(t,e){var i=this.createPolygon([],e);return i.enableEdit(this.map).newShape(t),i},startMarker:function(t,e){t=t||this.map.getCenter().clone();var i=this.createMarker(t,e);return i.enableEdit(this.map).startDrawing(),i},startRectangle:function(t,e){var i=t||a.a.latLng([0,0]),n=new a.a.LatLngBounds(i,i),r=this.createRectangle(n,e);return r.enableEdit(this.map).startDrawing(),r},startCircle:function(t,e){t=t||this.map.getCenter().clone();var i=this.createCircle(t,e);return i.enableEdit(this.map).startDrawing(),i},startHole:function(t,e){t.newHole(e)},createLayer:function(t,e,i){var n=new t(e,i=a.a.Util.extend({editOptions:{editTools:this}},i));return this.fireAndForward("editable:created",{layer:n}),n},createPolyline:function(t,e){return this.createLayer(e&&e.polylineClass||this.options.polylineClass,t,e)},createPolygon:function(t,e){return this.createLayer(e&&e.polygonClass||this.options.polygonClass,t,e)},createMarker:function(t,e){return this.createLayer(e&&e.markerClass||this.options.markerClass,t,e)},createRectangle:function(t,e){return this.createLayer(e&&e.rectangleClass||this.options.rectangleClass,t,e)},createCircle:function(t,e){return this.createLayer(e&&e.circleClass||this.options.circleClass,t,e)}});a.a.extend(E,{makeCancellable:function(t){t.cancel=function(){t._cancelled=!0}}}),a.a.Map.mergeOptions({editToolsClass:E,editable:!1,editOptions:{}}),a.a.Map.addInitHook(function(){this.whenReady(function(){this.options.editable&&(this.editTools=new this.options.editToolsClass(this,this.options.editOptions))})}),E.mergeOptions({vertexMarkerClass:S,middleMarkerClass:C}),a.a.LatLng.prototype.update=function(t){t=a.a.latLng(t),this.lat=t.lat,this.lng=t.lng};var A=a.a.LineUtil.isFlat||a.a.LineUtil._flat||a.a.Polyline._flat,I={createEditor:function(t){t=t||this._map;var e=(this.options.editOptions||{}).editTools||t.editTools;if(!e)throw Error("Unable to detect Editable instance.");return new(this.options.editorClass||this.getEditorClass(e))(t,this,this.options.editOptions)},enableEdit:function(t){return this.editor||this.createEditor(t),this.editor.enable(),this.editor},editEnabled:function(){return this.editor&&this.editor.enabled()},disableEdit:function(){this.editor&&(this.editor.disable(),delete this.editor)},toggleEdit:function(){this.editEnabled()?this.disableEdit():this.enableEdit()},_onEditableAdd:function(){this.editor&&this.enableEdit()}},D=function(){this.on("add",this._onEditableAdd)},O=E,F=a.a.Handler.extend({initialize:function(t,e,i){a.a.setOptions(this,i),this.map=t,this.feature=e,this.feature.editor=this,this.editLayer=new a.a.LayerGroup,this.tools=this.options.editTools||t.editTools},addHooks:function(){this.isConnected()?this.onFeatureAdd():this.feature.once("add",this.onFeatureAdd,this),this.onEnable(),this.feature.on(this._getEvents(),this)},removeHooks:function(){this.feature.off(this._getEvents(),this),this.feature.dragging&&this.feature.dragging.disable(),this.editLayer.clearLayers(),this.tools.editLayer.removeLayer(this.editLayer),this.onDisable(),this._drawing&&this.cancelDrawing()},drawing:function(){return!!this._drawing},reset:function(){},onFeatureAdd:function(){this.tools.editLayer.addLayer(this.editLayer),this.feature.dragging&&this.feature.dragging.enable()},hasMiddleMarkers:function(){return!this.options.skipMiddleMarkers&&!this.tools.options.skipMiddleMarkers},fireAndForward:function(t,e){(e=e||{}).layer=this.feature,this.feature.fire(t,e),this.tools.fireAndForward(t,e)},onEnable:function(){this.fireAndForward("editable:enable")},onDisable:function(){this.fireAndForward("editable:disable")},onEditing:function(){this.fireAndForward("editable:editing")},onStartDrawing:function(){this.fireAndForward("editable:drawing:start")},onEndDrawing:function(){this.fireAndForward("editable:drawing:end")},onCancelDrawing:function(){this.fireAndForward("editable:drawing:cancel")},onCommitDrawing:function(t){this.fireAndForward("editable:drawing:commit",t)},onDrawingMouseDown:function(t){this.fireAndForward("editable:drawing:mousedown",t)},onDrawingMouseUp:function(t){this.fireAndForward("editable:drawing:mouseup",t)},startDrawing:function(){this._drawing||(this._drawing=O.FORWARD),this.tools.registerForDrawing(this),this.onStartDrawing()},commitDrawing:function(t){this.onCommitDrawing(t),this.endDrawing()},cancelDrawing:function(){a.a.Draggable._dragging=!1,this.onCancelDrawing(),this.endDrawing()},endDrawing:function(){this._drawing=!1,this.tools.unregisterForDrawing(this),this.onEndDrawing()},onDrawingClick:function(t){this.drawing()&&(O.makeCancellable(t),this.fireAndForward("editable:drawing:click",t),t._cancelled||(this.isConnected()||this.connect(t),this.processDrawingClick(t)))},isConnected:function(){return this.map.hasLayer(this.feature)},connect:function(){this.tools.connectCreatedToMap(this.feature),this.tools.editLayer.addLayer(this.editLayer)},onMove:function(t){this.fireAndForward("editable:drawing:move",t)},onDrawingMouseMove:function(t){this.onMove(t)},_getEvents:function(){return{dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd,remove:this.disable}},onDragStart:function(t){this.onEditing(),this.fireAndForward("editable:dragstart",t)},onDrag:function(t){this.onMove(t),this.fireAndForward("editable:drag",t)},onDragEnd:function(t){this.fireAndForward("editable:dragend",t)}}),R=F.extend({addHooks:function(){F.prototype.addHooks.call(this),this._toggleMarkerHighlight()},removeHooks:function(){F.prototype.removeHooks.call(this),this._toggleMarkerHighlight()},onDrawingMouseMove:function(t){F.prototype.onDrawingMouseMove.call(this,t),this._drawing&&this.feature.setLatLng(t.latlng)},processDrawingClick:function(t){this.fireAndForward("editable:drawing:clicked",t),this.commitDrawing(t)},connect:function(t){t&&(this.feature._latlng=t.latlng),F.prototype.connect.call(this,t)},_toggleMarkerHighlight:function(){var t=this.feature._icon;t&&(t.style.display="none",a.a.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(a.a.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-3)):(a.a.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,3)),t.style.display="")},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,n=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=n+"px"}}),N={getEditorClass:function(t){return t&&t.options.markerEditorClass?t.options.markerEditorClass:R}};a.a.Marker&&(a.a.Marker.include(I),a.a.Marker.include(N),a.a.Marker.addInitHook(D));var B=F.extend({CLOSED:!1,MIN_VERTEX:2,addHooks:function(){return F.prototype.addHooks.call(this),this.feature&&this.initVertexMarkers(),this},initVertexMarkers:function(t){if(this.enabled())if(t=t||this.getLatLngs(),A(t))this.addVertexMarkers(t);else for(var e=0;e<t.length;e++)this.initVertexMarkers(t[e])},getLatLngs:function(){return this.feature.getLatLngs()},reset:function(){this.editLayer.clearLayers(),this.initVertexMarkers()},addVertexMarker:function(t,e){return new this.tools.options.vertexMarkerClass(t,e,this)},onNewVertex:function(t){this.fireAndForward("editable:vertex:new",{latlng:t.latlng,vertex:t})},addVertexMarkers:function(t){for(var e=0;e<t.length;e++)this.addVertexMarker(t[e],t)},refreshVertexMarkers:function(t){t=t||this.getDefaultLatLngs();for(var e=0;e<t.length;e++)t[e].__vertex.update()},addMiddleMarker:function(t,e,i){return new this.tools.options.middleMarkerClass(t,e,i,this)},onVertexMarkerClick:function(t){if(O.makeCancellable(t),this.fireAndForward("editable:vertex:click",t),!(t._cancelled||this.tools.drawing()&&this.tools._drawingEditor!==this)){var e,i=t.vertex.getIndex();t.originalEvent.ctrlKey?this.onVertexMarkerCtrlClick(t):t.originalEvent.altKey?this.onVertexMarkerAltClick(t):t.originalEvent.shiftKey?this.onVertexMarkerShiftClick(t):t.originalEvent.metaKey?this.onVertexMarkerMetaKeyClick(t):i===t.vertex.getLastIndex()&&this._drawing===O.FORWARD?i>=this.MIN_VERTEX-1&&(e=!0):0===i&&this._drawing===O.BACKWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX?e=!0:0===i&&this._drawing===O.FORWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX&&this.CLOSED?e=!0:this.onVertexRawMarkerClick(t),this.fireAndForward("editable:vertex:clicked",t),e&&this.commitDrawing(t)}},onVertexRawMarkerClick:function(t){this.fireAndForward("editable:vertex:rawclick",t),t._cancelled||this.vertexCanBeDeleted(t.vertex)&&t.vertex.delete()},vertexCanBeDeleted:function(t){return t.latlngs.length>this.MIN_VERTEX},onVertexDeleted:function(t){this.fireAndForward("editable:vertex:deleted",t)},onVertexMarkerCtrlClick:function(t){this.fireAndForward("editable:vertex:ctrlclick",t)},onVertexMarkerShiftClick:function(t){this.fireAndForward("editable:vertex:shiftclick",t)},onVertexMarkerMetaKeyClick:function(t){this.fireAndForward("editable:vertex:metakeyclick",t)},onVertexMarkerAltClick:function(t){this.fireAndForward("editable:vertex:altclick",t)},onVertexMarkerContextMenu:function(t){this.fireAndForward("editable:vertex:contextmenu",t)},onVertexMarkerMouseDown:function(t){this.fireAndForward("editable:vertex:mousedown",t)},onVertexMarkerMouseOver:function(t){this.fireAndForward("editable:vertex:mouseover",t)},onVertexMarkerMouseOut:function(t){this.fireAndForward("editable:vertex:mouseout",t)},onMiddleMarkerMouseDown:function(t){this.fireAndForward("editable:middlemarker:mousedown",t)},onVertexMarkerDrag:function(t){this.onMove(t),this.feature._bounds&&this.extendBounds(t),this.fireAndForward("editable:vertex:drag",t)},onVertexMarkerDragStart:function(t){this.fireAndForward("editable:vertex:dragstart",t)},onVertexMarkerDragEnd:function(t){this.fireAndForward("editable:vertex:dragend",t)},setDrawnLatLngs:function(t){this._drawnLatLngs=t||this.getDefaultLatLngs()},startDrawing:function(){this._drawnLatLngs||this.setDrawnLatLngs(),F.prototype.startDrawing.call(this)},startDrawingForward:function(){this.startDrawing()},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),F.prototype.endDrawing.call(this),delete this._drawnLatLngs},addLatLng:function(t){this._drawing===O.FORWARD?this._drawnLatLngs.push(t):this._drawnLatLngs.unshift(t),this.feature._bounds.extend(t);var e=this.addVertexMarker(t,this._drawnLatLngs);this.onNewVertex(e),this.refresh()},newPointForward:function(t){this.addLatLng(t),this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t)},newPointBackward:function(t){this.addLatLng(t),this.tools.anchorBackwardLineGuide(t)},push:function(t){if(!t)return console.error("L.Editable.PathEditor.push expect a valid latlng as parameter");this._drawing===O.FORWARD?this.newPointForward(t):this.newPointBackward(t)},removeLatLng:function(t){t.__vertex.delete(),this.refresh()},pop:function(){var t;if(!(this._drawnLatLngs.length<=1))return t=this._drawing===O.FORWARD?this._drawnLatLngs[this._drawnLatLngs.length-1]:this._drawnLatLngs[0],this.removeLatLng(t),this._drawing===O.FORWARD?this.tools.anchorForwardLineGuide(this._drawnLatLngs[this._drawnLatLngs.length-1]):this.tools.anchorForwardLineGuide(this._drawnLatLngs[0]),t},processDrawingClick:function(t){t.vertex&&t.vertex.editor===this||(this._drawing===O.FORWARD?this.newPointForward(t.latlng):this.newPointBackward(t.latlng),this.fireAndForward("editable:drawing:clicked",t))},onDrawingMouseMove:function(t){F.prototype.onDrawingMouseMove.call(this,t),this._drawing&&(this.tools.moveForwardLineGuide(t.latlng),this.tools.moveBackwardLineGuide(t.latlng))},refresh:function(){this.feature.redraw(),this.onEditing()},newShape:function(t){var e=this.addNewEmptyShape();e&&(this.setDrawnLatLngs(e[0]||e),this.startDrawingForward(),this.fireAndForward("editable:shape:new",{shape:e}),t&&this.newPointForward(t))},deleteShape:function(t,e){var i={shape:t};if(O.makeCancellable(i),this.fireAndForward("editable:shape:delete",i),!i._cancelled)return t=this._deleteShape(t,e),this.ensureNotFlat&&this.ensureNotFlat(),this.feature.setLatLngs(this.getLatLngs()),this.refresh(),this.reset(),this.fireAndForward("editable:shape:deleted",{shape:t}),t},_deleteShape:function(t,e){if((e=e||this.getLatLngs()).length){var i=this,n=function(t,e){return t.splice(t.indexOf(e),1),t.length||i._deleteShape(t),e};if(e===t)return function(t,e){return t.splice(0,Number.MAX_VALUE)}(e);for(var r=0;r<e.length;r++){if(e[r]===t)return n(e,t);if(-1!==e[r].indexOf(t))return n(e[r],t)}}},deleteShapeAt:function(t){var e=this.feature.shapeAt(t);if(e)return this.deleteShape(e)},appendShape:function(t){this.insertShape(t)},prependShape:function(t){this.insertShape(t,0)},insertShape:function(t,e){this.ensureMulti(),t=this.formatShape(t),void 0===e&&(e=this.feature._latlngs.length),this.feature._latlngs.splice(e,0,t),this.feature.redraw(),this._enabled&&this.reset()},extendBounds:function(t){this.feature._bounds.extend(t.vertex.latlng)},onDragStart:function(t){this.editLayer.clearLayers(),F.prototype.onDragStart.call(this,t)},onDragEnd:function(t){this.initVertexMarkers(),F.prototype.onDragEnd.call(this,t)}}),z=B.extend({startDrawingBackward:function(){this._drawing=O.BACKWARD,this.startDrawing()},continueBackward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachBackwardLineGuide(),this.tools.anchorBackwardLineGuide(t[0])),this.startDrawingBackward())},continueForward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t[t.length-1])),this.startDrawingForward())},getDefaultLatLngs:function(t){return!(t=t||this.feature._latlngs).length||t[0]instanceof a.a.LatLng?t:this.getDefaultLatLngs(t[0])},ensureMulti:function(){this.feature._latlngs.length&&A(this.feature._latlngs)&&(this.feature._latlngs=[this.feature._latlngs])},addNewEmptyShape:function(){if(this.feature._latlngs.length){var t=[];return this.appendShape(t),t}return this.feature._latlngs},formatShape:function(t){return A(t)?t:t[0]?this.formatShape(t[0]):void 0},splitShape:function(t,e){if(e&&!(e>=t.length-1)){this.ensureMulti();var i=this.feature._latlngs.indexOf(t);if(-1!==i){var n=t.slice(0,e+1),r=t.slice(e);r[0]=a.a.latLng(r[0].lat,r[0].lng,r[0].alt),this.feature._latlngs.splice(i,1,n,r),this.refresh(),this.reset()}}}}),U={getEditorClass:function(t){return t&&t.options.polylineEditorClass?t.options.polylineEditorClass:z},shapeAt:function(t,e){var i=null;if(!(e=e||this._latlngs).length)return i;if(A(e)&&this.isInLatLngs(t,e))i=e;else for(var n=0;n<e.length;n++)if(this.isInLatLngs(t,e[n]))return e[n];return i},isInLatLngs:function(t,e){if(!e)return!1;var i,n,r,s,o=[],h=this._clickTolerance();if(this._projectLatlngs(e,o,this._pxBounds),o=o[0],s=this._map.latLngToLayerPoint(t),!this._pxBounds.contains(s))return!1;for(i=1,r=o.length,n=0;i<r;n=i++)if(a.a.LineUtil.pointToSegmentDistance(s,o[n],o[i])<=h)return!0;return!1}};a.a.Polyline&&(a.a.Polyline.include(I),a.a.Polyline.include(U),a.a.Polyline.addInitHook(D));var G=B.extend({CLOSED:!0,MIN_VERTEX:3,newPointForward:function(t){B.prototype.newPointForward.call(this,t),this.tools.backwardLineGuide._latlngs.length||this.tools.anchorBackwardLineGuide(t),2===this._drawnLatLngs.length&&this.tools.attachBackwardLineGuide()},addNewEmptyHole:function(t){this.ensureNotFlat();var e=this.feature.shapeAt(t);if(e){var i=[];return e.push(i),i}},newHole:function(t){var e=this.addNewEmptyHole(t);e&&(this.setDrawnLatLngs(e),this.startDrawingForward(),t&&this.newPointForward(t))},addNewEmptyShape:function(){if(this.feature._latlngs.length&&this.feature._latlngs[0].length){var t=[];return this.appendShape(t),t}return this.feature._latlngs},ensureMulti:function(){this.feature._latlngs.length&&A(this.feature._latlngs[0])&&(this.feature._latlngs=[this.feature._latlngs])},ensureNotFlat:function(){this.feature._latlngs.length&&!A(this.feature._latlngs)||(this.feature._latlngs=[this.feature._latlngs])},vertexCanBeDeleted:function(t){var e=this.feature.parentShape(t.latlngs);return a.a.Util.indexOf(e,t.latlngs)>0||B.prototype.vertexCanBeDeleted.call(this,t)},getDefaultLatLngs:function(){return this.feature._latlngs.length||this.feature._latlngs.push([]),this.feature._latlngs[0]},formatShape:function(t){return!A(t)||t[0]&&0===t[0].length?t:[t]}}),j={getEditorClass:function(t){return t&&t.options.polygonEditorClass?t.options.polygonEditorClass:G},shapeAt:function(t,e){var i=null;if(!(e=e||this._latlngs).length)return i;if(A(e)&&this.isInLatLngs(t,e))i=e;else if(A(e[0])&&this.isInLatLngs(t,e[0]))i=e;else for(var n=0;n<e.length;n++)if(this.isInLatLngs(t,e[n][0]))return e[n];return i},isInLatLngs:function(t,e){var i,n,r,a,s,o=!1;for(r=0,a=(s=e.length)-1;r<s;a=r++)i=e[r],n=e[a],i.lat>t.lat!=n.lat>t.lat&&t.lng<(n.lng-i.lng)*(t.lat-i.lat)/(n.lat-i.lat)+i.lng&&(o=!o);return o},parentShape:function(t,e){if(e=e||this._latlngs){var i=a.a.Util.indexOf(e,t);if(-1!==i)return e;for(var n=0;n<e.length;n++)if(-1!==(i=a.a.Util.indexOf(e[n],t)))return e[n]}}};a.a.Polygon&&(a.a.Polygon.include(I),a.a.Polygon.include(j));var q=B.extend({CLOSED:!0,MIN_VERTEX:4,options:{skipMiddleMarkers:!0},extendBounds:function(t){var e=t.vertex.getIndex(),i=t.vertex.getNext(),n=t.vertex.getPrevious(),r=(e+2)%4,s=t.vertex.latlngs[r],o=new a.a.LatLngBounds(t.latlng,s);n.latlng.update([t.latlng.lat,s.lng]),i.latlng.update([s.lat,t.latlng.lng]),this.updateBounds(o),this.refreshVertexMarkers()},onDrawingMouseDown:function(t){B.prototype.onDrawingMouseDown.call(this,t),this.connect();var e=this.getDefaultLatLngs();3===e.length&&e.push(t.latlng);var i=new a.a.LatLngBounds(t.latlng,t.latlng);this.updateBounds(i),this.updateLatLngs(i),this.refresh(),this.reset(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),e[3].__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,B.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,B.prototype.onDrawingMouseMove.call(this,t)},getDefaultLatLngs:function(t){return t||this.feature._latlngs[0]},updateBounds:function(t){this.feature._bounds=t},updateLatLngs:function(t){for(var e=this.getDefaultLatLngs(),i=this.feature._boundsToLatLngs(t),n=0;n<e.length;n++)e[n].update(i[n])}}),V={getEditorClass:function(t){return t&&t.options.rectangleEditorClass?t.options.rectangleEditorClass:q}};a.a.Rectangle&&(a.a.Rectangle.include(I),a.a.Rectangle.include(V));var W=B.extend({MIN_VERTEX:2,options:{skipMiddleMarkers:!0},initialize:function(t,e,i){B.prototype.initialize.call(this,t,e,i),this._resizeLatLng=this.computeResizeLatLng()},computeResizeLatLng:function(){var t=(this.feature._radius||this.feature._mRadius)*Math.cos(Math.PI/4),e=this.map.project(this.feature._latlng);return this.map.unproject([e.x+t,e.y-t])},updateResizeLatLng:function(){this._resizeLatLng.update(this.computeResizeLatLng()),this._resizeLatLng.__vertex.update()},getLatLngs:function(){return[this.feature._latlng,this._resizeLatLng]},getDefaultLatLngs:function(){return this.getLatLngs()},onVertexMarkerDrag:function(t){1===t.vertex.getIndex()?this.resize(t):this.updateResizeLatLng(t),B.prototype.onVertexMarkerDrag.call(this,t)},resize:function(t){var e=this.feature._latlng.distanceTo(t.latlng);this.feature.setRadius(e)},onDrawingMouseDown:function(t){B.prototype.onDrawingMouseDown.call(this,t),this._resizeLatLng.update(t.latlng),this.feature._latlng.update(t.latlng),this.connect(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),this._resizeLatLng.__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,B.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,B.prototype.onDrawingMouseMove.call(this,t)},onDrag:function(t){B.prototype.onDrag.call(this,t),this.feature.dragging.updateLatLng(this._resizeLatLng)}}),H={getEditorClass:function(t){return t&&t.options.circleEditorClass?t.options.circleEditorClass:W}};a.a.Circle&&(a.a.Circle.include(I),a.a.Circle.include(H));var Z=a.a.Draggable.extend({initialize:function(t){this._path=t,this._canvas=t._map.getRenderer(t)instanceof a.a.Canvas;var e=this._canvas?this._path._map.getRenderer(this._path)._container:this._path._path;a.a.Draggable.prototype.initialize.call(this,e,e,!0)},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("drag",t)},_onDown:function(t){var e=t.touches?t.touches[0]:t;this._startPoint=new a.a.Point(e.clientX,e.clientY),this._canvas&&!this._path._containsPoint(this._path._map.mouseEventToLayerPoint(e))||a.a.Draggable.prototype._onDown.call(this,t)}}),X=a.a.Handler.extend({initialize:function(t){this._path=t},getEvents:function(){return{dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd}},addHooks:function(){this._draggable||(this._draggable=new Z(this._path)),this._draggable.on(this.getEvents(),this).enable(),a.a.DomUtil.addClass(this._draggable._element,"leaflet-path-draggable")},removeHooks:function(){this._draggable.off(this.getEvents(),this).disable(),a.a.DomUtil.removeClass(this._draggable._element,"leaflet-path-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._startPoint=this._draggable._startPoint,this._path.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(t){var e=this._path,i=t.originalEvent.touches&&1===t.originalEvent.touches.length?t.originalEvent.touches[0]:t.originalEvent,n=a.a.point(i.clientX,i.clientY),r=e._map.layerPointToLatLng(n);this._offset=n.subtract(this._startPoint),this._startPoint=n,this._path.eachLatLng(this.updateLatLng,this),e.redraw(),t.latlng=r,t.offset=this._offset,e.fire("drag",t),t.latlng=this._path.getCenter?this._path.getCenter():this._path.getLatLng(),e.fire("move",t)},_onDragEnd:function(t){this._path._bounds&&this.resetBounds(),this._path.fire("moveend").fire("dragend",t)},latLngToLayerPoint:function(t){return this._path._map.project(a.a.latLng(t))._subtract(this._path._map.getPixelOrigin())},updateLatLng:function(t){var e=this.latLngToLayerPoint(t);e._add(this._offset);var i=this._path._map.layerPointToLatLng(e);t.lat=i.lat,t.lng=i.lng},resetBounds:function(){this._path._bounds=new a.a.LatLngBounds,this._path.eachLatLng(function(t){this._bounds.extend(t)})}});a.a.Path.include({eachLatLng:function(t,e){e=e||this;!function i(n){for(var r=0;r<n.length;r++)a.a.Util.isArray(n[r])?i(n[r]):t.call(e,n[r])}(this.getLatLngs?this.getLatLngs():[this.getLatLng()])}}),a.a.Path.addInitHook(function(){this.dragging=new X(this),this.options.draggable&&this.once("add",function(){this.dragging.enable()})})},function(t,e,i){"use strict";var n=i(0),r=i.n(n);r.a.extend(r.a.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),r.a.extend(r.a.Util,{proxyUtil:function(t,e){var i,n;if("string"==typeof e&&(n=t[e],e=t,t=n),"function"==typeof t)return i=Array.prototype.slice.call(arguments,2),function(){return t.apply(e||this,i.concat(Array.prototype.slice.call(arguments)))}},writeGeometryToWKT:function(t,e){var i;if("point"==e.toLowerCase())i="POINT("+t.lng+" "+t.lat+")";else if("line"==e.toLowerCase()){i="LINESTRING(";for(var n=[],r=0;r<t.length;r++)n.push(t[r].lng+" "+t[r].lat);i+=n.join(","),i+=")"}else if("polygon"==e.toLowerCase()){i="POLYGON(";for(var a=[],s=0;s<t.length;s++){for(var o=[],h=0;h<t[s].length;h++)o.push(t[s][h].lng+" "+t[s][h].lat),s==t.length-1&&h==t[s].length-1&&o.push(t[0][0].lng+" "+t[0][0].lat);a.push("("+o.join(",")+")")}i+=a.join(","),i+=")"}return i},getParam:function(t){for(var e=document.location.search.substring(1).split("&"),i=0;i<e.length;i++){var n=e[i];if(0==n.indexOf(t+"=")){var r=n.substring(t.length+1);return decodeURIComponent(r)}}},geodesicArea:function(t){var e,i,n=t.length,a=0,s=r.a.LatLng.DEG_TO_RAD;if(n>2){for(var o=0;o<n;o++)e=t[o],a+=((i=t[(o+1)%n]).lng-e.lng)*s*(2+Math.sin(e.lat*s)+Math.sin(i.lat*s));a=6378137*a*6378137/2}return Math.abs(a)},readableArea:function(t,e){return e?t>=1e6?(1e-6*t).toFixed(2)+" 平方公里":t.toFixed(2)+" 平方米;":(t/=.836127)>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"},readableDistance:function(t,e,i){var n;if(e)n=t>1e3?(t/1e3).toFixed(2)+" 千米":Math.ceil(t)+" 米";else if((t*=1.09361)>1760)n=(t/1760).toFixed(2)+" miles";else{var r=" yd";i&&(t*=3,r=" ft"),n=Math.ceil(t)+r}return n},tryFunc:function(){for(var t=null,e=0,i=arguments.length;e<i;e++){var n=arguments[e];try{t=n();break}catch(t){}}return t},bind:function(t,e){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var n=i.concat(Array.prototype.slice.apply(arguments,[0]));return t.apply(e,n)}},applyDefaults:function(t,e){t=t||{};var i="function"==typeof window.Event&&e instanceof window.Event;for(var n in e)(void 0===t[n]||!i&&e.hasOwnProperty&&e.hasOwnProperty(n)&&!t.hasOwnProperty(n))&&(t[n]=e[n]);return!i&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!t.hasOwnProperty("toString")&&(t.toString=e.toString),t},cloneLatLngs:function(t){for(var e=[],i=0,n=t.length;i<n;i++)Array.isArray(t[i])?e.push(r.a.Util.cloneLatLngs(t[i])):e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return r.a.latLng(t.lat,t.lng)},meterToDegree:function(t){return t/(2*Math.PI*6371004)*360},degreeToMeter:function(t){return 2*Math.PI*6371004*360*t}}),r.a.Polyline.include({intersects:function(){var t,e,i,n=this._originalPoints,r=n?n.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=r-1;t>=3;t--)if(e=n[t-1],i=n[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(t),e)},newPointIntersects:function(t,e){var i=this._originalPoints,n=i?i.length:0,r=i?i[n-1]:null,a=n-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(r,t,a,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._originalPoints,i=e?e.length:0;return i+=t||0,!this._originalPoints||i<=3},_lineSegmentsIntersectsRange:function(t,e,i,n){var a,s,o=this._originalPoints;n=n||0;for(var h=i;h>n;h--)if(a=o[h-1],s=o[h],r.a.LineUtil.segmentsIntersect(t,e,a,s))return!0;return!1}}),r.a.Polygon.include({intersects:function(){var t,e,i,n,a=this._originalPoints;return!this._tooFewPointsForIntersection()&&(!!r.a.Polyline.prototype.intersects.call(this)||(t=a.length,e=a[0],i=a[t-1],n=t-2,this._lineSegmentsIntersectsRange(i,e,n,1)))}})},function(t,e,i){"use strict";i.d(e,"d",function(){return o}),i.d(e,"g",function(){return u}),i.d(e,"c",function(){return c}),i.d(e,"f",function(){return f}),i.d(e,"b",function(){return p}),i.d(e,"e",function(){return d}),i.d(e,"a",function(){return m});var n=i(0),r=i.n(n),a=(i(1),r.a.Class.extend({options:{plan:null},initialize:function(t){r.a.setOptions(this,t)},getDistance:function(){var t=this.options.plan;return t?parseInt(t.distance/1e3)+"公里":null},getDuration:function(){var t=this.options.plan;return t?this._formatMinute(t.duration):null},getNumSteps:function(){var t=this.options.plan;return t?t.steps.length:null},getStep:function(t){var e=this.options.plan;return e?e.steps[t]:null},_formatMinute:function(t){var e=parseInt(t),i=0;e>60&&(i=parseInt(e/60),e=parseInt(e%60));var n=0;return i>0&&(n=parseInt(i)+"小时"),n=n+e+"分钟"}})),s=i(3),o=r.a.Class.extend({options:{url:null,policy:0,onSearchComplete:null,start:null,end:null,waypoints:[],currentResult:null},initialize:function(t,e){this.map=t,r.a.setOptions(this,e)},setPolicy:function(t,e){this.options.policy=t,e||this._search()},search:function(t,e){t instanceof r.a.LatLng&&e instanceof r.a.LatLng?(this.options.start=t,this.options.end=e,this._search()):this._failFn()},setWayPoints:function(t,e){t&&t.length>0&&(this.options.waypoints=t,e||this._search())},getWayPoints:function(){return this.options.waypoints},clearResults:function(){this.options.policy=0,this.options.start=null,this.options.end=null,this.options.currentResult=null},getResults:function(){return this.options.currentResult},getStart:function(){return this.options.start},getEnd:function(){return this.options.end},getNumPlans:function(){var t=this.options.currentResult;return t&&"ok"==t.status.toLowerCase()?t.totalCount:0},getPlan:function(t){var e,i=this.getNumPlans();if(i>0){var n=this.options.currentResult.results;if("number"==typeof t&&isFinite(t)&&t<=i)return e=n[t],new a({plan:e})}return!1},_failFn:function(){this.options.onSearchComplete&&this.options.onSearchComplete.call(this,{msg:"起始点参数不正确，请传入L.LatLng类型参数",status:"error"})},_search:function(){var t=this._queryParam();if(t){var e=this;s.a.get(t).then(function(t){e.options.currentResult=t,e.options.onSearchComplete&&e.options.onSearchComplete.call(e,t)})}},_queryParam:function(){var t=this.options.url,e=this.options.start,i=this.options.end,n=this.options.policy;if(e&&i&&t){t=t+"?format=json&origin="+(e.lng+","+e.lat)+"&destination="+(i.lng+","+i.lat)+"&mode="+n;var r=this.getWayPoints();if(r&&r.length>0){for(var a=[],s=0;s<r.length;s++){var o=r[s].lng+","+r[s].lat;a.push(o)}t+="&waypoints="+a.join(";")}return t}return!1}});r.a.geoway.service.routeService=function(t,e){return new o(t,e)},r.a.geoway.service.RouteService=o,r.a.DrivingRoute=o;var h=i(22),l=i(23),u=r.a.Class.extend({options:{url:"https://api.tianditu.gov.cn/drive",tk:"ffa5ef8e4ea43caf693fa0097f8258a6",policy:0,onSearchComplete:null,start:null,end:null,waypoints:[],currentResult:null},initialize:function(t,e){this.map=t,r.a.setOptions(this,e)},setPolicy:function(t,e){this.options.policy=t,e||this._search()},search:function(t,e){t instanceof r.a.LatLng&&e instanceof r.a.LatLng?(this.options.start=t,this.options.end=e,this._search()):this._failFn()},setWayPoints:function(t,e){t&&t.length>0&&(this.options.waypoints=t,e||this._search())},getWayPoints:function(){return this.options.waypoints},clearResults:function(){this.options.policy=0,this.options.start=null,this.options.end=null,this.options.currentResult=null},getResults:function(){return this.options.currentResult},getStart:function(){return this.options.start},getEnd:function(){return this.options.end},_failFn:function(){this.options.onSearchComplete&&this.options.onSearchComplete.call(this,{msg:"起始点参数不正确，请传入L.LatLng类型参数",status:"error"})},_search:function(){var t=this._queryParam();if(t){var e=this;s.a.get(t).then(function(t){var i=new h.a,n=new l.a(i.read(t.bodyText));e.options.currentResult=n,e.options.onSearchComplete&&e.options.onSearchComplete.call(e,n)})}},_queryParam:function(){var t=this.options.url,e=this.options.start,i=this.options.end,n=this.options.policy;if(e&&i&&t){var r=this.getWayPoints(),a="";if(r&&r.length>0){for(var s=[],o=0;o<r.length;o++){var h=r[o].lng+","+r[o].lat;s.push(h)}a=s.join(";")}var l=e.lng+","+e.lat,u=i.lng+","+i.lat,c={};c.orig=l,c.dest=u,c.style=n,c.mid=a;for(var f=["orig","dest","style","mid"],p="?postStr=",d=[],g=0;g<f.length;g++){var y=f[g];y in c&&d.push("'"+y+"':'"+c[y]+"'")}return p+="{"+d.join(",")+"}",t+=p+="&type=search&tk="+this.options.tk}return!1}});r.a.geoway.service.tRouteService=function(t,e){return new u(t,e)},r.a.geoway.service.TRouteService=u,r.a.TDrivingRoute=u;var c=r.a.Class.extend({options:{url:null,pageNum:0,pageSize:10,onSearchComplete:null,param:null,resultType:0,currentResult:null},initialize:function(t,e){this.map=t,r.a.setOptions(this,e)},setUrl:function(t){this.options.url=t},setPageSize:function(t){this.options.pageSize=t},getPageSize:function(){return this.options.pageSize},setSearchCompleteCallback:function(t){this.options.onSearchComplete=t},search:function(t,e){switch(e){case 1:this.options.resultType=1,this._search(t,null);break;case 2:this.options.resultType=2,this._searchInView(t,null);break;case 3:this.options.resultType=3,this._searchStatistics(t,null)}},searchBySort:function(t,e){switch(e){case 1:this.options.resultType=4,this._search(null,t);break;case 2:this.options.resultType=5,this._searchInView(null,t);break;case 3:this.options.resultType=6,this._searchStatistics(null,t)}},searchInBounds:function(t,e){this.options.resultType=7,e instanceof r.a.LatLngBounds&&(e=[e.getSouth(),e.getWest(),e.getNorth(),e.getEast()].join(","));var i={keyword:t,bounds:e,pageNum:this.options.pageNum,pageSize:this.options.pageSize};this.options.param=i;var n=this._queryParam(i);n&&this._doQuery(n)},searchInBoundsBySort:function(t,e){this.options.resultType=8,e instanceof r.a.LatLngBounds&&(e=[e.getSouth(),e.getWest(),e.getNorth(),e.getEast()].join(","));var i={sort:t,bounds:e,pageNum:this.options.pageNum,pageSize:this.options.pageSize};this.options.param=i;var n=this._queryParam(i);n&&this._doQuery(n)},searchNearby:function(t,e,i){this.options.resultType=9;var n={keyword:t,center:e,radius:i,pageNum:this.options.pageNum,pageSize:this.options.pageSize};this.options.param=n;var r=this._queryBufferParam(n);r&&this._doQuery(r)},searchNearbyBySort:function(t,e,i){this.options.resultType=10;var n={sort:t,center:e,radius:i,pageNum:this.options.pageNum,pageSize:this.options.pageSize};this.options.param=n;var r=this._queryBufferParam(n);r&&this._doQuery(r)},getResults:function(){return this.options.currentResult},clearResults:function(){this.options.currentResult=null,this.options.pageNum=0},getTotalPage:function(){var t,e=this.options.currentResult;if(e){var i=e.totalCount;i&&i>0&&(t=Math.ceil(i/this.options.pageSize)-1)}return t},firstPage:function(){this.gotoPage(0)},nextPage:function(){var t=this.options.param.pageNum;this.gotoPage(t+1)},previousPage:function(){var t=this.options.param.pageNum;this.gotoPage(t-1)},lastPage:function(){var t=this.getTotalPage();this.gotoPage(t)},gotoPage:function(t){var e,i=this.options.param,n=this.getTotalPage();i&&n&&(t>n?t=n:t<0&&(t=0),i.pageNum=t,(e=i.radius?this._queryBufferParam(i):this._queryParam(i))&&this._doQuery(e))},searchNear:function(t){this.options.resultType=11;var e=this.options.url;if(!e)return!1;e=e+"/nearest?location="+t.lat+","+t.lng;var i=this;s.a.get(e).then(function(t){i.options.onSearchComplete&&i.options.onSearchComplete.call(i,t,i.options.resultType)})},searchById:function(t,e,i){var n=this.options.url;if(!n)return!1;n=n+"/detail?id="+t;var r=this;s.a.get(n).then(function(t){e.call(r,t)}).catch(function(t){i&&i.call(r,t)})},_doQuery:function(t){var e=this;s.a.get(t,{}).then(function(t){e.options.currentResult=t,e.options.onSearchComplete&&e.options.onSearchComplete.call(e,t,e.options.resultType)})},_search:function(t,e){var i={keyword:t,sort:e,pageNum:this.options.pageNum,pageSize:this.options.pageSize};this.options.param=i;var n=this._queryParam(i);n&&this._doQuery(n)},_searchInView:function(t,e){var i=this.map.getBounds(),n={keyword:t,sort:e,bounds:[i.getSouth(),i.getWest(),i.getNorth(),i.getEast()].join(","),pageNum:this.options.pageNum,pageSize:this.options.pageSize};this.options.param=n;var r=this._queryParam(n);r&&this._doQuery(r)},_searchStatistics:function(t,e){var i={keyword:t,sort:e},n=this._queryStatParam(i);n&&this._doQuery(n)},_queryParam:function(t){var e=this.options.url;if(!e)return!1;var i=t.keyword,n=t.sort,r=t.bounds,a=t.city;return e=e+"/search?format=json&page_num="+t.pageNum+"&page_size="+t.pageSize,i&&(e+="&q="+encodeURIComponent(i)),n&&(e+="&type="+encodeURIComponent(n)),a&&(e+="&city="+encodeURIComponent(a)),r&&(e+="&sq_type=bounds&bounds="+encodeURIComponent(r)),e},_queryBufferParam:function(t){var e=this.options.url;if(!e)return!1;var i=t.keyword,n=t.sort,r=t.radius,a=t.center;e+="/search?format=json",i&&(e+="&q="+encodeURIComponent(i)),n&&(e+="&type="+encodeURIComponent(n));var s=t.pageNum,o=t.pageSize;return e+="&page_num={page_num}&page_size={page_size}&sq_type=buffer&location={y},{x}&radius={r}".replace("{page_num}",s).replace("{page_size}",o).replace("{x}",a.lng).replace("{y}",a.lat).replace("{r}",r)},_queryStatParam:function(t){var e=this.options.url;if(!e)return!1;var i=t.keyword,n=t.sort;return e+="/statistic?",i&&(e+="&q="+encodeURIComponent(i)),n&&(e+="&type="+encodeURIComponent(n)),e}});r.a.geoway.service.poiService=function(t,e){return new c(t,e)},r.a.geoway.service.PoiService=c,r.a.LocalSearch=c;var f=r.a.Class.extend({options:{url:"https://api.tianditu.gov.cn/search",tk:"ffa5ef8e4ea43caf693fa0097f8258a6",pageNum:0,pageSize:10,onSearchComplete:null,param:null,resultType:0,currentResult:null},initialize:function(t,e){this.map=t,r.a.setOptions(this,e)},setUrl:function(t){this.options.url=t},setPageSize:function(t){this.options.pageSize=t},getPageSize:function(){return this.options.pageSize},setSearchCompleteCallback:function(t){this.options.onSearchComplete=t},search:function(t,e){this._search(t,e)},searchInBounds:function(t,e){this.options.mapBound=e.toBBoxString(),this._search(t,10)},searchNearby:function(t,e,i){var n=this.options.pageNum,r=this.options.pageSize,a={keyWord:encodeURIComponent(t),pageNum:n,pageSize:r,queryType:3,queryRadius:i,pointLonlat:e.lng+","+e.lat};this.options.param=a,this._doSearch()},getResults:function(){return this.options.currentResult},clearResults:function(){this.options.currentResult=null,this.options.pageNum=0},getTotalPage:function(){var t,e=this.options.currentResult;if(e){var i=e.count;i&&i>0&&(t=Math.ceil(i/this.options.pageSize)-1)}return t},firstPage:function(){this.gotoPage(0)},nextPage:function(){var t=this.options.param.pageNum;this.gotoPage(t+1)},previousPage:function(){var t=this.options.param.pageNum;this.gotoPage(t-1)},lastPage:function(){var t=this.getTotalPage();this.gotoPage(t)},gotoPage:function(t){var e=this.options.param,i=this.getTotalPage();e&&i&&(t>i?t=i:t<0&&(t=0),e.pageNum=t,this._doSearch())},_search:function(t,e){var i=this.options.pageNum,n=this.options.pageSize,r=this.options.mapBound,a={keyWord:encodeURIComponent(t),pageNum:i,pageSize:n,queryType:e,mapBound:r};this.options.param=a,this._doSearch()},_doSearch:function(){var t=this.options.param,e=this._queryParam(t);if(e){var i=this;s.a.get(e).then(function(t){try{var e=JSON.parse(t);i.options.currentResult=e,i.options.onSearchComplete&&i.options.onSearchComplete.call(i,e,i.options.queryType)}catch(e){i.options.onSearchComplete&&i.options.onSearchComplete.call(i,t,i.options.queryType)}})}},_queryParam:function(t){var e=this.options.url;if(!e)return!1;var i=r.a.setOptions({},t),n=t.pageSize,a=t.pageNum*t.pageSize;if(this.map){var s=this.map.getZoom();i.level=i.level||s;var o=this.map.getBounds().toBBoxString();i.mapBound=i.mapBound||o}i.queryType=i.queryType||1,i.count=n||10,i.start=a||0;for(var h=["keyWord","level","mapBound","pointLonlat","queryRadius","queryType","specifyAdminCode","count","start"],l="?postStr=",u=[],c=0;c<h.length;c++){var f=h[c];f in i&&u.push("'"+f+"':'"+i[f]+"'")}return l+="{"+u.join(",")+"}",e+=l+="&type=query&tk="+this.options.tk}});r.a.geoway.service.tPoiService=function(t,e){return new f(t,e)},r.a.geoway.service.TPoiService=f,r.a.TLocalSearch=f;var p=r.a.Class.extend({options:{url:null},initialize:function(t){r.a.setOptions(this,t)},getLatLngInfo:function(t,e){this._getLatLngInfo(t,e)},getLocation:function(t,e){this._getLocation(t,e)},_getLatLngInfo:function(t,e){var i=this.options.url;if(!i)return!1;var n=t.address,r=t.city;i=i+"/geo?format="+(t.format||"json")+"&address="+n,r&&(i=i+"&city="+r),s.a.get(i).then(function(t){e&&"function"==typeof e&&e(t)})},_getLocation:function(t,e){var i=this.options.url;if(!i)return!1;i=i+"/rgeo?format=json&lon="+t.lng+"&lat="+t.lat,s.a.get(i).then(function(t){e&&"function"==typeof e&&e(t)})}});r.a.geoway.service.geocoderService=function(t){return new p(t)},r.a.geoway.service.GeocoderService=p,r.a.Geocoder=p;var d=r.a.Class.extend({options:{url:"https://api.tianditu.gov.cn/geocoder",tk:"ffa5ef8e4ea43caf693fa0097f8258a6"},initialize:function(t){r.a.setOptions(this,t)},getLocation:function(t,e){this._getLocation(t,e)},_getLocation:function(t,e){var i=this.options.url;if(!i)return!1;var n={};n.lon=t.lng,n.lat=t.lat,n.appkey="8a7b9aac0db21f9dd995e61a14685f05",n.ver=1;for(var r=["lon","lat","appkey","ver"],a="?postStr=",o=[],h=0;h<r.length;h++){var l=r[h];l in n&&o.push("'"+l+"':'"+n[l]+"'")}a+="{"+o.join(",")+"}",a+="&type=geocode&tk="+this.options.tk,s.a.get(i+a).then(function(t){var i=JSON.parse(t.bodyText);e&&"function"==typeof e&&e(i)})}});r.a.geoway.service.tGeocoderService=function(t){return new d(t)},r.a.geoway.service.TGeocoderService=d,r.a.TGeocoder=d;var g=i(49);g.Wkt.prototype.isRectangle=!1,g.Wkt.prototype.trunc=function(t){var e,i=[];for(e=0;e<t.length;e+=1)g.isArray(t[e])?i.push(this.trunc(t[e])):0!==e&&this.sameCoords(t[0],t[e])||i.push(t[e]);return i},g.Wkt.prototype.construct={point:function(t,e){var i=e||this.components;return i instanceof Array&&(i=i[0]),r.a.marker(this.coordsToLatLng(i),t)},multipoint:function(t){var e,i=[],n=this.components;for(e=0;e<n.length;e+=1)i.push(this.construct.point.call(this,t,n[e]));return r.a.featureGroup(i,t)},linestring:function(t,e){var i=e||this.components,n=this.coordsToLatLngs(i,0,this.coordsToLatLng);return r.a.polyline(n,t)},multilinestring:function(t){var e=this.components,i=this.coordsToLatLngs(e,1,this.coordsToLatLng);return r.a.multiPolyline?r.a.multiPolyline(i,t):r.a.polyline(i,t)},polygon:function(t){var e=this.trunc(this.components),i=this.coordsToLatLngs(e,1,this.coordsToLatLng);return r.a.polygon(i,t)},multipolygon:function(t){var e=this.trunc(this.components),i=this.coordsToLatLngs(e,2,this.coordsToLatLng);return r.a.multiPolygon?r.a.multiPolygon(i,t):r.a.polygon(i,t)},geometrycollection:function(t){var e,i,n;for(e=this.trunc(this.components),n=[],i=0;i<this.components.length;i+=1)n.push(this.construct[e[i].type].call(this,e[i]));return r.a.featureGroup(n,t)}},r.a.Util.extend(g.Wkt.prototype,{coordsToLatLngs:r.a.GeoJSON.coordsToLatLngs,coordsToLatLng:function(t,e){var i=e?t.x:t.y,n=e?t.y:t.x;return r.a.latLng(i,n,!0)}}),g.Wkt.prototype.deconstruct=function(t){var e,i,n,a,s,o,h,l;if(i=function(t){var e,n;for(n=[],e=0;e<t.length;e+=1)g.isArray(t[e])?n.push(i(t[e])):n.push({x:t[e].lng,y:t[e].lat});return n},t.constructor===r.a.Marker||t.constructor===r.a.marker)return{type:"point",components:[{x:t.getLatLng().lng,y:t.getLatLng().lat}]};if(t.constructor===r.a.Rectangle||t.constructor===r.a.rectangle)return{type:"polygon",isRectangle:!0,components:[[{x:(h=t.getBounds()).getSouthWest().lng,y:h.getNorthEast().lat},{x:h.getNorthEast().lng,y:h.getNorthEast().lat},{x:h.getNorthEast().lng,y:h.getSouthWest().lat},{x:h.getSouthWest().lng,y:h.getSouthWest().lat},{x:h.getSouthWest().lng,y:h.getNorthEast().lat}]]};if((t.constructor===r.a.Polyline||t.constructor===r.a.polyline)&&(s=[],!(h=t.getLatLngs())[0].equals(h[h.length-1]))){for(a=0;a<h.length;a+=1)s.push({x:h[a].lng,y:h[a].lat});return{type:"linestring",components:s}}if(t.constructor===r.a.Polygon||t.constructor===r.a.polygon){for(o=[],s=[],l=t.getLatLngs()[0],a=0;a<l.length;a+=1)s.push({x:l[a].lng,y:l[a].lat});if(s.push({x:l[0].lng,y:l[0].lat}),o.push(s),t._holes&&t._holes.length>0)for(s=i(t._holes),a=0;a<s.length;a++)s[a].push(s[a][0]),o.push(s[a]);return{type:"polygon",components:o}}if(t.constructor===r.a.MultiPolyline||t.constructor===r.a.MultiPolygon||t.constructor===r.a.LayerGroup||t.constructor===r.a.FeatureGroup){for(e in n=[],h=t._layers)h.hasOwnProperty(e)&&(h[e].getLatLngs||h[e].getLatLng)&&n.push(this.deconstruct(h[e]));return{type:function(){switch(t.constructor){case r.a.MultiPolyline:return"multilinestring";case r.a.MultiPolygon:return"multipolygon";case r.a.FeatureGroup:return function(){var e,i,n,a;for(e in i=!0,n=!0,a=!0,t._layers)t._layers.hasOwnProperty(e)&&(t._layers[e].constructor!==r.a.Marker&&(a=!1),t._layers[e].constructor!==r.a.Polyline&&(n=!1),t._layers[e].constructor!==r.a.Polygon&&(i=!1));return a?"multipoint":n?"multilinestring":i?"multipolygon":"geometrycollection"}();default:return"geometrycollection"}}(),components:function(){var t,e;for(e=[],t=0;t<n.length;t+=1)n[t].components&&e.push(n[t].components);return e}()}}t.constructor===r.a.Circle||t.constructor===r.a.circle?console.log("Deconstruction of L.Circle objects is not yet supported"):console.log("The passed object does not have any recognizable properties.")};var y=g,v=r.a.Class.extend({featureService:null,fields:null,options:{isEdit:!1,layerId:null,feature:null,fId:null,position:{top:10,right:10},width:360,height:310},initialize:function(t,e){this.featureService=t,r.a.setOptions(this,e),this.getFields(e.layerId)},getFields:function(t){var e=this;this.featureService.infoById(t,function(t){e.fields=t.layer.fields},function(t){console.log(t)})},findFieldType:function(t){var e=this.fields.find(function(e){return e.name===t});return e?e.type:null},render:function(t){var e=this.options,i="height: ".concat(e.height,"px; width: ").concat(e.width,"px;");for(var n in e.position)i+="".concat(n,": ").concat(e.position[n],"px;");var a='<div class="attr-panel" style="'.concat(i,'"><h2>属性信息<i></i></h2><div class="attr-con"><div class="attr-main"><ul>');for(var s in t){var o=t[s]||"";a+='<li><span style="width:40%;">'.concat(s,'</span><span style="width:60%;"><input type="text" value="').concat(o,'"/></span></li>')}a+='</ul></div><div class="attr-btn"><button type="button">保存</button><button type="button">删除</button></div></div>';var h=document.getElementById("attr-panel-wrap")||r.a.DomUtil.create("div","attr-panel-wrap");h.id="attr-panel-wrap",h.innerHTML=a,document.getElementsByTagName("body")[0].appendChild(h),r.a.DomEvent.on(document.querySelector(".attr-panel i"),"click",this.close,this),r.a.DomEvent.on(document.querySelector(".attr-btn :nth-child(1)"),"click",this.saveHandle,this),r.a.DomEvent.on(document.querySelector(".attr-btn :nth-child(2)"),"click",this.delete,this)},close:function(){this.options.feature.editor&&this.options.feature.disableEdit();var t=document.getElementsByTagName("body")[0],e=document.getElementsByClassName("attr-panel-wrap")[0];t.removeChild(e)},saveHandle:function(){for(var t=document.getElementsByTagName("li"),e={},i=0;i<t.length;i++){var n=t[i].childNodes,r=n[0].innerText,a=this.findFieldType(r),s=n[1].firstChild.value;["int","short","long"].includes(a)?e[r]=parseInt(s):["float","double"].includes(a)?e[r]=parseFloat(s):e[r]=s}var o={};o.attributes=e;var h=new y.Wkt;h.fromObject(this.options.feature),o.geometry=h.write(),this.options.isEdit&&(o.fId=this.options.fId),this.save([o])},delete:function(){var t=this,e=this.options;e.isEdit?this.featureService.deleteFeatures(e.layerId,e.fId,function(e){t.featureService.fire("feature:delete",e),t.close()},function(t){console.error(t)}):(this.featureService.featureGroup.removeLayer(e.feature),t.close())},save:function(t){var e=this,i=this.options;i.isEdit?this.featureService.updateFeatures(i.layerId,t,function(t){e.featureService.fire("feature:save",t),e.close()},function(t){console.error(t)}):this.featureService.addFeatures(i.layerId,t,function(t){e.featureService.fire("feature:save",t),e.close()},function(t){console.error(t)})}}),m=r.a.Evented.extend({options:{url:null},initialize:function(t,e){this.featureGroup=t,r.a.setOptions(this,e)},setUrl:function(t){this.options.url=t},info:function(t,e){var i=this.options.url;if(!i)return!1;i+="/info",s.a.get(i).then(function(i){"ok"===i.status?t(i):e&&e(i)}).catch(function(t){e&&e(t)})},infoById:function(t,e,i){var n=this.options.url;if(!n)return!1;n=n+"/"+t+"/info",s.a.get(n).then(function(t){"ok"===t.status?e(t):i&&i(t)}).catch(function(t){i&&i(t)})},query:function(t,e,i){var n=this.options.url;if(!n)return!1;if(!t&&!t.layerId)return!1;n=n+"/"+t.layerId+"/query";var r={};for(var a in t)"layerId"!==a&&(r[a]=t[a]);s.a.get(n,r).then(function(t){"ok"===t.status?e(t):i&&i(t)}).catch(function(t){i&&i(t)})},queryMulti:function(t,e,i){var n=this.options.url;if(!n)return!1;n+="/querymulti",t.layers=JSON.stringify(t.layers),s.a.get(n,t).then(function(t){"ok"===t.status?e(t):i&&i(t)}).catch(function(t){i&&i(t)})},identify:function(t,e,i){var n=this.options.url;if(!n)return!1;n+="/identify",s.a.get(n,t).then(function(t){"ok"===t.status?e(t):i&&i(t)}).catch(function(t){i&&i(t)})},detail:function(t,e,i,n){var r=this.options.url;if(!r)return!1;r=r+"/"+t+"/detail",s.a.get(r,{fids:e}).then(function(t){"ok"===t.status?i(t):n&&n(t)}).catch(function(t){n&&n(t)})},addFeatures:function(t,e,i,n){var r=this.options.url;if(!r)return!1;r=r+"/"+t+"/addFeatures",s.a.post(r,e).then(function(t){"ok"===t.status?i(t):n&&n(t)}).catch(function(t){n&&n(t)})},updateFeatures:function(t,e,i,n){var r=this.options.url;if(!r)return!1;r=r+"/"+t+"/updateFeatures",s.a.post(r,e).then(function(t){"ok"===t.status?i(t):n&&n(t)}).catch(function(t){n&&n(t.message)})},deleteFeatures:function(t,e,i,n){var r=this.options.url;if(!r)return!1;r=r+"/"+t+"/deleteFeatures?objectIds="+e,s.a.post(r).then(function(t){"ok"===t.status?i(t):n&&n(t)}).catch(function(t){n&&n(t)})},bufferAnalysis:function(t,e,i,n){var r=this.options.url;if(!r)return!1;r=r+"/"+t+"/bufferAnalysis",s.a.post(r,e).then(function(t){"ok"===t.status?i(t):n&&n(t)}).catch(function(t){n&&n(t)})},overlayAnalysis:function(t,e,i){var n=this.options.url;if(!n)return!1;n+="/overlayAnalysis",s.a.post(n,t).then(function(t){"ok"===t.status?e(t):i&&i(t)}).catch(function(t){i&&i(t)})},showAttr:function(t,e){new v(this,t).render(e)}});r.a.geoway.service.featureService=function(t,e){return new m(t,e)},r.a.geoway.service.FeatureService=m},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,r;return e=t,(i=[{key:"getLengthPoint",value:function(t,e,i,n,r,a){var s,o,h=i-t,l=n-e;if(0==h)return s=i,o=l>0?e+r:e-r,null==a?[s,o]:[s,o,a];var u=l/h,c=Math.sqrt(u*u+1),f=Math.abs(r/c),p=Math.abs(f*u);return s=h>0?t+f:t-f,o=l>0?e+p:e-p,null==a?[s,o]:[s,o,a]}},{key:"getAngle",value:function(t,e){if(e[0]-t[0]==0)return e[1]>t[0]?90:-90;var i=(e[1]-t[1])/(e[0]-t[0]);return 360*Math.atan(i)/(2*Math.PI)}},{key:"length",value:function(t,e,i,n){var r=i-t,a=n-e;return Math.sqrt(r*r+a*a)}},{key:"getNodePath",value:function(t,e){for(var i=[],n={},r=[],a=e.length,s=function(t){var e=t[0];return t.splice(0,1),e},o=s(e),h=0;;){if(r.length==a)return n.index=h,n.pointList=r,n;if(h>=t.length)return n.index=h,n.pointList=r,n;var l=t[h],u=t[h+1];if(0!=i.length){var c=this.length(i[0],i[1],l,u);if(c>=o){var f=this.getLengthPoint(i[0],i[1],l,u,o,null),p=this.getAngle(i,[l,u]);90==p&&(p=0),-90==p&&(p=0),0==p&&(p=.5),p>=45?p-=90:p<=-45&&(p+=90);var d=[f,p];r.push(d),i[0]=f[0],i[1]=f[1],o=s(e)}else o-=c,i[0]=l,i[1]=u,h+=2}else i[0]=l,i[1]=u}return n.index=h,n.pointList=r,n}}])&&n(e.prototype,i),r&&n(e,r),t}(),a=i(8),s=i(6);function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"cutLineFeature",value:function(t,e){var i=[],n=0;if(t.sourceData.length<4)return i;var r=[{weight:t.codeAvoidWeight,fun:this.createLineCodeFeatrue},{weight:t.weight,fun:this.createLineTextFeatrue},{weight:t.arrowAvoidWeight,fun:this.createLineArrowFeatrue}];r=this.sort(r);for(var a=0;a<r.length;a++){var s=r[a].fun.call(this,t,e,n);n=s.index,s.feature&&i.push(s.feature)}return i}},{key:"sort",value:function(t){if(t.length>0)return t.sort(function(t,e){return t.weight<e.weight?1:t.weight==e.weight?0:-1})}},{key:"createLineTextFeatrue",value:function(t,e,i){var n=t.sourceData,o=new r,h=[],l=null;if(s.a.isNotNull(t.label)&&i<n.length){t.label=t.label+"";for(var u=0;u<t.label.length;u++)h.push(1.2*e.lineHeight+2+e.gap);h[0]=h[0]+30;[].concat(h);var c=o.getNodePath(n,h),f=c.pointList;if(f.length>0)if(i=c.index,e.isTransverse)(l=this.cloneFeature(t)).attributeId=l.attributeId+"_text",l.sourceAngleData=[f[0]],l.lineType="text";else{var p=t.label.length-f.length;if(p>0){if(i=n.length,!(p<e.extendedNum))return{feature:null,index:i};this.delayTextPoint(n,f,t.label,e.chinaLabelWidth+e.gap)}var d=[f[0][0][0],f[0][0][1]],g=f[f.length-1][0],y=s.a.getAngle(d,g);if((l=this.cloneFeature(t)).angle=y,0!=e.changeDirection)this.isChangeDirection(t.label,d,g,y)&&(f=f.reverse());l.attributeId=l.attributeId+"_text",l.sourceAngleData=f,l.lineType="text"}e.lineOffset&&l&&(1==l.sourceAngleData.length?l.sourceAngleData[0][0][1]=l.sourceAngleData[0][0][1]-e.lineOffset:l.sourceAngleData=a.a.lineOffset(l.sourceAngleData,e.lineOffset))}return{feature:l,index:i}}},{key:"createLineCodeFeatrue",value:function(t,e,i){var n=t.sourceData,a=new r,o=[],h=null,l=t.roadCodeLabel;if(e.showRoadCode&&s.a.isNotNull(l)&&i<n.length){var u=n.slice(i,n.length-1);o.push(30);var c=a.getNodePath(u,o),f=c.pointList;1==f.length&&(i+=c.index,(h=this.cloneFeature(t)).attributeId=h.attributeId+"_code",h.sourceAngleData=f,h.lineType="code",h.label=l+"",h.weight=t.codeAvoidWeight)}return{feature:h,index:i}}},{key:"createLineArrowFeatrue",value:function(t,e,i){var n=t.sourceData,a=new r,s=[],o=null;if(e.showArrow&&i<n.length){var h=e.arrowDirectionValue;e.arrowDirectionField&&(h=t.attributes[e.arrowDirectionField]),e.arrowSize=e.arrowSize?e.arrowSize:6,e.arrowDistance=e.arrowDistance?e.arrowDistance:12,e.arrowLineWidth=e.arrowLineWidth?e.arrowLineWidth:2,e.arrowStrokeStyle=e.arrowStrokeStyle?e.arrowStrokeStyle:"#666666",e.arrowFillStyle=e.arrowFillStyle?e.arrowFillStyle:"#666666",e.arrowDirectionValue=e.arrowDirectionValue?e.arrowDirectionValue:0;var l=n.slice(i,n.length-1);s.push(16),0==h?(s.push(e.arrowSize),s.push(e.arrowDistance)):(s.push(e.arrowDistance),s.push(e.arrowSize));var u=a.getNodePath(l,s).pointList;3==u.length&&((o=this.cloneFeature(t)).attributeId=o.attributeId+"_arrow",o.sourceAngleData=u,o.lineType="arrow",o.weight=t.arrowAvoidWeight)}return{feature:o,index:i}}},{key:"delayTextPoint",value:function(t,e,i,n){var r,a=null;a=1==e.length?[t[0],t[1]]:e[e.length-2][0],r=e[e.length-1][0];for(var s=e[e.length-1][1],o=e.length,h=1;h<i.length-o+1;h++){var l=[this.getPoint(a,r,n*h),s];e.push(l)}}},{key:"cloneFeature",value:function(t){return{type:t.type,datas:t.datas,centerPoint:t.centerPoint,sourceData:t.sourceData,label:t.label,roadCodeLabel:t.roadCodeLabel,attributes:t.attributes,attributeId:t.attributeId,styleId:t.styleId,textures:t.textures,xyz:t.xyz,lineType:t.lineType,weight:t.weight}}},{key:"isChangeDirection",value:function(t,e,i,n){var r=!1;if(/.*[\u4e00-\u9fa5]+.*$/.test(t)){if(e[0]==i[0]&&e[1]>i[1])return r=!0;n<-45&&n>-90?e[0]<i[0]&&(r=!0):e[0]>i[0]&&(r=!0)}else e[0]>i[0]&&(r=!0);return r}},{key:"getDistance",value:function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.pow(i*i+n*n,.5)}},{key:"getLineDistance",value:function(t){if(t.length<4)return 0;for(var e=0,i=0;i<t.length/2-1;i++){var n=[t[2*i],t[2*i+1]],r=[t[2*(i+1)],t[2*(i+1)+1]];e+=this.getDistance(n,r)}return e}},{key:"getPoint",value:function(t,e,i){var n=e[0]-t[0],r=e[1]-t[1],a=e[0],s=e[1];if(0==n)s=r>0?e[1]+i:e[1]-i;else{var o=Math.sqrt(i*i/(r/n*(r/n)+1));n<0&&(o=-o),a=e[0]+o,s=e[1]+r/n*o}return[a,s]}}],(i=null)&&o(e.prototype,i),n&&o(e,n),t}();function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=null,c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"parseLayerDatas",value:function(e,i,n,r,a,s,o,h){var l=[],u=[];for(var c in e)if("_layerAvoids"!=c){var f=e[c];f.xyz=n;var p=t.getProperty(f.fieldsConfig);if(1==f.type){var d=t.parsePointLayer(f,c,p,i,r,a,s,o,h);l=l.concat(d)}if(2==f.type){var g=t.parseLineLayer(f,c,p,i,r,a,s,o,h);u=u.concat(g)}}return{pointFeatures:l,lineFeatures:u}}},{key:"updateFeatureAttr",value:function(e,i,n,r,a,s,o,h,l){for(var c=0;c<e.length;c++){var f=e[c],p=i[f.styleId];if(a)f.iconImg=r[p.texture];else if(null==u&&(u=null),p.texture){var d=u.getTexture(p.texture);null!=d&&(f.iconImg=d.toPattern(n))}t.parsePoint(f,p,a,s,o,h,l)}return e}},{key:"parsePointLayer",value:function(t,e,i,n,r,a,s,o,h){for(var l=[],u=0;u<t.features.length;u++){var c=t.features[u],f=n[c.styleId];f&&f.show&&("_default__"==f.type||f.labelfield||f.texture)&&(c.centerPoint=c[2],c.attributeId=e+"__"+c[1][i.idIndex],c.layerName=e,c.xyz=t.xyz,c.propertyGetter=i,c.type=t.type,c.weight=c.avoidWeight,(null==c.avoidWeight||isNaN(c.avoidWeight))&&(c.avoidWeight=f.avoidWeight,c.weight=c.avoidWeight,null==c.weight&&(c.weight=0,c.avoidWeight=0)),f.isImportant&&(c.avoidWeight=99999999,c.weight=99999999),l.push(c))}return l}},{key:"parseLineLayer",value:function(e,i,n,r,a,s,o,h,l){for(var u=[],c=0;c<e.features.length;c++){var f=e.features[c],p=r[f.styleId];if(p&&p.show&&("_default__"==p.type||p.labelfield||p.roadCodeLabel)){f.layerName=i;var d=t.parseLine(f,p,e,n,a,s,o,h,l);u=u.concat(d)}}return u}},{key:"parsePoint",value:function(e,i,n,r,a,o,h){e.attributes=t.getAttributes(e[1],e.propertyGetter);var l=e[2],u=[[l,0]],c=e.attributes[i.labelfield];e.primaryId=e.attributeId+"_row_"+e.xyz.y+"_col_"+e.xyz.x+"_level_"+e.xyz.l+"_x_"+u[0][0][0]+"_y_"+u[0][0][1],e.label=s.a.formatLabel(c),e.weight=e.avoidWeight;var f=0;return i.pointBoxDisance&&(f=.5*i.pointBoxDisance),e.filterBox=[e.centerPoint[0]-f,e.centerPoint[1]-f,e.centerPoint[0]+f,e.centerPoint[1]+f],e.sourceData=l,e.sourceAngleData=u,n?(e.id=Math.round(256*Math.random()*256*256),e.datas=t.transformData(u,e.xyz,r,a,o,h)):e.datas=u,e}},{key:"parseLine",value:function(e,i,n,r,a,s,o,h,l){if(0==e[2].length)return[];var u=[];return t.processLineString(u,e[2],e,i,n,r,a,s,o,h,l),u}},{key:"processLineString",value:function(e,i,n,r,a,s,o,h,l,u,c){if(Array.isArray(i[0]))for(var f=i.length,p=0;p<f;p++){var d=i[p];t.processLineString(e,d,n,r,a,s,o,h,l,u,c)}else for(var g=t.parseMultiLine(n,i,a,s,r,o,h,l,u,c),y=0;y<g.length;y++)e.push(g[y])}},{key:"parseMultiLine",value:function(e,i,n,r,a,o,h,l,u,c){var f=t.getAttributes(e[1],r),p=[],d=f[a.labelfield],g=f[a.roadCodeLabel];d=s.a.formatLabel(d),g=s.a.formatLabel(g);var y=e.layerName+"__"+e[1][r.idIndex];e.avoidWeight;a.isImportant;var v={type:n.type,sourceData:i,label:d,weight:e.avoidWeight,codeAvoidWeight:e.codeAvoidWeight,arrowAvoidWeight:e.arrowAvoidWeight,roadCodeLabel:g,attributes:f,attributeId:y,styleId:e.styleId,xyz:n.xyz,layerName:e.layerName};return p=p.concat(t.cutLineFeature(v,a,o,!1,h,l,u,c))}},{key:"cutLineFeature",value:function(e,i,n,r,a,s,o,l){if(n&&"_default__"==i.type)return e.sourceAngleData=t.lineToSourceAngleData(e.sourceData),e.datas=t.transformData(e.sourceAngleData,e.xyz,a,s,o,l),[e];for(var u=h.cutLineFeature(e,i,n),c=.1,f=0;f<u.length;f++){var p=u[f];if(p.primaryId=p.attributeId+"_row_"+e.xyz.y+"_col_"+e.xyz.x+"_level_"+e.xyz.l+"_x_"+p.sourceAngleData[0][0][0]+"_y_"+p.sourceAngleData[0][0][1],n?(p.datas=r?e.transformData(this.extent,this.res):t.transformData(p.sourceAngleData,p.xyz,a,s,o,l),p.id=Math.round(256*Math.random()*256*256)):p.datas=p.sourceAngleData,p.layerName=e.layerName,"text"==p.lineType){var d=Math.floor(p.sourceAngleData.length/2);p.centerPoint=p.sourceAngleData[d][0],i.lineTextBoxDisance&&(c=.5*i.lineTextBoxDisance)}"code"==p.lineType&&(p.centerPoint=p.sourceAngleData[0][0],i.lineCodeBoxDisance&&(c=.5*i.lineCodeBoxDisance)),"arrow"==p.lineType&&(p.centerPoint=p.sourceAngleData[1][0]),p.filterBox=[p.centerPoint[0]-c,p.centerPoint[1]-c,p.centerPoint[0]+c,p.centerPoint[1]+c]}return u}},{key:"lineToSourceAngleData",value:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],r=t[i+1];e.push([[n,r],0]),i++}return e}},{key:"transformData",value:function(t,e,i,n,r,a){for(var s=n[0],o=n[3],h=(s-i[0])/r,l=(i[3]-o)/r,u=[],c=0;c<t.length;c++){var f=t[c][0],p=[f[0]+e.x*a-h,f[1]+e.y*a-l];u.push([p,t[c][1]])}return u}},{key:"parseAvoidLine",value:function(e,i,n,r,a,s,o){var h=[];for(var l in e){var u=e[l];l=parseInt(l);for(var c=0;c<u.length;c++){var f={};f.weight=l,f.sourceDatas=u[c],n&&(f.datas=t.transformAvoidLine(u[c],i,r,a,s,o)),f.xyz=i,h.push(f)}}return h}},{key:"transformAvoidLine",value:function(t,e,i,n,r,a){for(var s=n[0],o=n[3],h=(s-i[0])/r,l=(i[3]-o)/r,u=[],c=0;c<t.length/2;c++){var f=t[2*c],p=t[2*c+1],d=f+e.x*a,g=p+e.y*a;u.push(d-h),u.push(g-l)}return u}},{key:"getProperty",value:function(t){for(var e={},i=0,n=0;n<t.length;n++)"true"!=t[n].id&&1!=t[n].id||(i=t[n].index),e[t[n].name]=parseInt(t[n].index);return{propertyConfig:e,idIndex:i}}},{key:"getAttributes",value:function(t,e){var i={},n=e.propertyConfig;for(var r in n)i[r]=t[n[r]];return i}}],(i=null)&&l(e.prototype,i),n&&l(e,n),t}();e.a=c},function(t,e,i){"use strict";i.d(e,"d",function(){return l}),i.d(e,"c",function(){return c}),i.d(e,"b",function(){return g.a}),i.d(e,"a",function(){return y.a});i(17);var n=i(5),r=(i(1),i(0)),a=i.n(r),s=n.a.extend({defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(t){n.a.prototype.initialize.apply(this,[t])},getVersion:function(t,e){var i;return t?(i=this.version)||(i=t.getAttribute("version"))||(i=this.defaultVersion):i=e&&e.version||this.version||this.defaultVersion,i},getParser:function(t){if(t=t||this.defaultVersion,!this.parser||this.parser.VERSION!=t){var e=a.a.geoway.format[this.name]["v"+t.replace(/\./g,"_")];e&&(this.parser=new e(this.options))}return this.parser},write:function(t,e){var i=this.getVersion(null,e);this.parser=this.getParser(i);var r=this.parser.write(t,e);return!1===this.stringifyOutput?r:n.a.prototype.write.apply(this,[r])},read:function(t,e){"string"==typeof t&&(t=n.a.prototype.read.apply(this,[t]));var i=t.documentElement,r=this.getVersion(i);this.parser=this.getParser(r);var a=this.parser.read(t,e);return a.version=r,a}}),o=(i(10),n.a.extend({regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(t){var e={};return this.readChildNodes(t,e),e},readers:{ows:{Exception:function(t,e){var i={code:t.getAttribute("exceptionCode"),locator:t.getAttribute("locator"),texts:[]};e.exceptions.push(i),this.readChildNodes(t,i)},ExceptionText:function(t,e){var i=this.getChildValue(t);e.texts.push(i)},ServiceIdentification:function(t,e){e.serviceIdentification={},this.readChildNodes(t,e.serviceIdentification)},Title:function(t,e){e.title=this.getChildValue(t)},Abstract:function(t,e){e.abstract=this.getChildValue(t)},Keywords:function(t,e){e.keywords={},this.readChildNodes(t,e.keywords)},Keyword:function(t,e){e[this.getChildValue(t)]=!0},ServiceType:function(t,e){e.serviceType={codeSpace:t.getAttribute("codeSpace"),value:this.getChildValue(t)}},ServiceTypeVersion:function(t,e){e.serviceTypeVersion=this.getChildValue(t)},Fees:function(t,e){e.fees=this.getChildValue(t)},AccessConstraints:function(t,e){e.accessConstraints=this.getChildValue(t)},ServiceProvider:function(t,e){e.serviceProvider={},this.readChildNodes(t,e.serviceProvider)},ProviderName:function(t,e){e.providerName=this.getChildValue(t)},ProviderSite:function(t,e){e.providerSite=this.getAttributeNS(t,this.namespaces.xlink,"href")},ServiceContact:function(t,e){e.serviceContact={},this.readChildNodes(t,e.serviceContact)},IndividualName:function(t,e){e.individualName=this.getChildValue(t)},PositionName:function(t,e){e.positionName=this.getChildValue(t)},ContactInfo:function(t,e){e.contactInfo={},this.readChildNodes(t,e.contactInfo)},Phone:function(t,e){e.phone={},this.readChildNodes(t,e.phone)},Voice:function(t,e){e.voice=this.getChildValue(t)},Address:function(t,e){e.address={},this.readChildNodes(t,e.address)},DeliveryPoint:function(t,e){e.deliveryPoint=this.getChildValue(t)},City:function(t,e){e.city=this.getChildValue(t)},AdministrativeArea:function(t,e){e.administrativeArea=this.getChildValue(t)},PostalCode:function(t,e){e.postalCode=this.getChildValue(t)},Country:function(t,e){e.country=this.getChildValue(t)},ElectronicMailAddress:function(t,e){e.electronicMailAddress=this.getChildValue(t)},Role:function(t,e){e.role=this.getChildValue(t)},OperationsMetadata:function(t,e){e.operationsMetadata={},this.readChildNodes(t,e.operationsMetadata)},Operation:function(t,e){var i=t.getAttribute("name");e[i]={},this.readChildNodes(t,e[i])},DCP:function(t,e){e.dcp={},this.readChildNodes(t,e.dcp)},HTTP:function(t,e){e.http={},this.readChildNodes(t,e.http)},Get:function(t,e){e.get||(e.get=[]);var i={url:this.getAttributeNS(t,this.namespaces.xlink,"href")};this.readChildNodes(t,i),e.get.push(i)},Post:function(t,e){e.post||(e.post=[]);var i={url:this.getAttributeNS(t,this.namespaces.xlink,"href")};this.readChildNodes(t,i),e.post.push(i)},Parameter:function(t,e){e.parameters||(e.parameters={});var i=t.getAttribute("name");e.parameters[i]={},this.readChildNodes(t,e.parameters[i])},Constraint:function(t,e){e.constraints||(e.constraints={});var i=t.getAttribute("name");e.constraints[i]={},this.readChildNodes(t,e.constraints[i])},Value:function(t,e){e[this.getChildValue(t)]=!0},OutputFormat:function(t,e){e.formats.push({value:this.getChildValue(t)}),this.readChildNodes(t,e)},WGS84BoundingBox:function(t,e){var i={};i.crs=t.getAttribute("crs"),e.BoundingBox?e.BoundingBox.push(i):(e.projection=i.crs,i=e),this.readChildNodes(t,i)},BoundingBox:function(t,e){this.readers.ows.WGS84BoundingBox.apply(this,[t,e])},LowerCorner:function(t,e){var i=this.getChildValue(t).replace(this.regExes.trimSpace,""),n=(i=i.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);e.left=n[0],e.bottom=n[1]},UpperCorner:function(t,e){var i=this.getChildValue(t).replace(this.regExes.trimSpace,""),n=(i=i.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);e.right=n[0],e.top=n[1];var r=a.a.latLng(e.bottom,e.left),s=a.a.latLng(e.top,e.right);e.bounds=a.a.latLngBounds(r,s),delete e.left,delete e.bottom,delete e.right,delete e.top},Language:function(t,e){e.language=this.getChildValue(t)}}},writers:{ows:{BoundingBox:function(t,e){var i=this.createElementNSPlus(e||"ows:BoundingBox",{attributes:{crs:t.projection}});return this.writeNode("ows:LowerCorner",t,i),this.writeNode("ows:UpperCorner",t,i),i},LowerCorner:function(t){return this.createElementNSPlus("ows:LowerCorner",{value:t.bounds.left+" "+t.bounds.bottom})},UpperCorner:function(t){return this.createElementNSPlus("ows:UpperCorner",{value:t.bounds.right+" "+t.bounds.top})},Identifier:function(t){return this.createElementNSPlus("ows:Identifier",{value:t})},Title:function(t){return this.createElementNSPlus("ows:Title",{value:t})},Abstract:function(t){return this.createElementNSPlus("ows:Abstract",{value:t})},OutputFormat:function(t){return this.createElementNSPlus("ows:OutputFormat",{value:t})}}}})),h=o.extend({namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:a.a.Util.applyDefaults({ExceptionReport:function(t,e){e.exceptionReport={version:t.getAttribute("version"),language:t.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(t,e.exceptionReport)},AllowedValues:function(t,e){e.allowedValues={},this.readChildNodes(t,e.allowedValues)},AnyValue:function(t,e){e.anyValue=!0},DataType:function(t,e){e.dataType=this.getChildValue(t)},Range:function(t,e){e.range={},this.readChildNodes(t,e.range)},MinimumValue:function(t,e){e.minValue=this.getChildValue(t)},MaximumValue:function(t,e){e.maxValue=this.getChildValue(t)},Identifier:function(t,e){e.identifier=this.getChildValue(t)},SupportedCRS:function(t,e){e.supportedCRS=this.getChildValue(t)}},o.prototype.readers.ows)},writers:{ows:a.a.Util.applyDefaults({Range:function(t){var e=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":t.closure}});return this.writeNode("ows:MinimumValue",t.minValue,e),this.writeNode("ows:MaximumValue",t.maxValue,e),e},MinimumValue:function(t){return this.createElementNSPlus("ows:MinimumValue",{value:t})},MaximumValue:function(t){return this.createElementNSPlus("ows:MaximumValue",{value:t})},Value:function(t){return this.createElementNSPlus("ows:Value",{value:t})}},o.prototype.writers.ows)}}),l=s.extend({name:"WMTSCapabilities",defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0,"urn:ogc:def:crs:EPSG::4490":!0,"urn:ogc:def:crs:EPSG::900913":!0,"urn:ogc:def:crs:EPSG::4610":!0},xy:{"urn:ogc:def:crs:EPSG::3857":!0,"urn:ogc:def:crs:EPSG::3785":!0,"urn:ogc:def:crs:EPSG::102100":!0}});a.a.geoway.format.WMTSCapabilities=l,a.a.Format=a.a.Format?a.a.Format:{},a.a.Format.WMTSCapabilities=l;var u=h.extend({version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(t){n.a.prototype.initialize.apply(this,[t]),this.options=t;var e=a.a.extend({},l.prototype.yx);this.yx=a.a.extend(e,this.yx)},read:function(t){"string"==typeof t&&(t=n.a.prototype.read.apply(this,[t])),t&&9==t.nodeType&&(t=t.documentElement);var e={};return this.readNode(t,e),e.version=this.version,e},readers:{wmts:{Capabilities:function(t,e){this.readChildNodes(t,e)},Contents:function(t,e){e.contents={},e.contents.layers=[],e.contents.tileMatrixSets={},this.readChildNodes(t,e.contents)},Layer:function(t,e){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(t,i),e.layers.push(i)},Style:function(t,e){var i={};i.isDefault="true"===t.getAttribute("isDefault"),this.readChildNodes(t,i),e.styles.push(i)},Format:function(t,e){e.formats.push(this.getChildValue(t))},TileMatrixSetLink:function(t,e){var i={};this.readChildNodes(t,i),e.tileMatrixSetLinks.push(i)},TileMatrixSet:function(t,e){if(e.layers){var i={matrixIds:[]};this.readChildNodes(t,i),e.tileMatrixSets[i.identifier]=i}else e.tileMatrixSet=this.getChildValue(t)},TileMatrix:function(t,e){var i={supportedCRS:e.supportedCRS};this.readChildNodes(t,i),e.matrixIds.push(i)},ScaleDenominator:function(t,e){e.scaleDenominator=parseFloat(this.getChildValue(t))},TopLeftCorner:function(t,e){var i,n=this.getChildValue(t).split(" ");if(e.supportedCRS){var r=e.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[r]}e.topLeftCorner=i?a.a.latLng(n[0],n[1]):a.a.latLng(n[1],n[0])},TileWidth:function(t,e){e.tileWidth=parseInt(this.getChildValue(t))},TileHeight:function(t,e){e.tileHeight=parseInt(this.getChildValue(t))},MatrixWidth:function(t,e){e.matrixWidth=parseInt(this.getChildValue(t))},MatrixHeight:function(t,e){e.matrixHeight=parseInt(this.getChildValue(t))},ResourceURL:function(t,e){e.resourceUrl=e.resourceUrl||{};var i=t.getAttribute("resourceType");e.resourceUrls||(e.resourceUrls=[]);var n=e.resourceUrl[i]={format:t.getAttribute("format"),template:t.getAttribute("template"),resourceType:i};e.resourceUrls.push(n)},WSDL:function(t,e){e.wsdl={},e.wsdl.href=t.getAttribute("xlink:href")},ServiceMetadataURL:function(t,e){e.serviceMetadataUrl={},e.serviceMetadataUrl.href=t.getAttribute("xlink:href")},LegendURL:function(t,e){e.legend={},e.legend.href=t.getAttribute("xlink:href"),e.legend.format=t.getAttribute("format")},Dimension:function(t,e){var i={values:[]};this.readChildNodes(t,i),e.dimensions.push(i)},Default:function(t,e){e.default=this.getChildValue(t)},Value:function(t,e){e.values.push(this.getChildValue(t))}},ows:h.prototype.readers.ows}});a.a.geoway.format.WMTSCapabilities.v1_0_0=u;var c=s.extend({name:"WMSCapabilities",defaultVersion:"1.1.1"});a.a.geoway.format.WMSCapabilities=c,a.a.Format=a.a.Format?a.a.Format:{},a.a.Format.WMSCapabilities=c;var f=n.a.extend({namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(t){"string"==typeof t&&(t=n.a.prototype.read.apply(this,[t])),t&&9==t.nodeType&&(t=t.documentElement);var e={};return this.readNode(t,e),e},readers:{wms:{Service:function(t,e){e.service={},this.readChildNodes(t,e.service)},Name:function(t,e){e.name=this.getChildValue(t)},Title:function(t,e){e.title=this.getChildValue(t)},Abstract:function(t,e){e.abstract=this.getChildValue(t)},BoundingBox:function(t){var e={};e.bbox=[parseFloat(t.getAttribute("minx")),parseFloat(t.getAttribute("miny")),parseFloat(t.getAttribute("maxx")),parseFloat(t.getAttribute("maxy"))];var i={x:parseFloat(t.getAttribute("resx")),y:parseFloat(t.getAttribute("resy"))};return isNaN(i.x)&&isNaN(i.y)||(e.res=i),e},OnlineResource:function(t,e){e.href=this.getAttributeNS(t,this.namespaces.xlink,"href")},ContactInformation:function(t,e){e.contactInformation={},this.readChildNodes(t,e.contactInformation)},ContactPersonPrimary:function(t,e){e.personPrimary={},this.readChildNodes(t,e.personPrimary)},ContactPerson:function(t,e){e.person=this.getChildValue(t)},ContactOrganization:function(t,e){e.organization=this.getChildValue(t)},ContactPosition:function(t,e){e.position=this.getChildValue(t)},ContactAddress:function(t,e){e.contactAddress={},this.readChildNodes(t,e.contactAddress)},AddressType:function(t,e){e.type=this.getChildValue(t)},Address:function(t,e){e.address=this.getChildValue(t)},City:function(t,e){e.city=this.getChildValue(t)},StateOrProvince:function(t,e){e.stateOrProvince=this.getChildValue(t)},PostCode:function(t,e){e.postcode=this.getChildValue(t)},Country:function(t,e){e.country=this.getChildValue(t)},ContactVoiceTelephone:function(t,e){e.phone=this.getChildValue(t)},ContactFacsimileTelephone:function(t,e){e.fax=this.getChildValue(t)},ContactElectronicMailAddress:function(t,e){e.email=this.getChildValue(t)},Fees:function(t,e){var i=this.getChildValue(t);i&&"none"!=i.toLowerCase()&&(e.fees=i)},AccessConstraints:function(t,e){var i=this.getChildValue(t);i&&"none"!=i.toLowerCase()&&(e.accessConstraints=i)},Capability:function(t,e){e.capability={nestedLayers:[],layers:[]},this.readChildNodes(t,e.capability)},Request:function(t,e){e.request={},this.readChildNodes(t,e.request)},GetCapabilities:function(t,e){e.getcapabilities={formats:[]},this.readChildNodes(t,e.getcapabilities)},Format:function(t,e){a.a.Util.isArray(e.formats)?e.formats.push(this.getChildValue(t)):e.format=this.getChildValue(t)},DCPType:function(t,e){this.readChildNodes(t,e)},HTTP:function(t,e){this.readChildNodes(t,e)},Get:function(t,e){e.get={},this.readChildNodes(t,e.get),e.href||(e.href=e.get.href)},Post:function(t,e){e.post={},this.readChildNodes(t,e.post),e.href||(e.href=e.get.href)},GetMap:function(t,e){e.getmap={formats:[]},this.readChildNodes(t,e.getmap)},GetFeatureInfo:function(t,e){e.getfeatureinfo={formats:[]},this.readChildNodes(t,e.getfeatureinfo)},Exception:function(t,e){e.exception={formats:[]},this.readChildNodes(t,e.exception)},Layer:function(t,e){var i,n;e.capability?(n=e.capability,i=e):n=e;var r=t.getAttributeNode("queryable"),s=r&&r.specified?t.getAttribute("queryable"):null,o=(r=t.getAttributeNode("cascaded"))&&r.specified?t.getAttribute("cascaded"):null,h=(r=t.getAttributeNode("opaque"))&&r.specified?t.getAttribute("opaque"):null,l=t.getAttribute("noSubsets"),u=t.getAttribute("fixedWidth"),c=t.getAttribute("fixedHeight"),f=i||{},p=a.a.Util.extend,d={nestedLayers:[],styles:i?[].concat(i.styles):[],srs:i?p({},f.srs):{},metadataURLs:[],bbox:i?p({},f.bbox):{},llbbox:f.llbbox,dimensions:i?p({},f.dimensions):{},authorityURLs:i?p({},f.authorityURLs):{},identifiers:{},keywords:[],queryable:s&&""!==s?"1"===s||"true"===s:f.queryable||!1,cascaded:null!==o?parseInt(o):f.cascaded||0,opaque:h?"1"===h||"true"===h:f.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:f.noSubsets||!1,fixedWidth:null!=u?parseInt(u):f.fixedWidth||0,fixedHeight:null!=c?parseInt(c):f.fixedHeight||0,minScale:f.minScale,maxScale:f.maxScale,attribution:f.attribution};if(e.nestedLayers.push(d),d.capability=n,this.readChildNodes(t,d),delete d.capability,d.name){var g=d.name.split(":"),y=n.request,v=y.getfeatureinfo;g.length>0&&(d.prefix=g[0]),n.layers.push(d),void 0===d.formats&&(d.formats=y.getmap.formats),void 0===d.infoFormats&&v&&(d.infoFormats=v.formats)}},Attribution:function(t,e){e.attribution={},this.readChildNodes(t,e.attribution)},LogoURL:function(t,e){e.logo={width:t.getAttribute("width"),height:t.getAttribute("height")},this.readChildNodes(t,e.logo)},Style:function(t,e){var i={};e.styles.push(i),this.readChildNodes(t,i)},LegendURL:function(t,e){var i={width:t.getAttribute("width"),height:t.getAttribute("height")};e.legend=i,this.readChildNodes(t,i)},MetadataURL:function(t,e){var i={type:t.getAttribute("type")};e.metadataURLs.push(i),this.readChildNodes(t,i)},DataURL:function(t,e){e.dataURL={},this.readChildNodes(t,e.dataURL)},FeatureListURL:function(t,e){e.featureListURL={},this.readChildNodes(t,e.featureListURL)},AuthorityURL:function(t,e){var i=t.getAttribute("name"),n={};this.readChildNodes(t,n),e.authorityURLs[i]=n.href},Identifier:function(t,e){var i=t.getAttribute("authority");e.identifiers[i]=this.getChildValue(t)},KeywordList:function(t,e){this.readChildNodes(t,e)},SRS:function(t,e){e.srs[this.getChildValue(t)]=!0}}}});a.a.geoway.format.WMSCapabilities.v1=f;var p=f.extend({readers:{wms:a.a.Util.applyDefaults({WMT_MS_Capabilities:function(t,e){this.readChildNodes(t,e)},Keyword:function(t,e){e.keywords&&e.keywords.push(this.getChildValue(t))},DescribeLayer:function(t,e){e.describelayer={formats:[]},this.readChildNodes(t,e.describelayer)},GetLegendGraphic:function(t,e){e.getlegendgraphic={formats:[]},this.readChildNodes(t,e.getlegendgraphic)},GetStyles:function(t,e){e.getstyles={formats:[]},this.readChildNodes(t,e.getstyles)},PutStyles:function(t,e){e.putstyles={formats:[]},this.readChildNodes(t,e.putstyles)},UserDefinedSymbolization:function(t,e){var i={supportSLD:1==parseInt(t.getAttribute("SupportSLD")),userLayer:1==parseInt(t.getAttribute("UserLayer")),userStyle:1==parseInt(t.getAttribute("UserStyle")),remoteWFS:1==parseInt(t.getAttribute("RemoteWFS"))};e.userSymbols=i},LatLonBoundingBox:function(t,e){e.llbbox=[parseFloat(t.getAttribute("minx")),parseFloat(t.getAttribute("miny")),parseFloat(t.getAttribute("maxx")),parseFloat(t.getAttribute("maxy"))]},BoundingBox:function(t,e){var i=f.prototype.readers.wms.BoundingBox.apply(this,[t,e]);i.srs=t.getAttribute("SRS"),e.bbox[i.srs]=i},ScaleHint:function(){},Dimension:function(t,e){var i={name:t.getAttribute("name").toLowerCase(),units:t.getAttribute("units"),unitsymbol:t.getAttribute("unitSymbol")};e.dimensions[i.name]=i},Extent:function(t,e){var i=t.getAttribute("name").toLowerCase();if(i in e.dimensions){var n=e.dimensions[i];n.nearestVal="1"===t.getAttribute("nearestValue"),n.multipleVal="1"===t.getAttribute("multipleValues"),n.current="1"===t.getAttribute("current"),n.default=t.getAttribute("default")||"";var r=this.getChildValue(t);n.values=r.split(",")}}},f.prototype.readers.wms)}});a.a.geoway.format.WMSCapabilities.v1_1=p;var d=p.extend({version:"1.1.1",readers:{wms:a.a.Util.applyDefaults({SRS:function(t,e){e.srs[this.getChildValue(t)]=!0}},p.prototype.readers.wms)}});a.a.geoway.format.WMSCapabilities.v1_1_1=d;var g=i(22),y=i(23)},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(e,i,n,r,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),null==s&&(s=5);var o=5*a/100;this.left=e-o,this.right=i+o,this.bottom=n-o,this.top=r+o,this.previous=t.createEmptyDoubleArray(),this.now=t.createEmptyDoubleArray(),this.question=t.createEmptyDoubleArray(),this.point_previous_quadrant=-1,this.point_now_quadrant=-1,this.point_question_quadrant=-1}var e,i,r;return e=t,r=[{key:"createEmptyDoubleArray",value:function(){return[NaN,NaN]}},{key:"isEmpty",value:function(t){return null==t||!(!isNaN(t[0])&&!isNaN(t[1]))}},{key:"length",value:function(t,e,i,n){var r=i-t,a=n-e;return Math.sqrt(r*r+a*a)}}],(i=[{key:"copy",value:function(t,e){e[0]=t[0],e[1]=t[1]}},{key:"isQuadrant",value:function(t){var e=t[0],i=t[1];return e<this.left?i>this.top?8:i<this.bottom?2:1:e>this.right?i>this.top?6:i<this.bottom?4:5:i>this.top?7:i<this.bottom?3:9}},{key:"passrule",value:function(t,e){return 1==t?1==e||2==e||8==e?2:1:2==t?1==e||2==e||8==e||3==e||4==e?2:1:3==this.point_previous_quadrant?2==this.point_now_quadrant||3==this.point_now_quadrant||4==this.point_now_quadrant?2:1:4==t?2==e||3==e||4==e||5==e||6==e?2:1:5==t?4==e||5==e||6==e?2:1:6==t?4==e||5==e||6==e||7==e||8==e?2:1:7==t?6==e||7==e||8==e?2:1:8==t&&(6==e||7==e||8==e||1==e||2==e)?2:1}},{key:"reset",value:function(){this.previous[0]=NaN,this.previous[1]=NaN,this.question[0]=NaN,this.question[1]=NaN,this.now[0]=NaN,this.now[1]=NaN,this.point_previous_quadrant=-1,this.point_now_quadrant=-1,this.point_question_quadrant=-1}},{key:"in",value:function(t){return!(t[0]<this.left||t[0]>this.right)&&!(t[1]<this.bottom||t[1]>this.top)}},{key:"push",value:function(e,i){if(this.now[0]=e,this.now[1]=i,t.isEmpty(this.previous))return this.copy(this.now,this.previous),this.point_previous_quadrant=this.isQuadrant(this.now),[this.now];this.point_now_quadrant=this.isQuadrant(this.now);var n=this.passrule(this.point_previous_quadrant,this.point_now_quadrant);if(1==n){if(this.point_previous_quadrant=this.isQuadrant(this.now),this.copy(this.now,this.previous),t.isEmpty(this.question))return[this.now];var r=[];return this.copy(this.question,r),this.question=t.createEmptyDoubleArray(),[r,this.now]}if(2==n){if(!t.isEmpty(this.question)&&1==(n=this.passrule(this.point_question_quadrant,this.point_now_quadrant))){var a=[];return this.copy(this.question,a),this.question=t.createEmptyDoubleArray(),[a,this.now]}return this.copy(this.now,this.question),this.point_question_quadrant=this.point_now_quadrant,null}return null}}])&&n(e.prototype,i),r&&n(e,r),t}(),a=i(8),s=i(7),o=i(6);function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=new r(0,512,0,512,512,5),u=(new r(0,256,0,256,256,5),new r(0,256,0,256,256,5)),c=new r(256,512,0,256,256,5),f=new r(0,256,256,512,256,5),p=new r(256,512,256,512,256,5),d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"draw",value:function(t,e,i,n,r,a,s,o,h,l){t.lineJoin="round";var u=null;r&&(u=new Map),l&&(e=this.sort(e));for(var c=0;c<e.length;c++){var f=e[c],p=i[f.styleId];if(1!=f.type){if(2==f.type&&(this.drawLine(t,f,p,n,u,a,s,o,h),l))for(var d=0;d<f.boxs.length;d++){var g=f.boxs[d];this.drawAvoidBox(t,g,f.hidden)}}else this.drawPointIcon(t,f,p,n,u,s,o),this.drawPoint(t,f,p,n,u,a,s,o,h),l&&this.drawAvoidBox(t,f.box,f.hidden)}u=null}},{key:"drawDefaultStyle",value:function(t,e,i,n,r,a,s,o){var h=null;r&&(h=new Map);for(var l=0;l<e.length;l++){var u=e[l],c=i[u.styleId];1!=u.type?2==u.type&&this.drawLineDefaultStyle(t,u,c,n,h,a,s,o):this.drawPointDefaultStyle(t,u,c,n,h,a,s,o)}h=null}},{key:"drawPointIcon",value:function(t,e,i,n,r,a,s){if(i.texture){var o=i.graphicWidth,h=i.graphicHeight,l=e.iconImg;if(l){o&&h||(o=l.width,h=l.height,r&&(o/=n,h/=n));var u=i.graphicXOffset-.5*o,c=i.graphicYOffset-.5*h,f=i.pointOffsetX,p=i.pointOffsetY;f||(f=0),p||(p=0);var d=[e.datas[0][0][0],e.datas[0][0][1]];d[0]=d[0]+f,d[1]=d[1]+p;var g=d[0]+u,y=d[1]+c,v=i.pointFillAlpha||1;if(r){var m=i.texture+"_"+g+"_"+y;if(null!=r.get(m))return;r.set(m,!0)}t.save(),t.globalAlpha=v,t.drawImage(l,g*n,y*n,o*n,h*n),t.restore(),s&&(a.save(),this.setHitContextStyle(a,e.id),a.fillRect(g,y,o,h),a.restore())}}}},{key:"drawPoint",value:function(t,e,i,n,r,h,l,u,c){if(e.label){var f=e.textPoint;if(r){var p,d=a.a.boxToPolyArr(e.box[0],e.box[1],e.box[2],e.box[3]);if(t.canvas.width/n==512)p=a.a.boxToPolyArr(-20,-20,532,532);else if(t.canvas.width/n==256)switch(c){case 0:p=a.a.boxToPolyArr(-15,-15,271,271);break;case 1:p=a.a.boxToPolyArr(241,-15,527,271);break;case 2:p=a.a.boxToPolyArr(-15,241,271,527);break;case 3:p=a.a.boxToPolyArr(241,241,527,527)}if(3==a.a.polyWith(p,d))return;var g=e.label+"_"+f[0]+"_"+f[1];if(null!=r.get(g))return;r.set(g,!0)}var y=e.label.split(" "),v=y.length,m=i.pointHeight;m+=2;var _=o.a.formatFont(i.pointFillFont,n,h),w=o.a.formatFont(i.pointStrokeFont,n,h);t.save(),t.font=w;for(var b=0,x=[],M=0;M<v;M++){var L=s.a.measureText(y[M].replace(/&nbsp;/g," "),t.font,t);x.push(L),L>b&&(b=L)}t.restore();var k=f[0]-i.pointBackgroundGap,S=f[1]-i.pointBackgroundGap-i.pointHeight/2;1==i.pointHashBackground&&(t.save(),t.globalAlpha=i.pointBackgroundAlpha,t.strokeStyle=i.pointBackgroundLineColor,t.lineWidth=i.pointBackgroundLineWidth,t.fillStyle=i.pointBackgroundColor,t.font=i.pointFillFont,this.drawRoundRect(t,k,S,b/n+2*i.pointBackgroundGap,i.pointHeight*v+2*i.pointBackgroundGap+2*(v-1),i.pointBackgroundRadius,n),t.fill(),t.restore());var C=this.getPointTextDirection(f[0],e.datas[0][0][0],b);this.drawPointText(t,y,C,i,_,w,m,n,f,x,b,e),u&&(1==i.pointHashBackground?(l.save(),this.setHitContextStyle(l,e.id),this.drawHitRoundRect(l,k,S,b/n+2*i.pointBackgroundGap,m*v+2*i.pointBackgroundGap,i.pointBackgroundRadius),l.fill(),l.restore()):(l.save(),this.setHitContextStyle(l,e.id),l.textBaseline="middle",l.fillRect(f[0],f[1]-i.pointHeight/2,b/n,m*v),l.restore()))}}},{key:"getPointTextDirection",value:function(t,e,i){return t>e?0:e>t+i?1:2}},{key:"drawPointText",value:function(t,e,i,n,r,a,s,o,h,l,u,c){for(var f=e.length,p=0;p<f;p++){var d=l[p],g=h[0];1==i&&(g=h[0]+(u-d)),2==i&&(g=h[0]+.5*(u-d)),1==n.pointHashOutline&&(t.save(),t.textBaseline="middle",t.globalAlpha=n.pointStrokeAlpha,t.strokeStyle=n.pointStrokeStyle,t.lineWidth=n.pointLineWidth,t.font=a,t.strokeText(e[p].replace(/&nbsp;/g," "),g*o,(h[1]+s*p)*o),t.restore()),t.save(),t.textBaseline="middle",t.globalAlpha=n.pointFillAlpha,c.hasOwnProperty("lightColor")?t.fillStyle=c.lightColor:c.hidden?t.fillStyle="#969393":t.fillStyle=n.pointFillStyle,t.font=r,t.fillText(e[p].replace(/&nbsp;/g," "),g*o,(h[1]+s*p)*o),t.restore()}}},{key:"drawLine",value:function(t,e,i,n,r,a,s,o,h){"text"==e.lineType&&this.drawLineText(t,e,i,n,r,a,s,o,h),"code"==e.lineType&&this.drawLineCode(t,e,i,n,r,a,s,o),"arrow"==e.lineType&&this.drawLineArrow(t,e,i,n,r,s,o)}},{key:"drawLineText",value:function(t,e,i,n,r,a,s,h,d){var g,y=e.label,v=e.textPoints;if(r)if(t.canvas.width/n==512)g=l;else if(t.canvas.width/n==256)switch(d){case 0:g=u;break;case 1:g=c;break;case 2:g=f;break;case 3:g=p}var m=o.a.formatFont(i.lineFillFont,n,a),_=o.a.formatFont(i.lineStrokeFont,n,a);if(1==i.lineHashBackground||1==v.length){var w=v[Math.floor(v.length/2)][0];1==v.length?this.drawBgText(t,y,n,w,i.backgroundAlpha,i.backgroundLineColor,i.backgroundLineWidth,i.backgroundColor,i.lineFillFont,i.lineBackgroundGap,i.lineHeight,i.lineBackgroundRadius,i.lineHashOutline,i.lineStrokeAlpha,i.lineStrokeStyle,i.lineLineWidth,i.lineStrokeFont,i.lineFillAlpha,i.lineFillStyle,s,h,e.id,i.lineHashBackground,a,e):this.drawBgText(t,y,n,w,i.backgroundAlpha,i.backgroundLineColor,i.backgroundLineWidth,i.backgroundColor,i.lineFillFont,i.lineBackgroundGap,i.lineHeight,i.lineBackgroundRadius,i.lineHashOutline,i.lineStrokeAlpha,i.lineStrokeStyle,i.lineLineWidth,i.lineStrokeFont,i.lineFillAlpha,i.lineFillStyle,s,h,e.id,!0,a,e)}else for(var b=e.lineFillStyle?e.lineFillStyle:i.lineFillStyle,x=0;x<y.length;x++){var M=v[x],L=M[1],k=M[0],S=y.charAt(x);if(r){var C=S+"_"+k[0]+"_"+k[1]+"_"+L;if(null!=r.get(C))continue;if(r.set(C,!0),!g.in([k[0]/n,k[1]/n]))continue}1==i.lineHashOutline&&(t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=i.lineStrokeAlpha,t.strokeStyle=i.lineStrokeStyle,t.lineWidth=i.lineLineWidth,t.font=_,t.translate(k[0]*n,k[1]*n),t.rotate(L*Math.PI/180),t.strokeText(S,0,0),t.restore()),t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=i.lineFillAlpha,e.hasOwnProperty("lightColor")?t.fillStyle=e.lightColor:e.hidden?t.fillStyle="#969393":t.fillStyle=b,t.font=m,t.translate(k[0]*n,k[1]*n),t.rotate(L*Math.PI/180),t.fillText(S,0,0),t.restore(),h&&(s.save(),this.setHitContextStyle(s,e.id),s.translate(k[0],k[1]),s.rotate(L*Math.PI/180),s.fillRect(1.2*-i.lineHeight*.5,1.2*-i.lineHeight*.5,1.2*i.lineHeight,1.2*i.lineHeight),s.restore())}}},{key:"drawLineCode",value:function(t,e,i,n,r,a,s,o){var h=e.codePoint,l=e.label;1==i.showRoadCode&&l&&l.length>0&&this.drawBgText(t,l,n,h,i.codeBackgroundAlpha,i.codeBackgroundLineColor,i.codeBackgroundLineWidth,i.codeBackgroundColor,i.codeLineFillFont,i.codeLineBackgroundGap,i.codeLineHeight,i.codeLineBackgroundRadius,i.codeLineHashOutline,i.codeLineStrokeAlpha,i.codeLineStrokeStyle,i.codeLineLineWidth,i.codeLineStrokeFont,i.codeLineFillAlpha,i.codeLineFillStyle,s,o,e.id,!0,a,e)}},{key:"drawLineArrow",value:function(t,e,i,n,r,a,s){var o=e.arrowPoint,h=i.arrowDirectionValue;i.arrowDirectionField&&(h=e.attributes[i.arrowDirectionField]);var l=o[0][0],u=o[1][0];0==h&&(l=o[1][0],u=o[2][0]),t.save(),t.lineWidth=i.arrowLineWidth,t.strokeStyle=i.arrowFillStyle,e.hasOwnProperty("lightColor")?t.fillStyle=e.lightColor:e.hidden?t.fillStyle="#969393":t.fillStyle=i.arrowFillStyle,t.beginPath(),t.moveTo(l[0]*n,l[1]*n),t.lineTo(u[0]*n,u[1]*n),t.stroke();var c=0,f=0;u[0]==l[0]?(h&&u[1]>l[1]||!h&&u[1]<l[1])&&(c=Math.PI):(c=Math.atan((u[1]-l[1])/(u[0]-l[0])),f=(u[0]>l[0]?90:-90)*Math.PI/180),0==h?(c-=f,this.drawArrowhead(t,l[0],l[1],c,n,i.arrowSize)):(c+=f,this.drawArrowhead(t,u[0],u[1],c,n,i.arrowSize)),t.restore()}},{key:"drawArrowhead",value:function(t,e,i,n,r,a){t.beginPath(),t.translate(e*r,i*r),t.rotate(n),t.moveTo(0,-a*r),t.lineTo(.5*a*r,0),t.lineTo(.5*-a*r,0),t.closePath(),t.fill()}},{key:"drawRoundRect",value:function(t,e,i,n,r,a,s){t.beginPath(),t.arc((e+a)*s,(i+a)*s,a*s,Math.PI,3*Math.PI/2),t.lineTo((n-a+e)*s,i*s),t.arc((n-a+e)*s,(a+i)*s,a*s,3*Math.PI/2,2*Math.PI),t.lineTo((n+e)*s,(r+i-a)*s),t.arc((n-a+e)*s,(r-a+i)*s,a*s,0,1*Math.PI/2),t.lineTo((a+e)*s,(r+i)*s),t.arc((a+e)*s,(r-a+i)*s,a*s,1*Math.PI/2,Math.PI),t.closePath()}},{key:"drawBgText",value:function(t,e,i,n,r,a,h,l,u,c,f,p,d,g,y,v,m,_,w,b,x,M,L,k,S){n[0]=Math.round(n[0]),n[1]=Math.round(n[1]),t.save(),t.globalAlpha=r,t.strokeStyle=a,t.lineWidth=h,t.fillStyle=l,t.font=o.a.formatFont(u,1,k);var C=s.a.measureText(e,t.font,t),T=n[0]-C/2-c,P=n[1]-f/2-c;L&&(this.drawRoundRect(t,T,P,C+2*c,f+2*c,p,i),t.fill()),t.restore(),u=o.a.formatFont(u,i,k),m=o.a.formatFont(m,i,k),1==d&&(t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=g,t.strokeStyle=y,t.lineWidth=v,t.font=m,t.translate(n[0]*i,n[1]*i),t.strokeText(e,0,0),t.restore()),t.save(),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=_,S.hasOwnProperty("lightColor")?t.fillStyle=S.lightColor:S.hidden?t.fillStyle="#969393":t.fillStyle=w,t.font=u,t.translate(n[0]*i,n[1]*i),t.fillText(e,0,0),t.restore(),x&&(b.save(),this.setHitContextStyle(b,M),this.drawHitRoundRect(b,T,P,C+2*c,f+2*c,p),b.fill(),b.restore())}},{key:"drawPointDefaultStyle",value:function(t,e,i,n,r,a,s,o){var h=e.datas[0][0];t.save(),t.fillStyle=i.pointFillStyle,t.beginPath(),t.arc(h[0],h[1],i.radius,0,2*Math.PI),t.fill(),t.restore(),o&&(s.save(),this.setHitContextStyle(s,e.id),s.beginPath(),s.arc(h[0],h[1],i.radius,0,2*Math.PI),s.fill(),s.restore())}},{key:"drawLineDefaultStyle",value:function(t,e,i,n,r,a,s,o){var h=e.datas;t.save(),t.lineWidth=i.lineWidth,t.strokeStyle=i.lineFillStyle,t.beginPath(),t.moveTo(h[0][0][0],h[0][0][1]);for(var l=1;l<h.length;l++)t.lineTo(h[l][0][0],h[l][0][1]);t.stroke(),t.restore()}},{key:"featureIdToHex",value:function(t){var e="000000"+(Number(t)+1).toString(16),i=e.length;return e="#"+e.substring(i-6,i)}},{key:"setHitContextStyle",value:function(t,e){var i=this.featureIdToHex(e);t.globalAlpha=1,t.fillStyle=i}},{key:"drawHitRoundRect",value:function(t,e,i,n,r,a){t.beginPath(),t.arc(e+a,i+a,a,Math.PI,3*Math.PI/2),t.lineTo(n-a+e,i),t.arc(n-a+e,a+i,a,3*Math.PI/2,2*Math.PI),t.lineTo(n+e,r+i-a),t.arc(n-a+e,r-a+i,a,0,1*Math.PI/2),t.lineTo(a+e,r+i),t.arc(a+e,r-a+i,a,1*Math.PI/2,Math.PI),t.closePath()}},{key:"drawLines",value:function(t,e,i,n,r,a,s,o,h){var l=null;r&&(l=new Map);for(var u=0;u<e.length;u++){var c=e[u];if(2==c.type){var f=h.lineToSourceAngleData(c.sourceData);c.lines=h.transformData(f,c.xyz);var p=i[c.styleId];this.drawLineStyle(t,c,p,n,l,a,s,o)}}l=null}},{key:"drawLineStyle",value:function(t,e,i,n,r,a,s,o){var h=e.lines;t.save(),t.lineWidth=i.lineWidth,t.strokeStyle=i.lineFillStyle,t.beginPath(),t.moveTo(h[0][0][0],h[0][0][1]);for(var l=1;l<h.length;l++)t.lineTo(h[l][0][0],h[l][0][1]);t.stroke(),t.restore()}},{key:"drawAvoidBox",value:function(t,e,i){t.save(),t.lineWidth=1,t.strokeStyle=i?"#969393":"#2d8cf0",t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[2],e[1]),t.lineTo(e[2],e[3]),t.lineTo(e[0],e[3]),t.lineTo(e[0],e[1]),t.stroke(),t.restore()}},{key:"sort",value:function(t){if(t.length>0)return t.sort(function(t,e){return!t.hidden&&e.hidden?1:t.hidden&&!e.hidden?-1:0})}}],(i=null)&&h(e.prototype,i),n&&h(e,n),t}();e.a=d},function(t,e,i){"use strict";var n=i(0),r=i.n(n),a=r.a.Popup.extend({includes:r.a.Evented.prototype,initialize:function(t,e){this._sort="tip-popup",r.a.Popup.prototype.initialize.call(this,t,e)},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),this.options.keepInView&&(t.moveend=this._adjustPan),t},openOn:function(t){t.openTipPopup(this)},_initLayout:function(){var t="leaflet-popup",e=t+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),i=this._container=r.a.DomUtil.create("div",e),n=this._wrapper=r.a.DomUtil.create("div",t+"-content-wrapper measure-tip-wrapper",i);r.a.DomEvent.disableClickPropagation(n),this._contentNode=r.a.DomUtil.create("div",t+"-tipcontent",n),r.a.DomEvent.disableScrollPropagation(this._contentNode),r.a.DomEvent.on(n,"contextmenu",r.a.DomEvent.stopPropagation)}});r.a.Map.include({openTipPopup:function(t,e,i){if(!(t instanceof r.a.Popup)){var n=t;t=new r.a.TipPopup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&"tip-popup"!=t._sort&&(this.removeLayer(t),t._isOpen=!1),this}}),e.a=a},function(t,e,i){"use strict";var n=i(0),r=i.n(n);i(1);function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=null,this.filters={},this.idFilter=null,this.filterStr=null,this.display=!0,this.color=null}var e,i,n;return e=t,(i=[{key:"addFilterField",value:function(t,e){this.filters[t]=e}},{key:"removeFilterField",value:function(t){delete this.filters[t]}}])&&a(e.prototype,i),n&&a(e,n),t}();r.a.geoway.FilterLayer=s,e.a=s},function(t,e,i){"use strict";var n=i(0),r=i.n(n),a=r.a.Class.extend({options:null,initialize:function(t){this.options=r.a.setOptions(this,t)},destroy:function(){},read:function(){},write:function(){}});e.a=a},function(t,e){function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"===("undefined"==typeof window?"undefined":i(window))&&(n=window)}t.exports=n},function(t,e,i){"use strict";var n=i(0),r=i.n(n);i(1);function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.otherDisplay=!0,this.layers=[],this.order=[]}var e,i,n;return e=t,(i=[{key:"addFilterLayer",value:function(t){this.layers.push(t)}},{key:"removeFilterLayerById",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].id==t&&this.layers.splice(e,1)}}])&&a(e.prototype,i),n&&a(e,n),t}();r.a.geoway.Filter=s,e.a=s},function(t,e,i){"use strict";i.d(e,"a",function(){return fi}),i.d(e,"b",function(){return pi});var n=i(0),r=i.n(n),a=1,s=2,o=4,h=5,l=484813681109536e-20,u=Math.PI/2,c=.16666666666666666,f=.04722222222222222,p=.022156084656084655,d=1e-10,g=.017453292519943295,y=57.29577951308232,v=Math.PI/4,m=2*Math.PI,_=3.14159265359,w={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},b={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},x=/[\s_\-\/\(\)]/g;function M(t,e){if(t[e])return t[e];for(var i,n=Object.keys(t),r=e.toLowerCase().replace(x,""),a=-1;++a<n.length;)if((i=n[a]).toLowerCase().replace(x,"")===r)return t[i]}var L=function(t){var e,i,n,r={},a=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t},{}),s={proj:"projName",datum:"datumCode",rf:function(t){r.rf=parseFloat(t)},lat_0:function(t){r.lat0=t*g},lat_1:function(t){r.lat1=t*g},lat_2:function(t){r.lat2=t*g},lat_ts:function(t){r.lat_ts=t*g},lon_0:function(t){r.long0=t*g},lon_1:function(t){r.long1=t*g},lon_2:function(t){r.long2=t*g},alpha:function(t){r.alpha=parseFloat(t)*g},lonc:function(t){r.longc=t*g},x_0:function(t){r.x0=parseFloat(t)},y_0:function(t){r.y0=parseFloat(t)},k_0:function(t){r.k0=parseFloat(t)},k:function(t){r.k0=parseFloat(t)},a:function(t){r.a=parseFloat(t)},b:function(t){r.b=parseFloat(t)},r_a:function(){r.R_A=!0},zone:function(t){r.zone=parseInt(t,10)},south:function(){r.utmSouth=!0},towgs84:function(t){r.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){r.to_meter=parseFloat(t)},units:function(t){r.units=t;var e=M(b,t);e&&(r.to_meter=e.to_meter)},from_greenwich:function(t){r.from_greenwich=t*g},pm:function(t){var e=M(w,t);r.from_greenwich=(e||parseFloat(t))*g},nadgrids:function(t){"@null"===t?r.datumCode="none":r.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(r.axis=t)}};for(e in a)i=a[e],e in s?"function"==typeof(n=s[e])?n(i):r[n]=i:r[e]=i;return"string"==typeof r.datumCode&&"WGS84"!==r.datumCode&&(r.datumCode=r.datumCode.toLowerCase()),r},k=function(t){return new I(t).output()},S=1,C=/\s/,T=/[A-Za-z]/,P=/[A-Za-z84]/,E=/[,\]]/,A=/[\d\.E\-\+]/;function I(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=S}function D(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var n=e?{}:t,r=i.reduce(function(t,e){return O(e,t),t},n);e&&(t[e]=r)}function O(t,e){if(Array.isArray(t)){var i=t.shift();if("PARAMETER"===i&&(i=t.shift()),1===t.length)return Array.isArray(t[0])?(e[i]={},void O(t[0],e[i])):void(e[i]=t[0]);if(t.length)if("TOWGS84"!==i){if("AXIS"===i)return i in e||(e[i]=[]),void e[i].push(t);var n;switch(Array.isArray(i)||(e[i]={}),i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[i]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&O(t[2],e[i]));case"SPHEROID":case"ELLIPSOID":return e[i]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&O(t[3],e[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void D(e,i,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return O(t,e[i]);return D(e,i,t)}}else e[i]=t;else e[i]=!0}else e[t]=!0}function F(t){"@babel/helpers - typeof";return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}I.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;C.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case S:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},I.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(E.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},I.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=S)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=S,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},I.prototype.number=function(t){if(!A.test(t)){if(E.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},I.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},I.prototype.keyword=function(t){if(P.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=S)}if(!E.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},I.prototype.neutral=function(t){if(T.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(A.test(t))return this.word=t,void(this.state=3);if(!E.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},I.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var R=.017453292519943295;function N(t){return t*R}var B=function(t){var e=k(t),i=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",i]);var r={};return O(e,r),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"===F(t.PROJECTION)?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",i=0,n=t.AXIS.length;i<n;++i){var r=t.AXIS[i][0].toLowerCase();-1!==r.indexOf("north")?e+="n":-1!==r.indexOf("south")?e+="s":-1!==r.indexOf("east")?e+="e":-1!==r.indexOf("west")&&(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var a=t.GEOGCS;function s(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(a=t),a&&(a.DATUM?t.datumCode=a.DATUM.name.toLowerCase():t.datumCode=a.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(t.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=a.DATUM.SPHEROID.a,t.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(t.datum_params=a.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",N],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",N],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",N],["lat0","latitude_of_origin",N],["lat0","standard_parallel_1",N],["lat1","standard_parallel_1",N],["lat2","standard_parallel_2",N],["azimuth","Azimuth"],["alpha","azimuth",N],["srsCode","name"]].forEach(function(e){return i=t,r=(n=e)[0],a=n[1],void(!(r in i)&&a in i&&(i[r]=i[a],3===n.length&&(i[r]=n[2](i[r]))));var i,n,r,a}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=N(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(r),r};function z(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?z[t]=L(arguments[1]):z[t]=B(arguments[1]):z[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?z.apply(e,t):z(t)});if("string"==typeof t){if(t in z)return z[t]}else"EPSG"in t?z["EPSG:"+t.EPSG]=t:"ESRI"in t?z["ESRI:"+t.ESRI]=t:"IAU2000"in t?z["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(z);var U=z;var G=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var j=["3857","900913","3785","102113"];var q=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in U}(t))return U[t];if(function(t){return G.some(function(e){return t.indexOf(e)>-1})}(t)){var e=B(t);if(function(t){var e=M(t,"authority");if(e){var i=M(e,"epsg");return i&&j.indexOf(i)>-1}}(e))return U["EPSG:3857"];var i=function(t){var e=M(t,"extension");if(e)return M(e,"proj4")}(e);return i?L(i):e}return function(t){return"+"===t[0]}(t)?L(t):void 0},V=function(t,e){var i,n;if(t=t||{},!e)return t;for(n in e)void 0!==(i=e[n])&&(t[n]=i);return t},W=function(t,e,i){var n=t*e;return i/Math.sqrt(1-n*n)},H=function(t){return t<0?-1:1},Z=function(t){return Math.abs(t)<=_?t:t-H(t)*m},X=function(t,e,i){var n=t*i,r=.5*t;return n=Math.pow((1-n)/(1+n),r),Math.tan(.5*(u-e))/n},Y=function(t,e){for(var i,n,r=.5*t,a=u-2*Math.atan(e),s=0;s<=15;s++)if(i=t*Math.sin(a),a+=n=u-2*Math.atan(e*Math.pow((1-i)/(1+i),r))-a,Math.abs(n)<=1e-10)return a;return-9999};function Q(t){return t}var J=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=W(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,i,n=t.x,r=t.y;if(r*y>90&&r*y<-90&&n*y>180&&n*y<-180)return null;if(Math.abs(Math.abs(r)-u)<=d)return null;if(this.sphere)e=this.x0+this.a*this.k0*Z(n-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(v+.5*r));else{var a=Math.sin(r),s=X(this.e,r,a);e=this.x0+this.a*this.k0*Z(n-this.long0),i=this.y0-this.a*this.k0*Math.log(s)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n=t.x-this.x0,r=t.y-this.y0;if(this.sphere)i=u-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var a=Math.exp(-r/(this.a*this.k0));if(-9999===(i=Y(this.e,a)))return null}return e=Z(this.long0+n/(this.a*this.k0)),t.x=e,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:Q,inverse:Q,names:["longlat","identity"]}],K={},$=[];function tt(t,e){var i=$.length;return t.names?($[i]=t,t.names.forEach(function(t){K[t.toLowerCase()]=i}),this):(console.log(e),!0)}var et={start:function(){J.forEach(tt)},add:tt,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==K[e]&&$[K[e]]?$[K[e]]:void 0}},it={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},nt=it.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};it.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var rt={};rt.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},rt.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},rt.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},rt.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},rt.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},rt.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},rt.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},rt.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},rt.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},rt.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rt.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},rt.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},rt.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},rt.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},rt.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},rt.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rt.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var at=function(t,e,i,n,r,u){var c={};return c.datum_type=void 0===t||"none"===t?h:o,e&&(c.datum_params=e.map(parseFloat),0===c.datum_params[0]&&0===c.datum_params[1]&&0===c.datum_params[2]||(c.datum_type=a),c.datum_params.length>3&&(0===c.datum_params[3]&&0===c.datum_params[4]&&0===c.datum_params[5]&&0===c.datum_params[6]||(c.datum_type=s,c.datum_params[3]*=l,c.datum_params[4]*=l,c.datum_params[5]*=l,c.datum_params[6]=c.datum_params[6]/1e6+1))),c.a=i,c.b=n,c.es=r,c.ep2=u,c};function st(t){"@babel/helpers - typeof";return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ot(t,e){if(!(this instanceof ot))return new ot(t);e=e||function(t){if(t)throw t};var i=q(t);if("object"===st(i)){var n=ot.projections.get(i.projName);if(n){if(i.datumCode&&"none"!==i.datumCode){var r=M(rt,i.datumCode);r&&(i.datum_params=r.towgs84?r.towgs84.split(","):null,i.ellps=r.ellipse,i.datumName=r.datumName?r.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84";var a,s,o,h,l,u,g,y=function(t,e,i,n,r){if(!t){var a=M(it,n);a||(a=nt),t=a.a,e=a.b,i=a.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<d)&&(r=!0,e=t),{a:t,b:e,rf:i,sphere:r}}(i.a,i.b,i.rf,i.ellps,i.sphere),v=(a=y.a,s=y.b,y.rf,o=i.R_A,u=((h=a*a)-(l=s*s))/h,g=0,o?(h=(a*=1-u*(c+u*(f+u*p)))*a,u=0):g=Math.sqrt(u),{es:u,e:g,ep2:(h-l)/l}),m=i.datum||at(i.datumCode,i.datum_params,y.a,y.b,v.es,v.ep2);V(this,i),V(this,n),this.a=y.a,this.b=y.b,this.rf=y.rf,this.sphere=y.sphere,this.es=v.es,this.e=v.e,this.ep2=v.ep2,this.datum=m,this.init(),e(null,this)}else e(t)}else e(t)}ot.projections=et,ot.projections.start();var ht=ot;function lt(t,e,i){var n,r,a,s,o=t.x,h=t.y,l=t.z?t.z:0;if(h<-u&&h>-1.001*u)h=-u;else if(h>u&&h<1.001*u)h=u;else{if(h<-u)return{x:-1/0,y:-1/0,z:t.z};if(h>u)return{x:1/0,y:1/0,z:t.z}}return o>Math.PI&&(o-=2*Math.PI),r=Math.sin(h),s=Math.cos(h),a=r*r,{x:((n=i/Math.sqrt(1-e*a))+l)*s*Math.cos(o),y:(n+l)*s*Math.sin(o),z:(n*(1-e)+l)*r}}function ut(t,e,i,n){var r,a,s,o,h,l,c,f,p,d,g,y,v,m,_,w=t.x,b=t.y,x=t.z?t.z:0;if(r=Math.sqrt(w*w+b*b),a=Math.sqrt(w*w+b*b+x*x),r/i<1e-12){if(m=0,a/i<1e-12)return u,_=-n,{x:t.x,y:t.y,z:t.z}}else m=Math.atan2(b,w);s=x/a,f=(o=r/a)*(1-e)*(h=1/Math.sqrt(1-e*(2-e)*o*o)),p=s*h,v=0;do{v++,l=e*(c=i/Math.sqrt(1-e*p*p))/(c+(_=r*f+x*p-c*(1-e*p*p))),y=(g=s*(h=1/Math.sqrt(1-l*(2-l)*o*o)))*f-(d=o*(1-l)*h)*p,f=d,p=g}while(y*y>1e-24&&v<30);return{x:m,y:Math.atan(g/Math.abs(d)),z:_}}function ct(t){return t===a||t===s}var ft=function(t,e,i){return function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===a?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==s||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e)?i:t.datum_type===h||e.datum_type===h?i:t.es!==e.es||t.a!==e.a||ct(t.datum_type)||ct(e.datum_type)?(i=lt(i,t.es,t.a),ct(t.datum_type)&&(i=function(t,e,i){if(e===a)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(e===s){var n=i[0],r=i[1],o=i[2],h=i[3],l=i[4],u=i[5],c=i[6];return{x:c*(t.x-u*t.y+l*t.z)+n,y:c*(u*t.x+t.y-h*t.z)+r,z:c*(-l*t.x+h*t.y+t.z)+o}}}(i,t.datum_type,t.datum_params)),ct(e.datum_type)&&(i=function(t,e,i){if(e===a)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(e===s){var n=i[0],r=i[1],o=i[2],h=i[3],l=i[4],u=i[5],c=i[6],f=(t.x-n)/c,p=(t.y-r)/c,d=(t.z-o)/c;return{x:f+u*p-l*d,y:-u*f+p+h*d,z:l*f-h*p+d}}}(i,e.datum_type,e.datum_params)),ut(i,e.es,e.a,e.b)):i},pt=function(t,e,i){var n,r,a,s=i.x,o=i.y,h=i.z||0,l={};for(a=0;a<3;a++)if(!e||2!==a||void 0!==i.z)switch(0===a?(n=s,r=-1!=="ew".indexOf(t.axis[a])?"x":"y"):1===a?(n=o,r=-1!=="ns".indexOf(t.axis[a])?"y":"x"):(n=h,r="z"),t.axis[a]){case"e":l[r]=n;break;case"w":l[r]=-n;break;case"n":l[r]=n;break;case"s":l[r]=-n;break;case"u":void 0!==i[r]&&(l.z=n);break;case"d":void 0!==i[r]&&(l.z=-n);break;default:return null}return l},dt=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e},gt=function(t){yt(t.x),yt(t.y)};function yt(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function vt(t,e,i){var n;if(Array.isArray(i)&&(i=dt(i)),gt(i),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===a||t.datum.datum_type===s)&&"WGS84"!==e.datumCode||(e.datum.datum_type===a||e.datum.datum_type===s)&&"WGS84"!==t.datumCode}(t,e)&&(i=vt(t,n=new ht("WGS84"),i),t=n),"enu"!==t.axis&&(i=pt(t,!1,i)),"longlat"===t.projName)i={x:i.x*g,y:i.y*g,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),!(i=t.inverse(i)))return;return t.from_greenwich&&(i.x+=t.from_greenwich),i=ft(t.datum,e.datum,i),e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),"longlat"===e.projName?i={x:i.x*y,y:i.y*y,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),"enu"!==e.axis?pt(e,!0,i):i}var mt=ht("WGS84");function _t(t,e,i){var n,r,a;return Array.isArray(i)?(n=vt(t,e,i)||{x:NaN,y:NaN},i.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof n.z?[n.x,n.y,n.z].concat(i.splice(3)):[n.x,n.y,i[2]].concat(i.splice(3)):[n.x,n.y].concat(i.splice(2)):[n.x,n.y]):(r=vt(t,e,i),2===(a=Object.keys(i)).length?r:(a.forEach(function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;r[n]=i[n]}),r))}function wt(t){return t instanceof ht?t:t.oProj?t.oProj:ht(t)}var bt=function(t,e,i){t=wt(t);var n,r=!1;return void 0===e?(e=t,t=mt,r=!0):(void 0!==e.x||Array.isArray(e))&&(i=e,e=t,t=mt,r=!0),e=wt(e),i?_t(t,e,i):(n={forward:function(i){return _t(t,e,i)},inverse:function(i){return _t(e,t,i)}},r&&(n.oProj=e),n)},xt=6,Mt="AJSAJS",Lt="AFAFAF",kt=65,St=73,Ct=79,Tt=86,Pt=90,Et={forward:At,inverse:function(t){var e=Ft(Nt(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:It};function At(t,e){return e=e||5,function(t,e){var i="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(p=t.easting,d=t.northing,g=t.zoneNumber,y=Rt(g),v=Math.floor(p/1e5),m=Math.floor(d/1e5)%20,r=v,a=m,s=y,o=s-1,h=Mt.charCodeAt(o),l=Lt.charCodeAt(o),u=h+r-1,c=l+a,f=!1,u>Pt&&(u=u-Pt+kt-1,f=!0),(u===St||h<St&&u>St||(u>St||h<St)&&f)&&u++,(u===Ct||h<Ct&&u>Ct||(u>Ct||h<Ct)&&f)&&++u===St&&u++,u>Pt&&(u=u-Pt+kt-1),c>Tt?(c=c-Tt+kt-1,f=!0):f=!1,(c===St||l<St&&c>St||(c>St||l<St)&&f)&&c++,(c===Ct||l<Ct&&c>Ct||(c>Ct||l<Ct)&&f)&&++c===St&&c++,c>Tt&&(c=c-Tt+kt-1),String.fromCharCode(u)+String.fromCharCode(c))+i.substr(i.length-5,e)+n.substr(n.length-5,e);var r,a,s,o,h,l,u,c,f;var p,d,g,y,v,m}(function(t){var e,i,n,r,a,s,o,h=t.lat,l=t.lon,u=6378137,c=Dt(h),f=Dt(l);o=Math.floor((l+180)/6)+1,180===l&&(o=60);h>=56&&h<64&&l>=3&&l<12&&(o=32);h>=72&&h<84&&(l>=0&&l<9?o=31:l>=9&&l<21?o=33:l>=21&&l<33?o=35:l>=33&&l<42&&(o=37));s=Dt(6*(o-1)-180+3),.006739496752268451,e=u/Math.sqrt(1-.00669438*Math.sin(c)*Math.sin(c)),i=Math.tan(c)*Math.tan(c),n=.006739496752268451*Math.cos(c)*Math.cos(c),r=Math.cos(c)*(f-s),a=u*(.9983242984503243*c-.002514607064228144*Math.sin(2*c)+2639046602129982e-21*Math.sin(4*c)-3.418046101696858e-9*Math.sin(6*c));var p=.9996*e*(r+(1-i+n)*r*r*r/6+(5-18*i+i*i+72*n-.39089081163157013)*r*r*r*r*r/120)+5e5,d=.9996*(a+e*Math.tan(c)*(r*r/2+(5-i+9*n+4*n*n)*r*r*r*r/24+(61-58*i+i*i+600*n-2.2240339282485886)*r*r*r*r*r*r/720));h<0&&(d+=1e7);return{northing:Math.round(d),easting:Math.round(p),zoneNumber:o,zoneLetter:function(t){var e="Z";84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C");return e}(h)}}({lat:t[1],lon:t[0]}),e)}function It(t){var e=Ft(Nt(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Dt(t){return t*(Math.PI/180)}function Ot(t){return t/Math.PI*180}function Ft(t){var e=t.northing,i=t.easting,n=t.zoneLetter,r=t.zoneNumber;if(r<0||r>60)return null;var a,s,o,h,l,u,c,f,p=6378137,d=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),g=i-5e5,y=e;n<"N"&&(y-=1e7),u=6*(r-1)-180+3,f=(c=y/.9996/6367449.145945056)+(3*d/2-27*d*d*d/32)*Math.sin(2*c)+(21*d*d/16-55*d*d*d*d/32)*Math.sin(4*c)+151*d*d*d/96*Math.sin(6*c),a=p/Math.sqrt(1-.00669438*Math.sin(f)*Math.sin(f)),s=Math.tan(f)*Math.tan(f),o=.006739496752268451*Math.cos(f)*Math.cos(f),h=.99330562*p/Math.pow(1-.00669438*Math.sin(f)*Math.sin(f),1.5),l=g/(.9996*a);var v=f-a*Math.tan(f)/h*(l*l/2-(5+3*s+10*o-4*o*o-.06065547077041606)*l*l*l*l/24+(61+90*s+298*o+45*s*s-1.6983531815716497-3*o*o)*l*l*l*l*l*l/720);v=Ot(v);var m,_=(l-(1+2*s+o)*l*l*l/6+(5-2*o+28*s-3*o*o+.05391597401814761+24*s*s)*l*l*l*l*l/120)/Math.cos(f);if(_=u+Ot(_),t.accuracy){var w=Ft({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});m={top:w.lat,right:w.lon,bottom:v,left:_}}else m={lat:v,lon:_};return m}function Rt(t){var e=t%xt;return 0===e&&(e=xt),e}function Nt(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,n=null,r="",a=0;!/[A-Z]/.test(e=t.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+t;r+=e,a++}var s=parseInt(r,10);if(0===a||a+3>i)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(a++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+t;n=t.substring(a,a+=2);for(var h=Rt(s),l=function(t,e){var i=Mt.charCodeAt(e-1),n=1e5,r=!1;for(;i!==t.charCodeAt(0);){if(++i===St&&i++,i===Ct&&i++,i>Pt){if(r)throw"Bad character: "+t;i=kt,r=!0}n+=1e5}return n}(n.charAt(0),h),u=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var i=Lt.charCodeAt(e-1),n=0,r=!1;for(;i!==t.charCodeAt(0);){if(++i===St&&i++,i===Ct&&i++,i>Tt){if(r)throw"Bad character: "+t;i=kt,r=!0}n+=1e5}return n}(n.charAt(1),h);u<Bt(o);)u+=2e6;var c=i-a;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var f,p,d,g=c/2,y=0,v=0;return g>0&&(f=1e5/Math.pow(10,g),p=t.substring(a,a+g),y=parseFloat(p)*f,d=t.substring(a+g),v=parseFloat(d)*f),{easting:y+l,northing:v+u,zoneLetter:o,zoneNumber:s,accuracy:f}}function Bt(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function zt(t){"@babel/helpers - typeof";return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t,e,i){if(!(this instanceof Ut))return new Ut(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"===zt(t))this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Ut.fromMGRS=function(t){return new Ut(It(t))},Ut.prototype.toMGRS=function(t){return At([this.x,this.y],t)};var Gt=Ut,jt=.01068115234375,qt=function(t){var e=[];e[0]=1-t*(.25+t*(.046875+t*(.01953125+t*jt))),e[1]=t*(.75-t*(.046875+t*(.01953125+t*jt)));var i=t*t;return e[2]=i*(.46875-t*(.013020833333333334+.007120768229166667*t)),i*=t,e[3]=i*(.3645833333333333-.005696614583333333*t),e[4]=i*t*.3076171875,e},Vt=function(t,e,i,n){return i*=e,e*=e,n[0]*t-i*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))},Wt=function(t,e,i){for(var n=1/(1-e),r=t,a=20;a;--a){var s=Math.sin(r),o=1-e*s*s;if(r-=o=(Vt(r,s,Math.cos(r),i)-t)*(o*Math.sqrt(o))*n,Math.abs(o)<d)return r}return r};var Ht={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=qt(this.es),this.ml0=Vt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,i,n,r=t.x,a=t.y,s=Z(r-this.long0),o=Math.sin(a),h=Math.cos(a);if(this.es){var l=h*s,u=Math.pow(l,2),c=this.ep2*Math.pow(h,2),f=Math.pow(c,2),p=Math.abs(h)>d?Math.tan(a):0,g=Math.pow(p,2),y=Math.pow(g,2);e=1-this.es*Math.pow(o,2),l/=Math.sqrt(e);var v=Vt(a,o,h,this.en);i=this.a*(this.k0*l*(1+u/6*(1-g+c+u/20*(5-18*g+y+14*c-58*g*c+u/42*(61+179*y-y*g-479*g)))))+this.x0,n=this.a*(this.k0*(v-this.ml0+o*s*l/2*(1+u/12*(5-g+9*c+4*f+u/30*(61+y-58*g+270*c-330*g*c+u/56*(1385+543*y-y*g-3111*g))))))+this.y0}else{var m=h*Math.sin(s);if(Math.abs(Math.abs(m)-1)<d)return 93;if(i=.5*this.a*this.k0*Math.log((1+m)/(1-m))+this.x0,n=h*Math.cos(s)/Math.sqrt(1-Math.pow(m,2)),(m=Math.abs(n))>=1){if(m-1>d)return 93;n=0}else n=Math.acos(n);a<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=i,t.y=n,t},inverse:function(t){var e,i,n,r,a=(t.x-this.x0)*(1/this.a),s=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+s/this.k0,i=Wt(e,this.es,this.en),Math.abs(i)<u){var o=Math.sin(i),h=Math.cos(i),l=Math.abs(h)>d?Math.tan(i):0,c=this.ep2*Math.pow(h,2),f=Math.pow(c,2),p=Math.pow(l,2),g=Math.pow(p,2);e=1-this.es*Math.pow(o,2);var y=a*Math.sqrt(e)/this.k0,v=Math.pow(y,2);n=i-(e*=l)*v/(1-this.es)*.5*(1-v/12*(5+3*p-9*c*p+c-4*f-v/30*(61+90*p-252*c*p+45*g+46*c-v/56*(1385+3633*p+4095*g+1574*g*p)))),r=Z(this.long0+y*(1-v/6*(1+2*p+c-v/20*(5+28*p+24*g+8*c*p+6*c-v/42*(61+662*p+1320*g+720*g*p))))/h)}else n=u*H(s),r=0;else{var m=Math.exp(a/this.k0),_=.5*(m-1/m),w=this.lat0+s/this.k0,b=Math.cos(w);e=Math.sqrt((1-Math.pow(b,2))/(1+Math.pow(_,2))),n=Math.asin(e),s<0&&(n=-n),r=0===_&&0===b?0:Z(Math.atan2(_,b)+this.long0)}return t.x=r,t.y=n,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},Zt=function(t){var e=Math.exp(t);return e=(e-1/e)/2},Xt=function(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),n=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(n,2))},Yt=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,i=e-1;return 0===i?t:t*Math.log(e)/i}(e*(1+e/(Xt(1,e)+1))),t<0?-e:e},Qt=function(t,e){for(var i,n=2*Math.cos(2*e),r=t.length-1,a=t[r],s=0;--r>=0;)i=n*a-s+t[r],s=a,a=i;return e+i*Math.sin(2*e)},Jt=function(t,e){for(var i,n=2*Math.cos(e),r=t.length-1,a=t[r],s=0;--r>=0;)i=n*a-s+t[r],s=a,a=i;return Math.sin(e)*i},Kt=function(t,e,i){for(var n,r,a=Math.sin(e),s=Math.cos(e),o=Zt(i),h=function(t){var e=Math.exp(t);return e=(e+1/e)/2}(i),l=2*s*h,u=-2*a*o,c=t.length-1,f=t[c],p=0,d=0,g=0;--c>=0;)n=d,r=p,f=l*(d=f)-n-u*(p=g)+t[c],g=u*d-r+l*p;return[(l=a*h)*f-(u=s*o)*g,l*g+u*f]};var $t={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),i*=e,this.cgb[1]=i*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i*=e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),i*=e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(e*(-24832/14175)-2.4)),i*=e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i*=e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(.25+i*(1/64+i/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),i*=e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i*=e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i*=e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i*=e,this.utg[5]=-.03233083094085698*i,this.gtu[5]=.6650675310896665*i;var n=Qt(this.cbg,this.lat0);this.Zb=-this.Qn*(n+Jt(this.gtu,2*n))},forward:function(t){var e=Z(t.x-this.long0),i=t.y;i=Qt(this.cbg,i);var n=Math.sin(i),r=Math.cos(i),a=Math.sin(e),s=Math.cos(e);i=Math.atan2(n,s*r),e=Math.atan2(a*r,Xt(n,r*s)),e=Yt(Math.tan(e));var o,h,l=Kt(this.gtu,2*i,2*e);return i+=l[0],e+=l[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*i+this.Zb)+this.y0):(o=1/0,h=1/0),t.x=o,t.y=h,t},inverse:function(t){var e,i,n=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);if(r=(r-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var a=Kt(this.utg,2*r,2*n);r+=a[0],n+=a[1],n=Math.atan(Zt(n));var s=Math.sin(r),o=Math.cos(r),h=Math.sin(n),l=Math.cos(n);r=Math.atan2(s*l,Xt(h,l*o)),n=Math.atan2(h,l*o),e=Z(n+this.long0),i=Qt(this.cgb,r)}else e=1/0,i=1/0;return t.x=e,t.y=i,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},te=function(t,e){if(void 0===t){if((t=Math.floor(30*(Z(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t};var ee={init:function(){var t=te(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*g,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,$t.init.apply(this),this.forward=$t.forward,this.inverse=$t.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},ie=function(t,e){return Math.pow((1-t)/(1+t),e)},ne=20;var re={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+v)/(Math.pow(Math.tan(.5*this.lat0+v),this.C)*ie(this.e*t,this.ratexp))},forward:function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+v),this.C)*ie(this.e*Math.sin(i),this.ratexp))-u,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,i=t.y,n=Math.pow(Math.tan(.5*i+v)/this.K,1/this.C),r=ne;r>0&&(i=2*Math.atan(n*ie(this.e*Math.sin(t.y),-.5*this.e))-u,!(Math.abs(i-t.y)<1e-14));--r)t.y=i;return r?(t.x=e,t.y=i,t):null},names:["gauss"]};var ae={init:function(){re.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,i,n,r;return t.x=Z(t.x-this.long0),re.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),n=Math.cos(t.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*n),t.x=r*i*Math.sin(t.x),t.y=r*(this.cosc0*e-this.sinc0*i*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,i,n,r,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=Math.sqrt(t.x*t.x+t.y*t.y)){var s=2*Math.atan2(a,this.R2);e=Math.sin(s),i=Math.cos(s),r=Math.asin(i*this.sinc0+t.y*e*this.cosc0/a),n=Math.atan2(t.x*e,a*this.cosc0*i-t.y*this.sinc0*e)}else r=this.phic0,n=0;return t.x=n,t.y=r,re.inverse.apply(this,[t]),t.x=Z(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var se={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=d&&(this.k0=.5*(1+H(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=d&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=d&&(this.k0=.5*this.cons*W(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/X(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=W(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-u,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,i,n,r,a,s,o=t.x,h=t.y,l=Math.sin(h),c=Math.cos(h),f=Z(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=d&&Math.abs(h+this.lat0)<=d?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*l+this.coslat0*c*Math.cos(f)),t.x=this.a*e*c*Math.sin(f)+this.x0,t.y=this.a*e*(this.coslat0*l-this.sinlat0*c*Math.cos(f))+this.y0,t):(i=2*Math.atan(this.ssfn_(h,l,this.e))-u,r=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=d?(a=X(this.e,h*this.con,this.con*l),s=2*this.a*this.k0*a/this.cons,t.x=this.x0+s*Math.sin(o-this.long0),t.y=this.y0-this.con*s*Math.cos(o-this.long0),t):(Math.abs(this.sinlat0)<d?(e=2*this.a*this.k0/(1+r*Math.cos(f)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*r*Math.cos(f))),t.y=e*(this.cosX0*n-this.sinX0*r*Math.cos(f))+this.y0),t.x=e*r*Math.sin(f)+this.x0,t))},inverse:function(t){var e,i,n,r,a;t.x-=this.x0,t.y-=this.y0;var s=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(s/(2*this.a*this.k0));return e=this.long0,i=this.lat0,s<=d?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/s),e=Math.abs(this.coslat0)<d?this.lat0>0?Z(this.long0+Math.atan2(t.x,-1*t.y)):Z(this.long0+Math.atan2(t.x,t.y)):Z(this.long0+Math.atan2(t.x*Math.sin(o),s*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=d){if(s<=d)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,n=s*this.cons/(2*this.a*this.k0),i=this.con*Y(this.e,n),e=this.con*Z(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else r=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,s<=d?a=this.X0:(a=Math.asin(Math.cos(r)*this.sinX0+t.y*Math.sin(r)*this.cosX0/s),e=Z(this.long0+Math.atan2(t.x*Math.sin(r),s*this.cosX0*Math.cos(r)-t.y*this.sinX0*Math.sin(r)))),i=-1*Y(this.e,Math.tan(.5*(u+a)));return t.x=e,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,i){return e*=i,Math.tan(.5*(u+t))*Math.pow((1-e)/(1+e),.5*i)}};var oe={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,n=1/this.rf,r=2*n-Math.pow(n,2),a=this.e=Math.sqrt(r);this.R=this.k0*i*Math.sqrt(1-r)/(1-r*Math.pow(e,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+a*e)/(1-a*e));this.K=s-this.alpha*o+this.alpha*a/2*h},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+i)+this.K,r=2*(Math.atan(Math.exp(n))-Math.PI/4),a=this.alpha*(t.x-this.lambda0),s=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(a));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*s+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,i=t.y-this.y0,n=e/this.R,r=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(n)),s=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(r))),o=this.lambda0+s/this.alpha,h=0,l=a,u=-1e3,c=0;Math.abs(l-u)>1e-7;){if(++c>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),u=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=o,t.y=l,t},names:["somerc"]};var he={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var n,r,a=X(this.e,this.lat0,t),s=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));if(s*s<1&&(s=1),isNaN(this.longc)){var o=X(this.e,this.lat1,Math.sin(this.lat1)),h=X(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(s+Math.sqrt(s*s-1))*Math.pow(a,this.bl):this.el=(s-Math.sqrt(s*s-1))*Math.pow(a,this.bl);var l=Math.pow(o,this.bl),u=Math.pow(h,this.bl);r=.5*((n=this.el/l)-1/n);var c=(this.el*this.el-u*l)/(this.el*this.el+u*l),f=(u-l)/(u+l),p=Z(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(c*Math.tan(.5*this.bl*p)/f)/this.bl,this.long0=Z(this.long0);var d=Z(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*d)/r),this.alpha=Math.asin(s*Math.sin(this.gamma0))}else n=this.lat0>=0?s+Math.sqrt(s*s-1):s-Math.sqrt(s*s-1),this.el=n*Math.pow(a,this.bl),r=.5*(n-1/n),this.gamma0=Math.asin(Math.sin(this.alpha)/s),this.long0=this.longc-Math.asin(r*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha))},forward:function(t){var e,i,n,r=t.x,a=t.y,s=Z(r-this.long0);if(Math.abs(Math.abs(a)-u)<=d)n=a>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(v+n*this.gamma0*.5)),e=-1*n*u*this.al/this.bl;else{var o=X(this.e,a,Math.sin(a)),h=this.el/Math.pow(o,this.bl),l=.5*(h-1/h),c=.5*(h+1/h),f=Math.sin(this.bl*s),p=(l*Math.sin(this.gamma0)-f*Math.cos(this.gamma0))/c;i=Math.abs(Math.abs(p)-1)<=d?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-p)/(1+p))/this.bl,e=Math.abs(Math.cos(this.bl*s))<=d?this.al*this.bl*s:this.al*Math.atan2(l*Math.cos(this.gamma0)+f*Math.sin(this.gamma0),Math.cos(this.bl*s))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},inverse:function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var n=Math.exp(-1*this.bl*i/this.al),r=.5*(n-1/n),a=.5*(n+1/n),s=Math.sin(this.bl*e/this.al),o=(s*Math.cos(this.gamma0)+r*Math.sin(this.gamma0))/a,h=Math.pow(this.el/Math.sqrt((1+o)/(1-o)),1/this.bl);return Math.abs(o-1)<d?(t.x=this.long0,t.y=u):Math.abs(o+1)<d?(t.x=this.long0,t.y=-1*u):(t.y=Y(this.e,h),t.x=Z(this.long0-Math.atan2(r*Math.cos(this.gamma0)-s*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]};var le={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<d)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),n=W(this.e,e,i),r=X(this.e,this.lat1,e),a=Math.sin(this.lat2),s=Math.cos(this.lat2),o=W(this.e,a,s),h=X(this.e,this.lat2,a),l=X(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>d?this.ns=Math.log(n/o)/Math.log(r/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=d&&(i=H(i)*(u-2*d));var n,r,a=Math.abs(Math.abs(i)-u);if(a>d)n=X(this.e,i,Math.sin(i)),r=this.a*this.f0*Math.pow(n,this.ns);else{if((a=i*this.ns)<=0)return null;r=0}var s=this.ns*Z(e-this.long0);return t.x=this.k0*(r*Math.sin(s))+this.x0,t.y=this.k0*(this.rh-r*Math.cos(s))+this.y0,t},inverse:function(t){var e,i,n,r,a,s=(t.x-this.x0)/this.k0,o=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+o*o),i=1):(e=-Math.sqrt(s*s+o*o),i=-1);var h=0;if(0!==e&&(h=Math.atan2(i*s,i*o)),0!==e||this.ns>0){if(i=1/this.ns,n=Math.pow(e/(this.a*this.f0),i),-9999===(r=Y(this.e,n)))return null}else r=-u;return a=Z(h/this.ns+this.long0),t.x=a,t.y=r,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]};var ue={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,i,n,r,a,s,o,h=t.x,l=t.y,u=Z(h-this.long0);return e=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/e)-this.s45),n=-u*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),a=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(r)),s=this.n*a,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),t.y=o*Math.cos(s)/1,t.x=o*Math.sin(s)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,i,n,r,a,s,o,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),r=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),i=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(e)),t.x=this.long0-i/this.alfa,s=e,o=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(o=1),s=t.y,l+=1}while(0===o&&l<15);return l>=15?null:t},names:["Krovak","krovak"]},ce=function(t,e,i,n,r){return t*r-e*Math.sin(2*r)+i*Math.sin(4*r)-n*Math.sin(6*r)},fe=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))},pe=function(t){return.375*t*(1+.25*t*(1+.46875*t))},de=function(t){return.05859375*t*t*(1+.75*t)},ge=function(t){return t*t*t*(35/3072)},ye=function(t,e,i){var n=e*i;return t/Math.sqrt(1-n*n)},ve=function(t){return Math.abs(t)<u?t:t-H(t)*Math.PI},me=function(t,e,i,n,r){var a,s;a=t/e;for(var o=0;o<15;o++)if(a+=s=(t-(e*a-i*Math.sin(2*a)+n*Math.sin(4*a)-r*Math.sin(6*a)))/(e-2*i*Math.cos(2*a)+4*n*Math.cos(4*a)-6*r*Math.cos(6*a)),Math.abs(s)<=1e-10)return a;return NaN};var _e={init:function(){this.sphere||(this.e0=fe(this.es),this.e1=pe(this.es),this.e2=de(this.es),this.e3=ge(this.es),this.ml0=this.a*ce(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,i,n=t.x,r=t.y;if(n=Z(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(r),Math.cos(n))-this.lat0);else{var a=Math.sin(r),s=Math.cos(r),o=ye(this.a,this.e,a),h=Math.tan(r)*Math.tan(r),l=n*Math.cos(r),u=l*l,c=this.es*s*s/(1-this.es);e=o*l*(1-u*h*(1/6-(8-h+8*c)*u/120)),i=this.a*ce(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+o*a/s*u*(.5+(5-h+6*c)*u/24)}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n=t.x/this.a,r=t.y/this.a;if(this.sphere){var a=r+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(n)),i=Math.atan2(Math.tan(n),Math.cos(a))}else{var s=this.ml0/this.a+r,o=me(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-u)<=d)return t.x=this.long0,t.y=u,r<0&&(t.y*=-1),t;var h=ye(this.a,this.e,Math.sin(o)),l=h*h*h/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(o),2),f=n*this.a/h,p=f*f;e=o-h*Math.tan(o)/l*f*f*(.5-(1+3*c)*f*f/24),i=f*(1-p*(c/3+(1+3*c)*c*p/15))/Math.cos(o)}return t.x=Z(i+this.long0),t.y=ve(e),t},names:["Cassini","Cassini_Soldner","cass"]},we=function(t,e){var i;return t>1e-7?(1-t*t)*(e/(1-(i=t*e)*i)-.5/t*Math.log((1-i)/(1+i))):2*e};var be=.3333333333333333,xe=.17222222222222222,Me=.10257936507936508,Le=.06388888888888888,ke=.0664021164021164,Se=.016415012942191543;var Ce={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-u)<d?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<d?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=we(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,i=[];return i[0]=t*be,e=t*t,i[0]+=e*xe,i[1]=e*Le,e*=t,i[0]+=e*Me,i[1]+=e*ke,i[2]=e*Se,i}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=we(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,i,n,r,a,s,o,h,l,c,f=t.x,p=t.y;if(f=Z(f-this.long0),this.sphere){if(a=Math.sin(p),c=Math.cos(p),n=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+c*n:1+this.sinph0*a+this.cosph0*c*n)<=d)return null;e=(i=Math.sqrt(2/i))*c*Math.sin(f),i*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(p+this.lat0)<d)return null;i=v-.5*p,e=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(f),i*=n}}else{switch(o=0,h=0,l=0,n=Math.cos(f),r=Math.sin(f),a=Math.sin(p),s=we(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=s/this.qp,h=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:l=1+this.sinb1*o+this.cosb1*h*n;break;case this.EQUIT:l=1+h*n;break;case this.N_POLE:l=u+p,s=this.qp-s;break;case this.S_POLE:l=p-u,s=this.qp+s}if(Math.abs(l)<d)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),i=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*o-this.sinb1*h*n):(l=Math.sqrt(2/(1+h*n)))*o*this.ymf,e=this.xmf*l*h*r;break;case this.N_POLE:case this.S_POLE:s>=0?(e=(l=Math.sqrt(s))*r,i=n*(this.mode===this.S_POLE?l:-l)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,r,a,s,o,h,l,c,f=t.x/this.a,p=t.y/this.a;if(this.sphere){var g,y=0,v=0;if((i=.5*(g=Math.sqrt(f*f+p*p)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(v=Math.sin(i),y=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(g)<=d?0:Math.asin(p*v/g),f*=v,p=y*g;break;case this.OBLIQ:i=Math.abs(g)<=d?this.lat0:Math.asin(y*this.sinph0+p*v*this.cosph0/g),f*=v*this.cosph0,p=(y-Math.sin(i)*this.sinph0)*g;break;case this.N_POLE:p=-p,i=u-i;break;case this.S_POLE:i-=u}e=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(f,p):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(f/=this.dd,p*=this.dd,(s=Math.sqrt(f*f+p*p))<d)return t.x=this.long0,t.y=this.lat0,t;r=2*Math.asin(.5*s/this.rq),n=Math.cos(r),f*=r=Math.sin(r),this.mode===this.OBLIQ?(o=n*this.sinb1+p*r*this.cosb1/s,a=this.qp*o,p=s*this.cosb1*n-p*this.sinb1*r):(o=p*r/s,a=this.qp*o,p=s*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(a=f*f+p*p))return t.x=this.long0,t.y=this.lat0,t;o=1-a/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(f,p),h=Math.asin(o),l=this.apa,c=h+h,i=h+l[0]*Math.sin(c)+l[1]*Math.sin(c+c)+l[2]*Math.sin(c+c+c)}return t.x=Z(this.long0+e),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},Te=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)};var Pe={init:function(){Math.abs(this.lat1+this.lat2)<d||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=W(this.e3,this.sin_po,this.cos_po),this.qs1=we(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=W(this.e3,this.sin_po,this.cos_po),this.qs2=we(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=we(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>d?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=we(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*Z(e-this.long0),s=r*Math.sin(a)+this.x0,o=this.rh-r*Math.cos(a)+this.y0;return t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r,a,s;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),r=0,0!==e&&(r=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,s=this.phi1z(this.e3,i)),a=Z(r/this.ns0+this.long0),t.x=a,t.y=s,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var i,n,r,a,s,o=Te(.5*e);if(t<d)return o;for(var h=t*t,l=1;l<=25;l++)if(i=Math.sin(o),n=Math.cos(o),o+=s=.5*(a=1-(r=t*i)*r)*a/n*(e/(1-h)-i/a+.5/t*Math.log((1-r)/(1+r))),Math.abs(s)<=1e-7)return o;return null}};var Ee={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,i,n,r,a,s,o,h=t.x,l=t.y;return n=Z(h-this.long0),e=Math.sin(l),i=Math.cos(l),r=Math.cos(n),(a=this.sin_p14*e+this.cos_p14*i*r)>0||Math.abs(a)<=d?(s=this.x0+1*this.a*i*Math.sin(n)/a,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*r)/a):(s=this.x0+this.infinity_dist*i*Math.sin(n),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*r)),t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r,a,s;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(r=Math.atan2(e,this.rc),i=Math.sin(r),n=Math.cos(r),s=Te(n*this.sin_p14+t.y*i*this.cos_p14/e),a=Math.atan2(t.x*i,e*this.cos_p14*n-t.y*this.sin_p14*i),a=Z(this.long0+a)):(s=this.phic0,a=0),t.x=a,t.y=s,t},names:["gnom"]},Ae=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*u:u;for(var n,r,a,s,o=Math.asin(.5*e),h=0;h<30;h++)if(r=Math.sin(o),a=Math.cos(o),s=t*r,o+=n=Math.pow(1-s*s,2)/(2*a)*(e/(1-t*t)-r/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),Math.abs(n)<=1e-10)return o;return NaN};var Ie={init:function(){this.sphere||(this.k0=W(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,i,n=t.x,r=t.y,a=Z(n-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var s=we(this.e,Math.sin(r));e=this.x0+this.a*this.k0*a,i=this.y0+this.a*s*.5/this.k0}return t.x=e,t.y=i,t},inverse:function(t){var e,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=Z(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=Ae(this.e,2*t.y*this.k0/this.a),e=Z(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},names:["cea"]};var De={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,i=t.y,n=Z(e-this.long0),r=ve(i-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*r,t},inverse:function(t){var e=t.x,i=t.y;return t.x=Z(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=ve(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},Oe=20;var Fe={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=fe(this.es),this.e1=pe(this.es),this.e2=de(this.es),this.e3=ge(this.es),this.ml0=this.a*ce(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i,n,r=t.x,a=t.y,s=Z(r-this.long0);if(n=s*Math.sin(a),this.sphere)Math.abs(a)<=d?(e=this.a*s,i=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(a),i=this.a*(ve(a-this.lat0)+(1-Math.cos(n))/Math.tan(a)));else if(Math.abs(a)<=d)e=this.a*s,i=-1*this.ml0;else{var o=ye(this.a,this.e,Math.sin(a))/Math.tan(a);e=o*Math.sin(n),i=this.a*ce(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+o*(1-Math.cos(n))}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){var e,i,n,r,a,s,o,h,l;if(n=t.x-this.x0,r=t.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=d)e=Z(n/this.a+this.long0),i=0;else{var u;for(s=this.lat0+r/this.a,o=n*n/this.a/this.a+s*s,h=s,a=Oe;a;--a)if(h+=l=-1*(s*(h*(u=Math.tan(h))+1)-h-.5*(h*h+o)*u)/((h-s)/u-1),Math.abs(l)<=d){i=h;break}e=Z(this.long0+Math.asin(n*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(r+this.ml0)<=d)i=0,e=Z(this.long0+n/this.a);else{var c,f,p,g,y;for(s=(this.ml0+r)/this.a,o=n*n/this.a/this.a+s*s,h=s,a=Oe;a;--a)if(y=this.e*Math.sin(h),c=Math.sqrt(1-y*y)*Math.tan(h),f=this.a*ce(this.e0,this.e1,this.e2,this.e3,h),p=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),h-=l=(s*(c*(g=f/this.a)+1)-g-.5*c*(g*g+o))/(this.es*Math.sin(2*h)*(g*g+o-2*s*g)/(4*c)+(s-g)*(c*p-2/Math.sin(2*h))-p),Math.abs(l)<=d){i=h;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=Z(this.long0+Math.asin(n*c/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},names:["Polyconic","poly"]};var Re={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,i=t.x,n=t.y-this.lat0,r=i-this.long0,a=n/l*1e-5,s=r,o=1,h=0;for(e=1;e<=10;e++)o*=a,h+=this.A[e]*o;var u,c=h,f=s,p=1,d=0,g=0,y=0;for(e=1;e<=6;e++)u=d*c+p*f,p=p*c-d*f,d=u,g=g+this.B_re[e]*p-this.B_im[e]*d,y=y+this.B_im[e]*p+this.B_re[e]*d;return t.x=y*this.a+this.x0,t.y=g*this.a+this.y0,t},inverse:function(t){var e,i,n=t.x,r=t.y,a=n-this.x0,s=(r-this.y0)/this.a,o=a/this.a,h=1,u=0,c=0,f=0;for(e=1;e<=6;e++)i=u*s+h*o,h=h*s-u*o,u=i,c=c+this.C_re[e]*h-this.C_im[e]*u,f=f+this.C_im[e]*h+this.C_re[e]*u;for(var p=0;p<this.iterations;p++){var d,g=c,y=f,v=s,m=o;for(e=2;e<=6;e++)d=y*c+g*f,g=g*c-y*f,y=d,v+=(e-1)*(this.B_re[e]*g-this.B_im[e]*y),m+=(e-1)*(this.B_im[e]*g+this.B_re[e]*y);g=1,y=0;var _=this.B_re[1],w=this.B_im[1];for(e=2;e<=6;e++)d=y*c+g*f,g=g*c-y*f,y=d,_+=e*(this.B_re[e]*g-this.B_im[e]*y),w+=e*(this.B_im[e]*g+this.B_re[e]*y);var b=_*_+w*w;c=(v*_+m*w)/b,f=(m*_-v*w)/b}var x=c,M=f,L=1,k=0;for(e=1;e<=9;e++)L*=x,k+=this.D[e]*L;var S=this.lat0+k*l*1e5,C=this.long0+M;return t.x=C,t.y=S,t},names:["New_Zealand_Map_Grid","nzmg"]};var Ne={init:function(){},forward:function(t){var e=t.x,i=t.y,n=Z(e-this.long0),r=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=r,t.y=a,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=Z(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},names:["Miller_Cylindrical","mill"]},Be=20;var ze={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=qt(this.es)},forward:function(t){var e,i,n=t.x,r=t.y;if(n=Z(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(r),s=Be;s;--s){var o=(this.m*r+Math.sin(r)-a)/(this.m+Math.cos(r));if(r-=o,Math.abs(o)<d)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;e=this.a*this.C_x*n*(this.m+Math.cos(r)),i=this.a*this.C_y*r}else{var h=Math.sin(r),l=Math.cos(r);i=this.a*Vt(r,h,l,this.en),e=this.a*n*l/Math.sqrt(1-this.es*h*h)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n,r;return t.x-=this.x0,n=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,n/=this.C_x*(this.m+Math.cos(e)),this.m?e=Te((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Te(Math.sin(e)/this.n)),n=Z(n+this.long0),e=ve(e)):(e=Wt(t.y/this.a,this.es,this.en),(r=Math.abs(e))<u?(r=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)),n=Z(i)):r-d<u&&(n=this.long0)),t.x=n,t.y=e,t},names:["Sinusoidal","sinu"]};var Ue={init:function(){},forward:function(t){for(var e=t.x,i=t.y,n=Z(e-this.long0),r=i,a=Math.PI*Math.sin(i);;){var s=-(r+Math.sin(r)-a)/(1+Math.cos(r));if(r+=s,Math.abs(s)<d)break}r/=2,Math.PI/2-Math.abs(i)<d&&(n=0);var o=.900316316158*this.a*n*Math.cos(r)+this.x0,h=1.4142135623731*this.a*Math.sin(r)+this.y0;return t.x=o,t.y=h,t},inverse:function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=Z(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var r=Math.asin(i);return t.x=n,t.y=r,t},names:["Mollweide","moll"]};var Ge={init:function(){Math.abs(this.lat1+this.lat2)<d||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=fe(this.es),this.e1=pe(this.es),this.e2=de(this.es),this.e3=ge(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=W(this.e,this.sinphi,this.cosphi),this.ml1=ce(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<d?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=W(this.e,this.sinphi,this.cosphi),this.ml2=ce(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ce(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,i=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var r=ce(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-r)}var a=this.ns*Z(i-this.long0),s=this.x0+e*Math.sin(a),o=this.y0+this.rh-e*Math.cos(a);return t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var a=0;if(0!==i&&(a=Math.atan2(e*t.x,e*t.y)),this.sphere)return r=Z(this.long0+a/this.ns),n=ve(this.g-i/this.a),t.x=r,t.y=n,t;var s=this.g-i/this.a;return n=me(s,this.e0,this.e1,this.e2,this.e3),r=Z(this.long0+a/this.ns),t.x=r,t.y=n,t},names:["Equidistant_Conic","eqdc"]};var je={init:function(){this.R=this.a},forward:function(t){var e,i,n=t.x,r=t.y,a=Z(n-this.long0);Math.abs(r)<=d&&(e=this.x0+this.R*a,i=this.y0);var s=Te(2*Math.abs(r/Math.PI));(Math.abs(a)<=d||Math.abs(Math.abs(r)-u)<=d)&&(e=this.x0,i=r>=0?this.y0+Math.PI*this.R*Math.tan(.5*s):this.y0+Math.PI*this.R*-Math.tan(.5*s));var o=.5*Math.abs(Math.PI/a-a/Math.PI),h=o*o,l=Math.sin(s),c=Math.cos(s),f=c/(l+c-1),p=f*f,g=f*(2/l-1),y=g*g,v=Math.PI*this.R*(o*(f-y)+Math.sqrt(h*(f-y)*(f-y)-(y+h)*(p-y)))/(y+h);a<0&&(v=-v),e=this.x0+v;var m=h+f;return v=Math.PI*this.R*(g*m-o*Math.sqrt((y+h)*(h+1)-m*m))/(y+h),i=r>=0?this.y0+v:this.y0-v,t.x=e,t.y=i,t},inverse:function(t){var e,i,n,r,a,s,o,h,l,u,c,f;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,a=(n=t.x/c)*n+(r=t.y/c)*r,c=3*(r*r/(h=-2*(s=-Math.abs(r)*(1+a))+1+2*r*r+a*a)+(2*(o=s-2*r*r+n*n)*o*o/h/h/h-9*s*o/h/h)/27)/(l=(s-o*o/3/h)/h)/(u=2*Math.sqrt(-l/3)),Math.abs(c)>1&&(c=c>=0?1:-1),f=Math.acos(c)/3,i=t.y>=0?(-u*Math.cos(f+Math.PI/3)-o/3/h)*Math.PI:-(-u*Math.cos(f+Math.PI/3)-o/3/h)*Math.PI,e=Math.abs(n)<d?this.long0:Z(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-r*r)+a*a))/2/n),t.x=e,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var qe={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,i,n,r,a,s,o,h,l,c,f,p,g,y,v,m,_,w,b,x,M,L,k=t.x,S=t.y,C=Math.sin(t.y),T=Math.cos(t.y),P=Z(k-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=d?(t.x=this.x0+this.a*(u-S)*Math.sin(P),t.y=this.y0-this.a*(u-S)*Math.cos(P),t):Math.abs(this.sin_p12+1)<=d?(t.x=this.x0+this.a*(u+S)*Math.sin(P),t.y=this.y0+this.a*(u+S)*Math.cos(P),t):(w=this.sin_p12*C+this.cos_p12*T*Math.cos(P),_=(m=Math.acos(w))?m/Math.sin(m):1,t.x=this.x0+this.a*_*T*Math.sin(P),t.y=this.y0+this.a*_*(this.cos_p12*C-this.sin_p12*T*Math.cos(P)),t):(e=fe(this.es),i=pe(this.es),n=de(this.es),r=ge(this.es),Math.abs(this.sin_p12-1)<=d?(a=this.a*ce(e,i,n,r,u),s=this.a*ce(e,i,n,r,S),t.x=this.x0+(a-s)*Math.sin(P),t.y=this.y0-(a-s)*Math.cos(P),t):Math.abs(this.sin_p12+1)<=d?(a=this.a*ce(e,i,n,r,u),s=this.a*ce(e,i,n,r,S),t.x=this.x0+(a+s)*Math.sin(P),t.y=this.y0+(a+s)*Math.cos(P),t):(o=C/T,h=ye(this.a,this.e,this.sin_p12),l=ye(this.a,this.e,C),c=Math.atan((1-this.es)*o+this.es*h*this.sin_p12/(l*T)),b=0===(f=Math.atan2(Math.sin(P),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(P)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(f)-Math.PI)<=d?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(P)*Math.cos(c)/Math.sin(f)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),m=h*b*(1-(x=b*b)*(v=(g=this.e*this.cos_p12*Math.cos(f)/Math.sqrt(1-this.es))*g)*(1-v)/6+(M=x*b)/8*(y=p*g)*(1-2*v)+(L=M*b)/120*(v*(4-7*v)-3*p*p*(1-7*v))-L*b/48*y),t.x=this.x0+m*Math.sin(f),t.y=this.y0+m*Math.cos(f),t))},inverse:function(t){var e,i,n,r,a,s,o,h,l,c,f,p,g,y,v,m,_,w,b,x,M,L,k;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*u*this.a)return;return i=e/this.a,n=Math.sin(i),r=Math.cos(i),a=this.long0,Math.abs(e)<=d?s=this.lat0:(s=Te(r*this.sin_p12+t.y*n*this.cos_p12/e),o=Math.abs(this.lat0)-u,a=Math.abs(o)<=d?this.lat0>=0?Z(this.long0+Math.atan2(t.x,-t.y)):Z(this.long0-Math.atan2(-t.x,t.y)):Z(this.long0+Math.atan2(t.x*n,e*this.cos_p12*r-t.y*this.sin_p12*n))),t.x=a,t.y=s,t}return h=fe(this.es),l=pe(this.es),c=de(this.es),f=ge(this.es),Math.abs(this.sin_p12-1)<=d?(p=this.a*ce(h,l,c,f,u),e=Math.sqrt(t.x*t.x+t.y*t.y),s=me((p-e)/this.a,h,l,c,f),a=Z(this.long0+Math.atan2(t.x,-1*t.y)),t.x=a,t.y=s,t):Math.abs(this.sin_p12+1)<=d?(p=this.a*ce(h,l,c,f,u),e=Math.sqrt(t.x*t.x+t.y*t.y),s=me((e-p)/this.a,h,l,c,f),a=Z(this.long0+Math.atan2(t.x,t.y)),t.x=a,t.y=s,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),v=Math.atan2(t.x,t.y),g=ye(this.a,this.e,this.sin_p12),m=Math.cos(v),w=-(_=this.e*this.cos_p12*m)*_/(1-this.es),b=3*this.es*(1-w)*this.sin_p12*this.cos_p12*m/(1-this.es),L=1-w*(M=(x=e/g)-w*(1+w)*Math.pow(x,3)/6-b*(1+3*w)*Math.pow(x,4)/24)*M/2-x*M*M*M/6,y=Math.asin(this.sin_p12*Math.cos(M)+this.cos_p12*Math.sin(M)*m),a=Z(this.long0+Math.asin(Math.sin(v)*Math.sin(M)/Math.cos(y))),k=Math.sin(y),s=Math.atan2((k-this.es*L*this.sin_p12)*Math.tan(y),k*(1-this.es)),t.x=a,t.y=s,t)},names:["Azimuthal_Equidistant","aeqd"]};var Ve={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,i,n,r,a,s,o,h=t.x,l=t.y;return n=Z(h-this.long0),e=Math.sin(l),i=Math.cos(l),r=Math.cos(n),((a=this.sin_p14*e+this.cos_p14*i*r)>0||Math.abs(a)<=d)&&(s=1*this.a*i*Math.sin(n),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*r)),t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r,a,s,o;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),i=Te(e/this.a),n=Math.sin(i),r=Math.cos(i),s=this.long0,Math.abs(e)<=d?(o=this.lat0,t.x=s,t.y=o,t):(o=Te(r*this.sin_p14+t.y*n*this.cos_p14/e),a=Math.abs(this.lat0)-u,Math.abs(a)<=d?(s=this.lat0>=0?Z(this.long0+Math.atan2(t.x,-t.y)):Z(this.long0-Math.atan2(-t.x,t.y)),t.x=s,t.y=o,t):(s=Z(this.long0+Math.atan2(t.x*n,e*this.cos_p14*r-t.y*this.sin_p14*n)),t.x=s,t.y=o,t))},names:["ortho"]},We={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},He={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Ze(t,e,i,n){var r;return t<d?(n.value=He.AREA_0,r=0):(r=Math.atan2(e,i),Math.abs(r)<=v?n.value=He.AREA_0:r>v&&r<=u+v?(n.value=He.AREA_1,r-=u):r>u+v||r<=-(u+v)?(n.value=He.AREA_2,r=r>=0?r-_:r+_):(n.value=He.AREA_3,r+=u)),r}function Xe(t,e){var i=t+e;return i<-_?i+=m:i>+_&&(i-=m),i}var Ye={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=u-v/2?this.face=We.TOP:this.lat0<=-(u-v/2)?this.face=We.BOTTOM:Math.abs(this.long0)<=v?this.face=We.FRONT:Math.abs(this.long0)<=u+v?this.face=this.long0>0?We.RIGHT:We.LEFT:this.face=We.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,i,n,r,a,s,o={x:0,y:0},h={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,this.face===We.TOP)r=u-e,i>=v&&i<=u+v?(h.value=He.AREA_0,n=i-u):i>u+v||i<=-(u+v)?(h.value=He.AREA_1,n=i>0?i-_:i+_):i>-(u+v)&&i<=-v?(h.value=He.AREA_2,n=i+u):(h.value=He.AREA_3,n=i);else if(this.face===We.BOTTOM)r=u+e,i>=v&&i<=u+v?(h.value=He.AREA_0,n=-i+u):i<v&&i>=-v?(h.value=He.AREA_1,n=-i):i<-v&&i>=-(u+v)?(h.value=He.AREA_2,n=-i-u):(h.value=He.AREA_3,n=i>0?-i+_:-i-_);else{var l,c,f,p,d,g;this.face===We.RIGHT?i=Xe(i,+u):this.face===We.BACK?i=Xe(i,+_):this.face===We.LEFT&&(i=Xe(i,-u)),p=Math.sin(e),d=Math.cos(e),g=Math.sin(i),l=d*Math.cos(i),c=d*g,f=p,this.face===We.FRONT?n=Ze(r=Math.acos(l),f,c,h):this.face===We.RIGHT?n=Ze(r=Math.acos(c),f,-l,h):this.face===We.BACK?n=Ze(r=Math.acos(-l),f,-c,h):this.face===We.LEFT?n=Ze(r=Math.acos(-c),f,l,h):(r=n=0,h.value=He.AREA_0)}return s=Math.atan(12/_*(n+Math.acos(Math.sin(n)*Math.cos(v))-u)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),h.value===He.AREA_1?s+=u:h.value===He.AREA_2?s+=_:h.value===He.AREA_3&&(s+=1.5*_),o.x=a*Math.cos(s),o.y=a*Math.sin(s),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,t.x=o.x,t.y=o.y,t},inverse:function(t){var e,i,n,r,a,s,o,h,l,c,f,p,d={lam:0,phi:0},g={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?g.value=He.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(g.value=He.AREA_1,e-=u):t.x<0&&-t.x>=Math.abs(t.y)?(g.value=He.AREA_2,e=e<0?e+_:e-_):(g.value=He.AREA_3,e+=u),l=_/12*Math.tan(e),a=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),s=Math.atan(a),(o=1-(n=Math.cos(e))*n*(r=Math.tan(i))*r*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?o=-1:o>1&&(o=1),this.face===We.TOP)h=Math.acos(o),d.phi=u-h,g.value===He.AREA_0?d.lam=s+u:g.value===He.AREA_1?d.lam=s<0?s+_:s-_:g.value===He.AREA_2?d.lam=s-u:d.lam=s;else if(this.face===We.BOTTOM)h=Math.acos(o),d.phi=h-u,g.value===He.AREA_0?d.lam=-s+u:g.value===He.AREA_1?d.lam=-s:g.value===He.AREA_2?d.lam=-s-u:d.lam=s<0?-s-_:-s+_;else{var y,v,m;l=(y=o)*y,v=(l+=(m=l>=1?0:Math.sqrt(1-l)*Math.sin(s))*m)>=1?0:Math.sqrt(1-l),g.value===He.AREA_1?(l=v,v=-m,m=l):g.value===He.AREA_2?(v=-v,m=-m):g.value===He.AREA_3&&(l=v,v=m,m=-l),this.face===We.RIGHT?(l=y,y=-v,v=l):this.face===We.BACK?(y=-y,v=-v):this.face===We.LEFT&&(l=y,y=v,v=-l),d.phi=Math.acos(-m)-u,d.lam=Math.atan2(v,y),this.face===We.RIGHT?d.lam=Xe(d.lam,-u):this.face===We.BACK?d.lam=Xe(d.lam,-_):this.face===We.LEFT&&(d.lam=Xe(d.lam,+u))}return 0!==this.es&&(c=d.phi<0?1:0,f=Math.tan(d.phi),p=this.b/Math.sqrt(f*f+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-p*p)/(this.one_minus_f*p)),c&&(d.phi=-d.phi)),d.lam+=this.long0,t.x=d.lam,t.y=d.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Qe=[[1,2.2199e-17,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Je=[[-5.20417e-18,.0124,1.21431e-18,-8.45284e-11],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ke=.8487,$e=1.3523,ti=y/5,ei=1/ti,ii=18,ni=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},ri=function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])};var ai={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=Z(t.x-this.long0),i=Math.abs(t.y),n=Math.floor(i*ti);n<0?n=0:n>=ii&&(n=ii-1),i=y*(i-ei*n);var r={x:ni(Qe[n],i)*e,y:ni(Je[n],i)};return t.y<0&&(r.y=-r.y),r.x=r.x*this.a*Ke+this.x0,r.y=r.y*this.a*$e+this.y0,r},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*Ke),y:Math.abs(t.y-this.y0)/(this.a*$e)};if(e.y>=1)e.x/=Qe[ii][0],e.y=t.y<0?-u:u;else{var i=Math.floor(e.y*ii);for(i<0?i=0:i>=ii&&(i=ii-1);;)if(Je[i][0]>e.y)--i;else{if(!(Je[i+1][0]<=e.y))break;++i}var n=Je[i],r=5*(e.y-n[0])/(Je[i+1][0]-n[0]);r=function(t,e,i,n){for(var r=e;n;--n){var a=t(r);if(r-=a,Math.abs(a)<i)break}return r}(function(t){return(ni(n,t)-e.y)/ri(n,t)},r,d,100),e.x/=ni(Qe[i],r),e.y=(5*i+r)*g,t.y<0&&(e.y=-e.y)}return e.x=Z(e.x+this.long0),e},names:["Robinson","robin"]};var si={init:function(){this.name="geocent"},forward:function(t){return lt(t,this.es,this.a)},inverse:function(t){return ut(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},oi={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},hi={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};var li,ui={init:function(){if(Object.keys(hi).forEach(function(t){if(void 0===this[t])this[t]=hi[t].def;else{if(hi[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);hi[t].num&&(this[t]=parseFloat(this[t]))}hi[t].degrees&&(this[t]=this[t]*g)}.bind(this)),Math.abs(Math.abs(this.lat0)-u)<d?this.mode=this.lat0<0?oi.S_POLE:oi.N_POLE:Math.abs(this.lat0)<d?this.mode=oi.EQUIT:(this.mode=oi.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,i,n,r,a=Math.sin(t.y),s=Math.cos(t.y),o=Math.cos(t.x);switch(this.mode){case oi.OBLIQ:i=this.sinph0*a+this.cosph0*s*o;break;case oi.EQUIT:i=s*o;break;case oi.S_POLE:i=-a;break;case oi.N_POLE:i=a}switch(e=(i=this.pn1/(this.p-i))*s*Math.sin(t.x),this.mode){case oi.OBLIQ:i*=this.cosph0*a-this.sinph0*s*o;break;case oi.EQUIT:i*=a;break;case oi.N_POLE:i*=-s*o;break;case oi.S_POLE:i*=s*o}return r=1/((n=i*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-i*this.sg)*this.cw*r,i=n*r,t.x=e*this.a,t.y=i*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,i,n,r={x:t.x,y:t.y};n=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*n,i=this.pn1*t.y*this.cw*n,t.x=e*this.cg+i*this.sg,t.y=i*this.cg-e*this.sg;var a=Xt(t.x,t.y);if(Math.abs(a)<d)r.x=0,r.y=t.y;else{var s,o;switch(o=1-a*a*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/a+a/this.pn1),s=Math.sqrt(1-o*o),this.mode){case oi.OBLIQ:r.y=Math.asin(s*this.sinph0+t.y*o*this.cosph0/a),t.y=(s-this.sinph0*Math.sin(r.y))*a,t.x*=o*this.cosph0;break;case oi.EQUIT:r.y=Math.asin(t.y*o/a),t.y=s*a,t.x*=o;break;case oi.N_POLE:r.y=Math.asin(s),t.y=-t.y;break;case oi.S_POLE:r.y=-Math.asin(s)}r.x=Math.atan2(t.x,t.y)}return t.x=r.x+this.long0,t.y=r.y,t},names:["Tilted_Perspective","tpers"]};bt.defaultDatum="WGS84",bt.Proj=ht,bt.WGS84=new bt.Proj("WGS84"),bt.Point=Gt,bt.toPoint=dt,bt.defs=U,bt.transform=vt,bt.mgrs=Et,bt.version="__VERSION__",(li=bt).Proj.projections.add(Ht),li.Proj.projections.add($t),li.Proj.projections.add(ee),li.Proj.projections.add(ae),li.Proj.projections.add(se),li.Proj.projections.add(oe),li.Proj.projections.add(he),li.Proj.projections.add(le),li.Proj.projections.add(ue),li.Proj.projections.add(_e),li.Proj.projections.add(Ce),li.Proj.projections.add(Pe),li.Proj.projections.add(Ee),li.Proj.projections.add(Ie),li.Proj.projections.add(De),li.Proj.projections.add(Fe),li.Proj.projections.add(Re),li.Proj.projections.add(Ne),li.Proj.projections.add(ze),li.Proj.projections.add(Ue),li.Proj.projections.add(Ge),li.Proj.projections.add(je),li.Proj.projections.add(qe),li.Proj.projections.add(Ve),li.Proj.projections.add(Ye),li.Proj.projections.add(ai),li.Proj.projections.add(si),li.Proj.projections.add(ui);var ci=bt;window.proj4=ci,r.a.Proj={},r.a.Proj._isProj4Obj=function(t){return void 0!==t.inverse&&void 0!==t.forward},r.a.Proj.Projection=r.a.Class.extend({initialize:function(t,e,i){var n=r.a.Proj._isProj4Obj(t);this._proj=n?t:this._projFromCodeDef(t,e);var a=i;r.a.Util.isArray(i)&&(a=r.a.bounds(i)),this.bounds=n?e:a},project:function(t){var e=this._proj.forward([t.lng,t.lat]);return new r.a.Point(e[0],e[1])},unproject:function(t,e){this.bounds&&(t.x=t.x<this.bounds.min.x?this.bounds.min.x:t.x>this.bounds.max.x?this.bounds.max.x:t.x,t.y=t.y<this.bounds.min.y?this.bounds.min.y:t.y>this.bounds.max.y?this.bounds.max.y:t.y);var i=this._proj.inverse([t.x,t.y]);return new r.a.LatLng(i[1],i[0],e)},_projFromCodeDef:function(t,e){if(e)ci.defs(t,e);else if(void 0===ci.defs[t]){var i=t.split(":");if(i.length>3&&(t=i[i.length-3]+":"+i[i.length-1]),void 0===ci.defs[t])throw"No projection definition for code "+t}return ci(t)},getUnits:function(){return this._proj.oProj.units||"degrees"}});var fi=r.a.Class.extend({includes:r.a.CRS,options:{transformation:new r.a.Transformation(1,0,-1,0)},initialize:function(t,e){var i,n,a;if(r.a.Proj._isProj4Obj(t)?(i=(n=t).srsCode,e=e||{},this.projection=new r.a.Proj.Projection(n,e.bounds)):(i=t,a=(e=e||{}).def||"",this.projection=new r.a.Proj.Projection(i,a,e.bounds)),r.a.Util.setOptions(this,e),this.code=i,this.transformation=this.options.transformation,this.options.dpi=this.options.dpi||96,this.options.bounds&&(this.options.bounds=r.a.bounds(this.options.bounds)),!this.options.origin&&this.options.bounds&&(this.options.origin=[this.options.bounds.min.x,this.options.bounds.max.y]),this.options.origin&&(this.options.origin instanceof r.a.Point&&(this.options.origin=[this.options.origin.x,this.options.origin.y]),this.transformation=new r.a.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales&&this.options.scales.length>0)this.scales=this.options.scales,this._scales=this._toProj4Scales(this.options.scales,this.options.dpi);else if(this.options.scaleDenominators&&this.options.scaleDenominators.length>0){this.scales=[];for(var s=0;s<this.options.scaleDenominators.length;s++)this.scales[s]=1/this.options.scaleDenominators[s];this._scales=this._toProj4Scales(this.scales,this.options.dpi)}else if(this.options.resolutions&&this.options.resolutions.length>0){this._scales=[];for(var o=this.options.resolutions.length-1;o>=0;o--)this.options.resolutions[o]&&(this._scales[o]=1/this.options.resolutions[o])}else this.options.bounds&&(this._scales=this._getDefaultProj4ScalesByBounds(this.options.bounds));this._rectify(),this.infinite=!this.options.bounds},_rectify:function(){if(this._scales&&(this.resolutions||(this.resolutions=[],this.resolutions=this._proj4ScalesToResolutions(this._scales)),!this.scales)){this.scales=[];for(var t=0;t<this.resolutions.length;t++){var e=this.resolutions[t]*this.options.dpi*(1/.0254)*this._getMeterPerMapUnit(this.projection.getUnits());this.scales[t]=1/e}}},scale:function(t){var e,i=Math.floor(t);return t===i?this._scales[t]:(e=this._scales[i])+(this._scales[i+1]-e)*(t-i)},zoom:function(t){var e,i,n=this._closestElement(this._scales,t),r=this._scales.indexOf(n);return n?t===n?r:(i=r+1,void 0===(e=this._scales[i])?r:(t-n)/(e-n)+r):0},distance:r.a.CRS.Earth.distance,R:r.a.CRS.Earth.R,_closestElement:function(t,e){for(var i,n=t.length;n--;)t[n]<=e&&(void 0===i||i<t[n])&&(i=t[n]);return i},_proj4ScalesToResolutions:function(t){var e=[];if(!t)return e;for(var i=0;i<t.length;i++)e[i]=1/t[i];return e},_toProj4Scales:function(t,e){var i=[];if(!t)return i;for(var n=0;n<t.length;n++){var r=this.projection?this._getMeterPerMapUnit(this.projection.getUnits()):1;i[n]=1/(.0254/((e||96)*t[n])/r)}return i},_getMeterPerMapUnit:function(t){var e=1;return"meter"===t?e=1:"degrees"===t?e=2*Math.PI*6378137/360:"kilometer"===t?e=.001:"inch"===t?e=1/.025399999918:"feet"===t&&(e=.3048),e},_getDefaultProj4ScalesByBounds:function(t){if(!t)return[];for(var e=t.getSize(),i=Math.max(e.x,e.y)/256,n=[],r=0;r<23;r++)n[r]=Math.pow(2,r)/i;return n}}),pi=function(t,e){return new fi(t,e)};r.a.Proj.CRS=pi},function(t,e,i){"use strict";i.d(e,"a",function(){return a}),i.d(e,"c",function(){return o.a}),i.d(e,"b",function(){return h});var n=i(0),r=i.n(n),a=(i(1),r.a.Class.extend({options:{map:null,featureGroup:null,classifyList:null},initialize:function(t){this.options=r.a.setOptions(this,t),this.options.classifyList={},this.options.featureGroup=t.featureGroup||r.a.featureGroup(),this.options.map.addLayer(this.options.featureGroup),this._initEvents()},_initEvents:function(){var t=this.options.map;this.options.featureGroup.on("click",function(t){this.resetFeatureIcon(),t.layer.onFeatureClick&&t.layer.onFeatureClick(t.layer),t.layer.options&&t.layer.options.hightIcon&&t.layer.setIcon(t.layer.options.hightIcon)},this),this.options.featureGroup.on("mouseover",function(t){t.layer.options&&t.layer.options.hightIcon&&t.layer.setIcon(t.layer.options.hightIcon),t.layer.onFeatureOver&&t.layer.onFeatureOver(t.layer)}),this.options.featureGroup.on("mouseout",function(e){var i=e.layer.getPopup(),n=t._popup;i&&n&&i==n||e.layer.options&&e.layer.options.unhightIcon&&e.layer.setIcon(e.layer.options.unhightIcon),e.layer.onFeatureOut&&e.layer.onFeatureOut(e.layer)}),this.options.featureGroup.on("popupclose",function(t){t.layer.options&&t.layer.options.unhightIcon&&t.layer.setIcon(t.layer.options.unhightIcon)},this)},createFeatureSort:function(t,e){var i={features:[],onFeatureClick:(e=e||{}).onFeatureClick,onFeatureOver:e.onFeatureOver,onFeatureOut:e.onFeatureOut};this.options.classifyList[t]=i},addFeatures:function(t,e,i){if(e&&"string"==typeof e){t instanceof Array||(t=[t]);var n=this.options.classifyList;n[e]&&(t=this._processFeatures(t,e),n[e].features=i?n[e].features.concat(t):t)}},_processFeatures:function(t,e){for(var i=this.options.classifyList[e],n=0;n<t.length;n++){var r=t[n];r.sort=e,r.onFeatureClick=i.onFeatureClick,r.onFeatureOver=i.onFeatureOver,r.onFeatureOut=i.onFeatureOut}return t},drawFeaturesToMap:function(t){var e;if("string"==typeof t){var i=t||"default";this.options.classifyList[i]&&(e=this.getFeatures(i))}if(t instanceof Array&&(e=t),!e)return!1;for(var n=0;n<e.length;n++)e[n].options&&e[n].options.unhightIcon&&e[n].setIcon(e[n].options.unhightIcon),this.options.featureGroup.addLayer(e[n])},clearFeaturesFromMap:function(t){if(t&&"string"==typeof t){var e,i=this.options.classifyList[t];if(e="allType"==t?this.options.featureGroup.getLayers():i?i.features:[]){for(var n=0;n<e.length;n++)this.options.featureGroup.removeLayer(e[n]);this.options.classifyList[t].features=[]}}},getFeatures:function(t){return t&&"string"==typeof t&&this.options.classifyList[t]?this.options.classifyList[t].features:null},resetFeatureIcon:function(){this.options.featureGroup.eachLayer(function(t){t.options&&t.options.unhightIcon&&t.setIcon(t.options.unhightIcon)})}})),s=function(t){return new a(t)};r.a.geoway.featureManager=s,r.a.geoway.FeatureManager=a,r.a.FeatureManager=a,r.a.featureManager=s;var o=i(15),h=r.a.Class.extend({options:{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e3},initialize:function(t){r.a.setOptions(this,t)},getCurrentPosition:function(t,e){if(r.a.setOptions(this,e),navigator.geolocation){navigator.geolocation.getCurrentPosition(function(e){var i=e.coords,n=new r.a.LatLng(i.latitude,i.longitude);t({latlng:n,status:"ok"})},function(e){var i="";switch(e.code){case e.PERMISSION_DENIED:i="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:i="Location information is unavailable.";break;case e.TIMEOUT:i="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:i="An unknown error occurred."}t({latlng:null,status:"error",errorMsg:i})},this.options)}else{t({latlng:null,status:"error",errorMsg:"Your browser does not support Geolocation!"})}}});r.a.geoway.geolocation=function(t){return new h(t)},r.a.geoway.Geolocation=h,r.a.Geolocation=h;var l=i(3),u=i(13),c={getCapabilities:function(t,e,i){l.a.get(t,{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"}).then(function(t){try{var n=t.bodyText,r=(new u.d).read(n);e&&e(r)}catch(t){i&&i(t)}}).catch(function(t){i(t)})}};r.a.geoway.WMTSUtil=c,r.a.WMTSUtil=c},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var n=i(0),r=i.n(n),a=(i(1),i(5)),s=a.a.extend({initialize:function(t){a.a.prototype.initialize.apply(this,[t])},read:function(t){var e=null;if("string"==typeof t&&(t=a.a.prototype.read.apply(this,[t])),t&&9==t.nodeType){e={};for(var i=t.getElementsByTagName("result")[0].childNodes,n=0;n<i.length;n++){var r=i[n],s=r.nodeName;this._resultPaser[s]&&this._resultPaser[s](r,e)}}return e},_resultPaser:{parameters:function(t,e){var i=t.childNodes;e.parameters={};for(var n=0;n<i.length;n++){var r=i[n];"#text"!=r.nodeName&&(e.parameters[r.nodeName]=r.text||r.textContent)}},routes:function(t,e){var i=t.attributes,n=t.childNodes;e.routes={};for(var r=0;r<i.length;r++){var a=i[r];"#text"!=a.nodeName&&(e.routes[a.nodeName]=a.text||a.textContent)}for(var s=0;s<n.length;s++){e.routes.items||(e.routes.items=[]);var o=n[s];if("#text"!=o.nodeName){var h={};l(o,h),e.routes.items.push(h)}}function l(t,e){for(var i=t.childNodes,n=0;n<i.length;n++)"#text"!=i[n].nodeName&&(e[i[n].nodeName]=i[n].text||i[n].textContent)}},simple:function(t,e){e.simple={};for(var i=t.childNodes,n=0;n<i.length;n++){e.simple.items||(e.simple.items=[]);var r=i[n];if("#text"!=r.nodeName){var a={};s(r,a),e.simple.items.push(a)}}function s(t,e){for(var i=t.childNodes,n=0;n<i.length;n++)"#text"!=i[n].nodeName&&(e[i[n].nodeName]=i[n].text||i[n].textContent)}},distance:function(t,e){e.distance=t.text||t.textContent},duration:function(t,e){e.duration=t.text||t.textContent},routelatlon:function(t,e){e.routelatlon=t.text||t.textContent},mapinfo:function(t,e){e.mapinfo={};for(var i=t.childNodes,n=0;n<i.length;n++)"#text"!=i[n].nodeName&&(e.mapinfo[i[n].nodeName]=i[n].text||i[n].textContent)}}});r.a.geoway.format.TRouteResultFormat=s,r.a.Format=r.a.Format?r.a.Format:{},r.a.Format.TRouteResultFormat=s},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i(0),r=i.n(n),a=(i(1),i(10),r.a.Class.extend({data:null,orig:null,dest:null,startFeature:null,endFeature:null,routes:null,segmentFeatures:null,distance:null,duration:null,routelatlon:null,initialize:function(t){if(t)for(var e in this.data=t,t){if(this._resultPaser[e])r.a.Util.bind(this._resultPaser[e],this)(t[e])}},lineStringToGeometry:function(t){for(var e=[],i=t.split(";"),n=0;n<i.length;n++)if(""!=i[n]){var a=i[n].split(","),s=new r.a.LatLng(a[1],a[0]);e.push(s)}return new r.a.Polyline(e)},_resultPaser:{parameters:function(t){var e=t.orig.split(","),i=t.dest.split(",");this.start=new r.a.LatLng(e[1],e[0]),this.end=new r.a.LatLng(i[1],i[0]);var n=new r.a.LatLng(this.start.lat,this.start.lng);this.startFeature=new r.a.Marker(n);var a=new r.a.LatLng(this.end.lat,this.end.lng);this.endFeature=new r.a.Marker(a)},routes:function(t){this.routes=t},simple:function(t){if(this.simple=t,t.items){for(var e=t.items,i=[],n=0;n<e.length;n++){var a=this.lineStringToGeometry(e[n].streetLatLon);r.a.setOptions(a,e[n]),i.push(a)}this.simple.segmentFeatures=i}},distance:function(t){this.distance=t},duration:function(t){this.duration=t},routelatlon:function(t){this.routelatlon=t},mapinfo:function(t){this.mapinfo=t}}}));r.a.geoway.format.TRouteResult=a,r.a.Format=r.a.Format?r.a.Format:{},r.a.Format.TRouteResult=a},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(e,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var a=e/i,s=n/i;this.maxPerCell=null==r?1:r,this.cells={},this.d=a+2*s,this.n=a,this.padding=s,this.scale=a/e;var o=s/a*e;this.min=-o,this.max=e+o}var e,i,r;return e=t,(i=[{key:"filter",value:function(t,e){if(t<this.min||t>this.max||e<this.min||e>this.max)return!1;var i=this.convertToCellCoord(t),n=this.convertToCellCoord(e),r=this.d*n+i;if(this.cells[r]>=this.maxPerCell)return!1;var a=this.cells[r];return this.cells[r]=null==a?1:a++,!0}},{key:"filterByBox",value:function(t){for(var e=this.convertToCellCoord(t[0]),i=this.convertToCellCoord(t[2]),n=this.convertToCellCoord(t[1]),r=this.convertToCellCoord(t[3]),a=e;a<=i;a++)for(var s=n;s<=r;s++){var o=this.d*s+a;if(this.cells[o])return!1}for(var h=e;h<=i;h++)for(var l=n;l<=r;l++){var u=this.d*l+h;this.cells[u]=1}return!0}},{key:"clean",value:function(){this.cells={},this.saveCount=0}},{key:"convertToCellCoord",value:function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}}])&&n(e.prototype,i),r&&n(e,r),t}(),a=i(7),s=i(8);function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,n=[{key:"fristFilter",value:function(e,i,n,r,s,o,h,l,u){return r&&s&&(a.a.sort(e),a.a.sort(i)),{pointFeatures:e=t.fristFilterStart(e,o,h,l,u),lineFeatures:i=t.fristFilterStart(i,o,h,l,u)}}},{key:"scendFilter",value:function(e,i,n,r,s,o,h,l,u){r&&s&&(a.a.sort(e),a.a.sort(i)),e=t.scendFilterStart(e,o,16,l),i=t.scendFilterStart(i,o,16,l);var c=[];return c=(c=c.concat(e)).concat(i)}},{key:"removeTileOutPointFeatures",value:function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[n],a=r.centerPoint;a[0]>=0&&a[0]<=e&&a[1]>=0&&a[1]<=e&&i.push(r)}return i}},{key:"removeTileOutLineFeatures",value:function(t,e){for(var i=[],n=0;n<t.length;n++)for(var r=t[n],a=0;a<r.datas.length;a++){var s=r.datas[a][0];if(s[0]>=0&&s[0]<=e&&s[1]>=0&&s[1]<=e){i.push(r);break}}return i}},{key:"fristFilterStart",value:function(t,e,i,n,a){for(var s=new r(e,i,n,a),o=[],h=0;h<t.length;h++){var l=t[h];s.filter(l.centerPoint[0],l.centerPoint[1])&&o.push(l)}return o}},{key:"scendFilterStart",value:function(t,e,i,n){for(var a=new r(e,i,n,1),s=[],o=0;o<t.length;o++){var h=t[o];a.filterByBox(h.filterBox)&&s.push(h)}return s}},{key:"threeFilter",value:function(e,i,n){var r=t.getImportantOtherFeatures(e,i),o=a.a.groupByLabel(r.otherFeatures),h=[],l=[0,0,n,n];for(var u in o){var c=o[u];if(1==c.length)h.push(c[0]);else{for(var f=[],p=0;p<c.length;p++){var d=c[p];if(1==d.type&&(s.a.isInBox(d.box,l)?f.push(d):h.push(d)),2==d.type){for(var g=!0,y=0;y<d.boxs.length;y++){var v=d.boxs[y];if(!s.a.isInBox(v,l)){g=!1;break}}g?f.push(d):h.push(d)}}f.length>0&&(f=a.a.sortPrimaryId(f),h=h.concat(t.distinctFeatures(f,i)))}}return h=h.concat(r.importantFeatures)}},{key:"distinctFeatures",value:function(e,i){var n=e[0],r="";1==n.type&&(r="distance"),2==n.type&&("text"==n.lineType&&(r="lineTextDistance"),"code"==n.lineType&&(r="lineCodeDistance"));var a=[];a.push(e[0]);for(var s=0;s<e.length-1;s++){var o=e[s];if(1!=o.hidden){var h=e[s+1],l=t.getDistance(o.centerPoint,h.centerPoint),u=i[o.styleId];l<(u[r]?u[r]:0)?h.hidden=!0:a.push(h)}}return a}},{key:"getDistance",value:function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.pow(i*i+n*n,.5)}},{key:"getImportantOtherFeatures",value:function(t,e){for(var i=[],n=[],r=0;r<t.length;r++){var a=t[r];e[a.styleId].isImportant?i.push(a):n.push(a)}return{otherFeatures:n,importantFeatures:i}}}],(i=null)&&o(e.prototype,i),n&&o(e,n),t}();e.a=h},function(t,e,i){"use strict";var n=i(20);i.d(e,"a",function(){return n.a}),i.d(e,"b",function(){return n.b})},function(t,e,i){"use strict";(function(t){var n=i(44),r=i(45),a=i(46);function s(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=h.prototype:(null===t&&(t=new h(e)),t.length=e),t}function h(t,e,i){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return l(this,t,e,i)}function l(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n);h.TYPED_ARRAY_SUPPORT?(t=e).__proto__=h.prototype:t=f(t,e);return t}(t,e,i,n):"string"==typeof e?function(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!h.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(e,i),r=(t=o(t,n)).write(e,i);r!==n&&(t=t.slice(0,r));return t}(t,e,i):function(t,e){if(h.isBuffer(e)){var i=0|p(e.length);return 0===(t=o(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?o(t,0):f(t,e);if("Buffer"===e.type&&a(e.data))return f(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t,e){if(u(e),t=o(t,e<0?0:0|p(e)),!h.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function f(t,e){var i=e.length<0?0:0|p(e.length);t=o(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function p(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function d(t,e){if(h.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return U(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return G(t).length;default:if(n)return U(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function y(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=h.from(e,n)),h.isBuffer(e))return 0===e.length?-1:v(t,e,i,n,r);if("number"==typeof e)return e&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):v(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function v(t,e,i,n,r){var a,s=1,o=t.length,h=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,o/=2,h/=2,i/=2}function l(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){var u=-1;for(a=i;a<o;a++)if(l(t,a)===l(e,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===h)return u*s}else-1!==u&&(a-=a-u),u=-1}else for(i+h>o&&(i=o-h),a=i;a>=0;a--){for(var c=!0,f=0;f<h;f++)if(l(t,a+f)!==l(e,f)){c=!1;break}if(c)return a}return-1}function m(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(e.substr(2*s,2),16);if(isNaN(o))return s;t[i+s]=o}return s}function _(t,e,i,n){return j(U(e,t.length-i),t,i,n)}function w(t,e,i,n){return j(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function b(t,e,i,n){return w(t,e,i,n)}function x(t,e,i,n){return j(G(e),t,i,n)}function M(t,e,i,n){return j(function(t,e){for(var i,n,r,a=[],s=0;s<t.length&&!((e-=2)<0);++s)i=t.charCodeAt(s),n=i>>8,r=i%256,a.push(r),a.push(n);return a}(e,t.length-i),t,i,n)}function L(t,e,i){return 0===e&&i===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,i))}function k(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var a,s,o,h,l=t[r],u=null,c=l>239?4:l>223?3:l>191?2:1;if(r+c<=i)switch(c){case 1:l<128&&(u=l);break;case 2:128==(192&(a=t[r+1]))&&(h=(31&l)<<6|63&a)>127&&(u=h);break;case 3:a=t[r+1],s=t[r+2],128==(192&a)&&128==(192&s)&&(h=(15&l)<<12|(63&a)<<6|63&s)>2047&&(h<55296||h>57343)&&(u=h);break;case 4:a=t[r+1],s=t[r+2],o=t[r+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(h=(15&l)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&h<1114112&&(u=h)}null===u?(u=65533,c=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),r+=c}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var i="",n=0;for(;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=S));return i}(n)}e.Buffer=h,e.SlowBuffer=function(t){+t!=t&&(t=0);return h.alloc(+t)},e.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),h.poolSize=8192,h._augment=function(t){return t.__proto__=h.prototype,t},h.from=function(t,e,i){return l(null,t,e,i)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(t,e,i){return function(t,e,i,n){return u(e),e<=0?o(t,e):void 0!==i?"string"==typeof n?o(t,e).fill(i,n):o(t,e).fill(i):o(t,e)}(null,t,e,i)},h.allocUnsafe=function(t){return c(null,t)},h.allocUnsafeSlow=function(t){return c(null,t)},h.isBuffer=function(t){return!(null==t||!t._isBuffer)},h.compare=function(t,e){if(!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,a=Math.min(i,n);r<a;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=h.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var s=t[i];if(!h.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,r),r+=s.length}return n},h.byteLength=d,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},h.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},h.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},h.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?k(this,0,t):function(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,i);case"utf8":case"utf-8":return k(this,e,i);case"ascii":return C(this,e,i);case"latin1":case"binary":return T(this,e,i);case"base64":return L(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},h.prototype.compare=function(t,e,i,n,r){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,n>>>=0,r>>>=0,this===t)return 0;for(var a=r-n,s=i-e,o=Math.min(a,s),l=this.slice(n,r),u=t.slice(e,i),c=0;c<o;++c)if(l[c]!==u[c]){a=l[c],s=u[c];break}return a<s?-1:s<a?1:0},h.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},h.prototype.indexOf=function(t,e,i){return y(this,t,e,i,!0)},h.prototype.lastIndexOf=function(t,e,i){return y(this,t,e,i,!1)},h.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return m(this,t,e,i);case"utf8":case"utf-8":return _(this,t,e,i);case"ascii":return w(this,t,e,i);case"latin1":case"binary":return b(this,t,e,i);case"base64":return x(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,e,i);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function C(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function T(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function P(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",a=e;a<i;++a)r+=z(t[a]);return r}function E(t,e,i){for(var n=t.slice(e,i),r="",a=0;a<n.length;a+=2)r+=String.fromCharCode(n[a]+256*n[a+1]);return r}function A(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,i,n,r,a){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function D(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,a=Math.min(t.length-i,2);r<a;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function O(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,a=Math.min(t.length-i,4);r<a;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function F(t,e,i,n,r,a){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function R(t,e,i,n,a){return a||F(t,0,i,4),r.write(t,e,i,n,23,4),i+4}function N(t,e,i,n,a){return a||F(t,0,i,8),r.write(t,e,i,n,52,8),i+8}h.prototype.slice=function(t,e){var i,n=this.length;if(t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),h.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=h.prototype;else{var r=e-t;i=new h(r,void 0);for(var a=0;a<r;++a)i[a]=this[a+t]}return i},h.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||A(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return n},h.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||A(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},h.prototype.readUInt8=function(t,e){return e||A(t,1,this.length),this[t]},h.prototype.readUInt16LE=function(t,e){return e||A(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUInt16BE=function(t,e){return e||A(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUInt32LE=function(t,e){return e||A(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUInt32BE=function(t,e){return e||A(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||A(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},h.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||A(t,e,this.length);for(var n=e,r=1,a=this[t+--n];n>0&&(r*=256);)a+=this[t+--n]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*e)),a},h.prototype.readInt8=function(t,e){return e||A(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){e||A(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt16BE=function(t,e){e||A(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt32LE=function(t,e){return e||A(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return e||A(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readFloatLE=function(t,e){return e||A(t,4,this.length),r.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return e||A(t,4,this.length),r.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return e||A(t,8,this.length),r.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return e||A(t,8,this.length),r.read(this,t,!1,52,8)},h.prototype.writeUIntLE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||I(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,a=0;for(this[e]=255&t;++a<i&&(r*=256);)this[e+a]=t/r&255;return e+i},h.prototype.writeUIntBE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||I(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,a=1;for(this[e+r]=255&t;--r>=0&&(a*=256);)this[e+r]=t/a&255;return e+i},h.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,1,255,0),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},h.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},h.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},h.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):O(this,t,e,!0),e+4},h.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},h.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);I(this,t,e,i,r-1,-r)}var a=0,s=1,o=0;for(this[e]=255&t;++a<i&&(s*=256);)t<0&&0===o&&0!==this[e+a-1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+i},h.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);I(this,t,e,i,r-1,-r)}var a=i-1,s=1,o=0;for(this[e+a]=255&t;--a>=0&&(s*=256);)t<0&&0===o&&0!==this[e+a+1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+i},h.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,1,127,-128),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},h.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},h.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):O(this,t,e,!0),e+4},h.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},h.prototype.writeFloatLE=function(t,e,i){return R(this,t,e,!0,i)},h.prototype.writeFloatBE=function(t,e,i){return R(this,t,e,!1,i)},h.prototype.writeDoubleLE=function(t,e,i){return N(this,t,e,!0,i)},h.prototype.writeDoubleBE=function(t,e,i){return N(this,t,e,!1,i)},h.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,a=n-i;if(this===t&&i<e&&e<n)for(r=a-1;r>=0;--r)t[r+e]=this[r+i];else if(a<1e3||!h.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+a),e);return a},h.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var a;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(a=e;a<i;++a)this[a]=t;else{var s=h.isBuffer(t)?t:U(new h(t,n).toString()),o=s.length;for(a=0;a<i-e;++a)this[a+e]=s[a%o]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function z(t){return t<16?"0"+t.toString(16):t.toString(16)}function U(t,e){var i;e=e||1/0;for(var n=t.length,r=null,a=[],s=0;s<n;++s){if((i=t.charCodeAt(s))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&a.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&a.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&a.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;a.push(i)}else if(i<2048){if((e-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function G(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(B,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function j(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}}).call(this,i(18))},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var n=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.layerDataMap=e,this.level=n,this.styleMap=i,this.propertyGetterMap={}}var e,n,r;return e=t,(n=[{key:"getLayer",value:function(t){this.layerDatas={};var e=this.layerDataMap[t];return null==e||null==e.features?this:(this.propertyGetterMap[t]=this.getProperty(e.fieldsConfig),this.layerDatas[t]=e,this)}},{key:"getAllLayer",value:function(){for(var t in this.layerDatas=this.layerDataMap,this.layerDataMap)this.propertyGetterMap[t]=this.getProperty(this.layerDataMap[t].fieldsConfig);return this}},{key:"getGroupLayer",value:function(t,e){if(this.layerDatas={},0==e.split(",").length)return this;var i=this.layerDataMap[t];return null==i||null==i.features?this:(this.propertyGetterMap[t]=this.getProperty(i.fieldsConfig),this.layerDatas[t]=i,this)}},{key:"getProperty",value:function(t){for(var e={},i=0,n=0;n<t.length;n++)"true"!=t[n].id&&1!=t[n].id||(i=t[n].index),e[t[n].name]=parseInt(t[n].index);return{propertyConfig:e,idIndex:i}}},{key:"setStyle",value:function(t){var e=this,i=function(i){for(var n=e.layerDatas[i],r=e.propertyGetterMap[i],a=function(i){var a=n.features[i],s=t.call({},e.level,function(t){return a[1][r.propertyConfig[t]]});s&&1==s.show&&(e.styleMap[s._id]||(e.styleMap[s._id]=s),a.avoidWeight=e.getWeight(s,a,r,"avoidWeight","avoidField"),"POINT"!=a[0]&&(s.hasOwnProperty("codeAvoidWeight")&&s.hasOwnProperty("codeAvoidField")?(a.codeAvoidWeight=e.getWeight(s,a,r,"codeAvoidWeight","codeAvoidField"),a.codeAvoidWeight=a.codeAvoidWeight==a.avoidWeight?a.avoidWeight+1:a.codeAvoidWeight):a.codeAvoidWeight=a.avoidWeight+1,s.hasOwnProperty("arrowAvoidWeight")&&s.hasOwnProperty("arrowAvoidField")?(a.arrowAvoidWeight=e.getWeight(s,a,r,"arrowAvoidWeight","arrowAvoidField"),a.arrowAvoidWeight=a.arrowAvoidWeight==a.avoidWeight?a.avoidWeight-1:a.arrowAvoidWeight,a.arrowAvoidWeight=a.arrowAvoidWeight==a.codeAvoidWeight?a.codeAvoidWeight-1:a.arrowAvoidWeight):a.arrowAvoidWeight=a.avoidWeight-1),a.styleId=s._id)},s=0;s<n.features.length;s++)a(s)};for(var n in this.layerDatas)i(n)}},{key:"setGlobalStyle",value:function(t){this.globalStyle=t.call({})}},{key:"getWeight",value:function(t,e,i,n,r){var a=e[1][i.propertyConfig[t[r]]];return a?(a=parseInt(a),isNaN(a)&&(a=0)):a=0,0==a&&t[n]?t[n]:a}},{key:"draw",value:function(){}}])&&i(e.prototype,n),r&&i(e,r),t}();t.exports=n},function(t,e,i){"use strict";(function(t,n){function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(){return"object"===(void 0===t?"undefined":r(t))&&"object"===r(t.versions)&&void 0!==t.versions.node}function s(t){return t instanceof Uint8Array&&(!a()||!n.isBuffer(t))}function o(t){return t instanceof ArrayBuffer}function h(t){return!!a()&&n.isBuffer(t)}var l=i(47).SnappyDecompressor,u=i(48).SnappyCompressor,c="Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array";e.uncompress=function(t){if(!s(t)&&!o(t)&&!h(t))throw new TypeError(c);var e=!1,i=!1;s(t)?e=!0:o(t)&&(i=!0,t=new Uint8Array(t));var r,a,u=new l(t),f=u.readUncompressedLength();if(-1===f)throw new Error("Invalid Snappy bitstream");if(e){if(r=new Uint8Array(f),!u.uncompressToBuffer(r))throw new Error("Invalid Snappy bitstream")}else if(i){if(r=new ArrayBuffer(f),a=new Uint8Array(r),!u.uncompressToBuffer(a))throw new Error("Invalid Snappy bitstream")}else if(r=n.alloc(f),!u.uncompressToBuffer(r))throw new Error("Invalid Snappy bitstream");return r},e.compress=function(t){if(!s(t)&&!o(t)&&!h(t))throw new TypeError(c);var e=!1,i=!1;s(t)?e=!0:o(t)&&(i=!0,t=new Uint8Array(t));var r,a,l,f=new u(t),p=f.maxCompressedLength();return e?(r=new Uint8Array(p),l=f.compressToBuffer(r)):i?(r=new ArrayBuffer(p),a=new Uint8Array(r),l=f.compressToBuffer(a)):(r=n.alloc(p),l=f.compressToBuffer(r)),r.slice(0,l)}}).call(this,i(31),i(26).Buffer)},function(t,e,i){"use strict";var n=i(19);i.d(e,"a",function(){return n.a});var r=i(16);i.d(e,"b",function(){return r.a})},function(t,e,i){"use strict";var n=3;function r(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],e=a[1],i=a[2],this.d=e+2*i;for(var s=0;s<this.d*this.d;s++){var o=a[n+s],h=a[n+s+1];r.push(o===h?null:a.subarray(o,h))}var l=a[n+r.length],u=a[n+r.length+1];this.keys=a.subarray(l,u),this.bboxes=a.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var f=i/e*t;this.min=-f,this.max=t+f}r.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(t,e,i,n,r,a){this.cells[r].push(a)},r.prototype.query=function(t,e,i,n){var r=this.min,a=this.max;if(t<=r&&e<=r&&a<=i&&a<=n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,i,n,this._queryCell,s,{}),s},r.prototype._queryCell=function(t,e,i,n,r,a,s){var o=this.cells[r];if(null!==o)for(var h=this.keys,l=this.bboxes,u=0;u<o.length;u++){var c=o[u];if(void 0===s[c]){var f=4*c;t<=l[f+2]&&e<=l[f+3]&&i>=l[f+0]&&n>=l[f+1]?(s[c]=!0,a.push(h[c])):s[c]=!1}}},r.prototype._forEachCell=function(t,e,i,n,r,a,s){for(var o=this._convertToCellCoord(t),h=this._convertToCellCoord(e),l=this._convertToCellCoord(i),u=this._convertToCellCoord(n),c=o;c<=l;c++)for(var f=h;f<=u;f++){var p=this.d*f+c;if(r.call(this,t,e,i,n,p,a,s))return}},r.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=n+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var s=e,o=0;o<t.length;o++){var h=t[o];a[n+o]=s,a.set(h,s),s+=h.length}return a[n+t.length]=s,a.set(this.keys,s),s+=this.keys.length,a[n+t.length+1]=s,a.set(this.bboxes,s),s+=this.bboxes.length,a.buffer};var a=r,s=i(6),o=i(7);function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boxDistance=0,this.ctx=e,this.formatFont=i}var e,i,n;return e=t,(i=[{key:"setBox",value:function(t,e,i){return t.forEach(function(t,n){t.hidden=!1;var r=e[t.styleId];0!=r.show?(1==t.type&&(i?this.setPointBox(t,t.datas,this.ctx,r):this.setPointBox(t,t.sourceAngleData,this.ctx,r)),2==t.type&&("text"==t.lineType&&(i?this.setTextLineBox(t,t.datas,this.ctx,r):this.setTextLineBox(t,t.sourceAngleData,this.ctx,r)),"code"==t.lineType&&(i?this.setCodeLineBox(t,t.datas,this.ctx,r):this.setCodeLineBox(t,t.sourceAngleData,this.ctx,r)),"arrow"==t.lineType&&(i?this.setArrowLineBox(t,t.datas,r):this.setArrowLineBox(t,t.sourceAngleData,r)))):t.hidden=!0}.bind(this)),this.filterFeature(t)}},{key:"setPointBox",value:function(t,e,i,n){if(n.labelFunction){var r=new Function("label",n.labelFunction);try{t.label=r.call({},t.attributes[n.labelfield])}catch(e){console.warn(t.label+": 调用labelFunction失败!")}}var a=s.a.isNotNull(t.label);if(a||t.iconImg){var o=this.getFontWidthHeight(i,t,n,a),h=o.graphicWidth,l=o.graphicHeight,u=o.fontWidth,c=o.fontHeight,f=o.maxFontheight,p=n.pointOffsetX,d=n.pointOffsetY;p||(p=0),d||(d=0);var g=[e[0][0][0],e[0][0][1]];g[0]=g[0]+p,g[1]=g[1]+d;var y=n.pointBackgroundGap;1!=n.pointHashBackground&&(y=0);var v=n.graphicDistance;0!=l&&0!=h||(v=0),n.hasOwnProperty("direction")||(n.direction=0);var m=[],_=[];if(n.texture)if(t.label)m=this.getPointAvoidBox(g,n,v,y,h,l,u,f),_=this.getPointDrawPosition(g,n,v,y,h,l,u,c,f);else{var w=[g[0]-.5*h,g[1]-.5*c,g[0]+.5*h,g[1]+.5*c];m=[w=this.boxScale(w,n.pointBoxDisance)],_=[[g[0],g[1]]]}else{var b=[g[0]-.5*u-y,g[1]-y-.5*f,g[0]+.5*u+y,g[1]+y+.5*f];m=[b=this.boxScale(b,n.pointBoxDisance)],_=[[g[0]-.5*u,g[1]-.5*c+.5*n.pointHeight]]}t.boxs=m,t.box=m[0],t.fourPoints=_,t.textPoint=_[0]}else t.hidden=!0}},{key:"getFontWidthHeight",value:function(t,e,i,n){var r={},a=i.graphicWidth,h=i.graphicHeight,l=e.iconImg;if(l?a&&h||(a=l.width,h=l.height):(a=0,h=0),r.graphicWidth=a,r.graphicHeight=h,r.fontWidth=a,r.fontHeight=h,n){e.label=e.label+"";var u=e.label.split(" "),c=0;t.save(),t.font=s.a.formatFont(i.pointStrokeFont,1,this.formatFont);for(var f=0;f<u.length;f++){var p=o.a.measureText(u[f].replace(/&nbsp;/g," "),t.font,t);c=p>c?p:c}t.restore(),r.fontWidth=c,r.fontHeight=i.pointHeight*u.length+2*(u.length-1),r.maxFontheight=r.fontHeight>h?r.fontHeight:h}return r}},{key:"getPointAvoidBox",value:function(t,e,i,n,r,a,s,o){var h=[t[0]-.5*r,t[1]-i-.5*o,t[0]+.5*r+n+s+2*i,t[1]+.5*o+i],l=[t[0]-.5*r-n-s-2*i,h[1],t[0]+.5*r,h[3]],u=[t[0]-.5*s-i,t[1]-.5*a,t[0]+.5*s+i,t[1]+.5*a+n+2*i+o],c=[u[0],t[1]-n-2*i-o-.5*a,u[2],t[1]+.5*a],f=[h=this.boxScale(h,e.pointBoxDisance),l=this.boxScale(l,e.pointBoxDisance),u=this.boxScale(u,e.pointBoxDisance),c=this.boxScale(c,e.pointBoxDisance)];if(!e.isFourDirections&&!e.isEightDirections)return[f[e.direction]];if(e.isFourDirections){if(e.direction>0){var p=f.splice(e.direction,1);f.unshift(p[0])}return f}if(f=[h,l,u,c,[h[0],c[1],h[2],t[1]+.5*a],[h[0],t[1]-.5*a,h[2],u[3]],[l[0],c[1],l[2],t[1]+.5*a],[l[0],t[1]-.5*a,l[2],u[3]]],e.direction>0){var d=f.splice(e.direction,1);f.unshift(d[0])}return f}},{key:"getPointDrawPosition",value:function(t,e,i,n,r,a,s,o,h){var l=e.pointHeight;a>l&&(l=a);var u=[t[0]+.5*r+i+n,t[1]-.5*o+.5*l],c=[t[0]-.5*r-i-n-s,t[1]-.5*o+.5*l],f=[t[0]-.5*s,t[1]+i+n+.5*l+.5*a],p=[f[0],t[1]-i-n-o+.5*l-.5*a],d=[u,c,f,p];if(!e.isFourDirections&&!e.isEightDirections)return[d[e.direction]];if(e.isFourDirections){if(e.direction>0){var g=d.splice(e.direction,1);d.unshift(g[0])}return d}if(d=[u,c,f,p,[u[0],p[1]],[u[0],f[1]],[c[0],p[1]],[c[0],f[1]]],e.direction>0){var y=d.splice(e.direction,1);d.unshift(y[0])}return d}},{key:"setTextLineBox",value:function(t,e,i,n){var r=t.label,a=e;if(0!=a.length){t.textPoints=a;var s=[];if(1==n.lineHashBackground||1==a.length){var h=a[0][0];if(a.length>1)h=a[Math.floor(r.length/2)][0];i.save(),this.formatFont?i.font=o.a.formatFont(n.lineFillFont,1,!0):i.font=n.lineFillFont;var l=o.a.measureText(t.label,i.font,i);i.restore(),n.lineBackgroundGap||(n.lineBackgroundGap=0);var u=h[0]-l/2-n.lineBackgroundGap,c=h[0]+l/2+n.lineBackgroundGap,f=[u,h[1]-.5*n.lineHeight-n.lineBackgroundGap,c,h[1]+.5*n.lineHeight+n.lineBackgroundGap];this.boxScale(f,n.lineTextBoxDisance),s.push(f)}else{if(n.lineTextRotate||0==n.lineTextRotate)for(var p=0;p<a.length;p++)a[p][1]=n.lineTextRotate;else if(this.textToSameBearing(t.angle,a),!n.isImportant&&this.isMessy(t,a,n,r))return void(t.hidden=!0);var d=this.getLineBoxs(r,a,n);if(!d)return void(t.hidden=!0);s=s.concat(d)}t.boxs=s}else t.hidden=!0}},{key:"setCodeLineBox",value:function(t,e,i,n){var r=e;if(0!=r.length){var a=r[0][0];i.save(),this.formatFont?i.font=o.a.formatFont(n.codeLineFillFont,1,!0):i.font=n.codeLineFillFont;var s=o.a.measureText(t.label,i.font,i);i.restore();var h=a[0]-s/2-n.codeLineBackgroundGap,l=a[0]+s/2+n.codeLineBackgroundGap,u=[h,a[1]-.5*n.codeLineHeight-n.codeLineBackgroundGap,l,a[1]+.5*n.codeLineHeight+n.codeLineBackgroundGap];this.boxScale(u,n.lineCodeBoxDisance),t.boxs=[u],t.codePoint=a}else t.hidden=!0}},{key:"setArrowLineBox",value:function(t,e,i){var n=e;if(3==n.length){var r=n[0][0],a=n[2][0],s=r[0]<a[0]?r[0]:a[0],o=r[0]>a[0]?r[0]:a[0],h=[s,r[1]<a[1]?r[1]:a[1],o,r[1]>a[1]?r[1]:a[1]];this.boxScale(h,i.lineArrowBoxDisance),t.boxs=[h],t.arrowPoint=n}else t.hiden=!0}},{key:"filterFeature",value:function(t){for(var e=[],i=0;i<t.length;i++)t[i].hidden||e.push(t[i]);return e}},{key:"isMessy",value:function(t,e,i,n){for(var r=e[0][0],a=r[0],s=r[1],o=r[0],h=r[1],l=e[0][1],u=e[0][1],c=0;c<n.length;c++){var f=e[c][0],p=e[c][1];f[0]>o&&(o=f[0]),f[0]<a&&(a=f[0]),f[1]>h&&(h=f[1]),f[1]<s&&(s=f[1]),p>u&&(u=p),p<l&&(l=p)}if(u-l>i.angle){if(0!=i.angleSwitch||!i.angleColor)return!0;t.lineFillStyle=i.angleColor}return!1}},{key:"getLineBoxs",value:function(t,e,i){for(var n=[],r=[],a=0;a<t.length;a++){var s=e[a][0];0==e[a][1]&&(e[a][1]=.5);var o=[s[0]-1.2*i.lineHeight*.5,s[1]-1.2*i.lineHeight*.5,s[0]+1.2*i.lineHeight*.5,s[1]+1.2*i.lineHeight*.5];this.boxScale(o,i.lineTextBoxDisance);var h=[s[0]-.5*i.lineHeight,s[1]-1.2*i.lineHeight*.5,s[0]+.5*i.lineHeight,s[1]+.5*i.lineHeight];r.push(h),n.push(o)}if(!i.isImportant)for(var l=0;l<r.length-1;l++)for(var u=r[l],c=l+1;c<r.length;c++){var f=r[c];if(this.crashBox(u,f))return null}return n}},{key:"boxScale",value:function(t,e){return e||0==e||(e=this.boxDistance),t[0]=t[0]-.5*e,t[1]=t[1]-.5*e,t[2]=t[2]+.5*e,t[3]=t[3]+.5*e,t}},{key:"crashBox",value:function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}},{key:"textToSameBearing",value:function(t,e){t>=45?t-=90:t<=-45&&(t+=90);for(var i=0;i<e.length;i++){var n=e[i][1],r=t-n;r>45&&(e[i][1]=n+90),r<-45&&(e[i][1]=n-90)}}}])&&h(e.prototype,i),n&&h(e,n),t}();function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.grid=null,this.GLabelBox=new l(e,i),this.debug=n}var e,i,n;return e=t,(i=[{key:"avoid",value:function(t,e,i){for(var n=0;n<t.length;n++){var r=t[n],a=e[r.styleId];1==r.type&&this.avoidPointLine(r,i,a),2==r.type&&(r.isCollision=this.avoidLineLine(r,i))}return t}},{key:"avoidPointLine",value:function(t,e,i){var n=t.weight;e=this.getAvoidLineFeatures(n,e);var r=t.boxs.length;t.boxIndexs={};for(var a=0;a<r;a++)t.boxIndexs[a]=!0;for(var s=0,o=0;o<e.length;o++)for(var h=e[o],l=0;l<r;l++){var u=t.boxs[l];if(this.crashBoxLine(u,h.sourceDatas,!1)&&t.boxIndexs[l]&&(delete t.boxIndexs[l],++s==r))return!0}return!1}},{key:"avoidLineLine",value:function(t,e){var i=t.weight;e=this.getAvoidLineFeatures(i,e);for(var n=0;n<e.length;n++)for(var r=e[n],a=!1,s=!1,o=0;o<t.boxs.length;o++){var h=t.boxs[o],l=[];if(l.push([h[0],h[1],h[2],h[3]]),l.push([h[2],h[1],h[0],h[3]]),a=this.crashPartLineLine(l[0],r.sourceDatas),s=this.crashPartLineLine(l[1],r.sourceDatas),a||s)return!0}return!1}},{key:"getAvoidLineFeatures",value:function(t,e){for(var i=[],n=0;n<e.length;n++){var r=e[n];r.weight>t&&i.push(r)}return i}},{key:"crashBoxLine",value:function(t,e,i){var n=[];i?(n.push([t[0],t[1],t[2],t[1]]),n.push([t[2],t[1],t[2],t[3]]),n.push([t[2],t[3],t[0],t[3]]),n.push([t[0],t[3],t[0],t[1]])):(n.push([t[0],t[1],t[2],t[3]]),n.push([t[2],t[1],t[0],t[3]]));for(var r=0;r<n.length;r++)for(var a=n[r],s=0;s<e.length/2-1;s++){var o=[e[2*s],e[2*s+1],e[2*(s+1)],e[2*(s+1)+1]];if(this.crashPartLinePartLine(a,o))return!0}return!1}},{key:"crashLineLine",value:function(t,e){for(var i=0;i<t.length/2-1;i++)for(var n=[t[2*i],t[2*i+1],t[2*(i+1)],t[2*(i+1)+1]],r=0;r<e.length/2-1;r++){var a=[e[2*r],e[2*r+1],e[2*(r+1)],e[2*(r+1)+1]];if(this.crashPartLinePartLine(n,a))return!0}return!1}},{key:"crashPartLineLine",value:function(t,e){for(var i=0;i<e.length/2-1;i++){var n=[e[2*i],e[2*i+1],e[2*(i+1)],e[2*(i+1)+1]];if(this.crashPartLinePartLine(t,n))return!0}return!1}},{key:"crashPartLinePartLine",value:function(t,e){var i,n,r,a,s,o,h,l,u,c=t[0],f=t[1],p=t[2],d=t[3],g=e[0],y=e[1],v=e[2];if(0==(u=(r=p-c)*(o=e[3]-y)-(s=v-g)*(a=d-f)))return 0;var m=u>0;return(h=r*(n=f-y)-a*(i=c-g))<0==m?0:(l=s*n-o*i)<0==m?0:h>u==m||l>u==m?0:1}},{key:"defaultAvoid",value:function(t,e,i,n,r){if(this.grid=i?new a(4096,32,0):new a(512,32,32),null==t||t.length<1)return[];t=this.GLabelBox.setBox(t,e,i),t=this.mergeFeatures(t),r&&o.a.sort(t,e,n);for(var s=0;s<t.length;s++){var h=t[s],l=e[h.styleId];this.avoidFeature(h,l)}var u=this.GLabelBox.filterFeature(t);return this.removeRepeat(u,e),u=this.filterFeature(u),this.prevFeatures=u,this.debug?t:u}},{key:"avoidFeature",value:function(t,e){0!=e.show&&1!=t.hidden&&t.boxs?1==t.type?this.avoidPoint(t,e):t.isCollision?t.hidden=!0:this.avoidLine(t,e):t.hidden=!0}},{key:"avoidPoint",value:function(t,e){if(1!=e.isImportant)if((e.isFourDirections||e.isEightDirections)&&e.texture)this.addFourCollisionFeatureToCells(t,e,0);else{if(t.boxIndexs&&!t.boxIndexs[0])return void(t.hidden=!0);if(this.isCollision(t.box))return void(t.hidden=!0);this.addBoxToCells(t.primaryId,t.box)}else this.addBoxToCells(t.primaryId,t.box)}},{key:"avoidLine",value:function(t,e){if(1!=e.isImportant){for(var i=!1,n=0;n<t.boxs.length;n++){var r=t.boxs[n];if(this.isCollision(r)){i=!0;break}}if(i)t.hidden=!0;else for(var a=0;a<t.boxs.length;a++){var s=t.boxs[a];this.addBoxToCells(t.primaryId+"index_"+a,s)}}else for(var o=0;o<t.boxs.length;o++){var h=t.boxs[o];this.addBoxToCells(t.primaryId+"index_"+o,h)}}},{key:"addFourCollisionFeatureToCells",value:function(t,e,i){var n=!0,r=[];if((!t.boxIndexs||t.boxIndexs&&t.boxIndexs[i])&&(r=t.boxs[i],n=this.isCollision(r)),n){if(++i==t.boxs.length&&(i-=t.boxs.length),0==i)return void(t.hidden=!0);this.addFourCollisionFeatureToCells(t,e,i)}else t.textPoint=t.fourPoints[i],t.box=r,this.addBoxToCells(t.primaryId,r)}},{key:"isCollision",value:function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return this.grid.query(e,i,n,r).length>0}},{key:"addBoxToCells",value:function(t,e){var i=e[0],n=e[1],r=e[2],a=e[3];this.grid.insert(t,i,n,r,a)}},{key:"mergeFeatures",value:function(t){for(var e={},i=0;i<t.length;i++){var n=t[i];e[n.attributeId]||(e[n.attributeId]=[]),e[n.attributeId].push(n)}for(var r in e){var a=e[r];if(a.length>1){var s=a[0];if(!s.boxIndexs)continue;if("1"==s.type){for(var o=s.boxIndexs,h=1;h<a.length;h++)o=this.getBothDirection(o,a[h].boxIndexs);var l=!0;for(var u in o){l=!1;break}for(var c=0;c<a.length;c++)l?a[c].hidden=!0:a[c].boxIndexs=o}s.type}}return this.GLabelBox.filterFeature(t)}},{key:"getBothDirection",value:function(t,e){var i={};for(var n in t)e&&e[n]&&(i[n]=!0);return i}},{key:"getDistance",value:function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.pow(i*i+n*n,.5)}},{key:"filterFeature",value:function(t){for(var e=[],i=0;i<t.length;i++)t[i].hidden||(t[i].drawed=!0,e.push(t[i]));return e}},{key:"removeRepeat",value:function(t,e){for(var i=[],n=[],r=[],a=[],s=[],o=[],h=0;h<t.length;h++){var l=t[h];1==l.type?1==l.drawed?a.push(l):i.push(l):2==l.type&&("text"==l.lineType&&(1==l.drawed?s.push(l):n.push(l)),"code"==l.lineType&&(1==l.drawed?o.push(l):r.push(l)))}for(var u=0;u<i.length;u++){var c=i[u];this.getShowPointFeatrues(a,c,e)}for(var f=0;f<n.length;f++){var p=n[f];this.getShowLineTextFeatrues(s,p,e)}for(var d=0;d<r.length;d++){var g=r[d];this.getShowLineCodeFeatrues(o,g,e)}if(this.prevFeatures)for(var y=0;y<this.prevFeatures.length;y++){this.prevFeatures[y].drawed=!1}}},{key:"getShowPointFeatrues",value:function(t,e,i){for(var n=!1,r=0;r<t.length;r++){var a=t[r],s=i[a.styleId];if(a.label==e.label&&s.distance&&i[e.styleId].distance)this.getDistance(a.centerPoint,e.centerPoint)<s.distance&&(n=!0,e.hidden=!0)}n||t.push(e)}},{key:"getShowLineTextFeatrues",value:function(t,e,i){for(var n=!1,r=0;r<t.length;r++){var a=t[r],s=i[a.styleId];if(a.label==e.label&&s.lineTextDistance&&i[e.styleId].lineTextDistance)this.getDistance(a.centerPoint,e.centerPoint)<s.lineTextDistance&&(n=!0,e.hidden=!0)}n||t.push(e)}},{key:"getShowLineCodeFeatrues",value:function(t,e,i){for(var n=!1,r=0;r<t.length;r++){var a=t[r],s=i[a.styleId];if(a.label==e.label&&s.lineCodeDistance&&i[e.styleId].lineCodeDistance)this.getDistance(a.centerPoint,e.centerPoint)<s.lineCodeDistance&&(n=!0,e.hidden=!0)}n||t.push(e)}}])&&u(e.prototype,i),n&&u(e,n),t}();e.a=c},function(t,e){var i,n,r=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(t){i=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var h,l=[],u=!1,c=-1;function f(){u&&h&&(u=!1,h.length?l=h.concat(l):c=-1,l.length&&p())}function p(){if(!u){var t=o(f);u=!0;for(var e=l.length;e;){for(h=l,l=[];++c<e;)h&&h[c].run();c=-1,e=l.length}h=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new d(t,e)),1!==l.length||u||o(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){"use strict";var n=i(0),r=i.n(n);r.a.Control.Attribution.prototype.options={position:"bottomright"},r.a.Map.TouchZoom.prototype._onTouchMove=(r.a.Map.TouchZoom.prototype._onTouchMove,function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),a=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(a,this._startZoom)+1,!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&a<1||this._zoom>e.getMaxZoom()&&a>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===a)return}else{var s=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===a&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0),this._moved=!0),r.a.Util.cancelAnimFrame(this._animRequest);var o=r.a.bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=r.a.Util.requestAnimFrame(o,this,!0),r.a.DomEvent.preventDefault(t)}}),r.a.Map.prototype.flyTo=(r.a.Map.prototype.flyTo,function(t,e,i){if(!1===(i=i||{}).animate||!r.a.Browser.any3d)return this.setView(t,e,i);this._stop();var n=this.project(this.getCenter()),a=this.project(t),s=this.getSize(),o=this._zoom;t=r.a.latLng(t),e=void 0===e?o:e;var h=Math.max(s.x,s.y),l=h*this.getZoomScale(o,e),u=a.distanceTo(n)||1,c=1.42,f=c*c;function p(t){var e=(l*l-h*h+(t?-1:1)*f*f*u*u)/(2*(t?l:h)*f*u),i=Math.sqrt(e*e+1)-e;return i<1e-9?-18:Math.log(i)}function d(t){return(Math.exp(t)-Math.exp(-t))/2}function g(t){return(Math.exp(t)+Math.exp(-t))/2}var y=p(0);function v(t){return h*(g(y)*(d(e=y+c*t)/g(e))-d(y))/f;var e}var m=Date.now(),_=(p(1)-y)/c,w=i.duration?1e3*i.duration:1e3*_*.8;return this._moveStart(!0),function i(){var s=(Date.now()-m)/w,l=function(t){return 1-Math.pow(1-t,1.5)}(s)*_;s<=1?(this._flyToFrame=r.a.Util.requestAnimFrame(i,this),this._move(this.unproject(n.add(a.subtract(n).multiplyBy(v(l)/u)),o),this.getScaleZoom(h/function(t){return h*(g(y)/g(y+c*t))}(l),o),{flyTo:!0})):(e=Math.round(e),this._move(t,e)._moveEnd(!0))}.call(this),this}),(window.ActiveXObject||"ActiveXObject"in window)&&(String.prototype.startsWith=function(t){return!(null==t||""==t||0==this.length||t.length>this.length)&&this.substr(0,t.length)==t},String.prototype.endsWith=function(t){return window.ActiveXObject||"ActiveXObject"in window?-1!==this.indexOf(t,this.length-t.length):this.endsWith(t)});var a=r.a.extend({},r.a.CRS.Earth,{code:"EPSG:4326",projection:r.a.Projection.LonLat,transformation:new r.a.Transformation(1/180,1,-1/180,.5),scale:function(t){return 256*Math.pow(2,t-1)}});r.a.CRS.CustomEPSG4326=a;e.a=a},function(t,e,i){"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response},function(t,e,i){"use strict";(function(t){var n=i(35),r=i(14),a=i(2),s=i(27),o=i.n(s),h=i(30),l=i(12),u=i(24),c=i(36);function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var p=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=0,this.height=0,this.grid=[],this.cache=new n.a(256),this.gwvtAnno=null,this.dataSource=[],this.isReady=!1,this.maxExtent=[],this.extent=[],this.res=0,this.tileSize=256,this.hitDetection=!1,this.features=[],this.requestingTiles={},this.hasImportant=!0,this.ratio=1;var t=document.createElement("CANVAS");this.ctx=t.getContext("2d",{isQuality:!0}),this.ableAvoid=!0,this.ableWeight=!0,this.cellsize=4,this.maxPerCell=1,this.styleMap={},this.debug=!1,this.GAnnoAvoid=new h.a(this.ctx,!1,this.debug),this.highlightLabels={}}var i,s,p;return i=e,(s=[{key:"setDebug",value:function(t){this.debug=t,this.GAnnoAvoid=new h.a(this.ctx,!1,this.debug)}},{key:"init",value:function(t,e,i,n){this.tileSize=i,this.gwvtAnno=n,this.cellsize=n.cellsize,this.initCanvas(t,e),this.loadResources()}},{key:"loadResources",value:function(){if(0!=this.dataSource.length){this.cache.clean(),this.requestingTiles={};for(var t=[],e=0;e<this.dataSource.length;e++){var i=this.dataSource[e];"URLDataSource"==i.type&&(t=t.concat(i.loadStyle())),"LocalDataSource"==i.type&&(t=t.concat(i.loadTexture()))}t.length>0?Promise.all(t).then(function(){this.isReady=!0,this.grid.length>0&&this.requestLabelTiles(this.grid)}.bind(this)):this.isReady=!0}else this.isReady=!1}},{key:"initCanvas",value:function(t,e){this.width=t,this.height=e,this.root||(this.root=document.createElement("canvas")),this.root.style.width=this.width+"px",this.root.style.height=this.height+"px",this.root.width=this.width*this.ratio,this.root.height=this.height*this.ratio,this.root.id="labelCanvas",this.canvas=this.root.getContext("2d",{isQuality:!0}),this.hitDetection&&(this.hitCanvas||(this.hitCanvas=document.createElement("canvas")),this.hitCanvas.style.width=this.width+"px",this.hitCanvas.style.height=this.height+"px",this.hitCanvas.width=this.width,this.hitCanvas.height=this.height,this.hitContext=this.hitCanvas.getContext("2d",{isQuality:!0}))}},{key:"addDataSource",value:function(t){"URLDataSource"==t.type&&(t.url=t.url+"&tilesize="+this.tileSize),"URLDataSource"!=t.type&&"LocalDataSource"!=t.type||this.dataSource.push(t)}},{key:"removeDataSourceById",value:function(t){for(var e=0;e<this.dataSource.length;e++)if(this.dataSource[e].id==t)return void this.dataSource.splice(e,1)}},{key:"getDataSourceById",value:function(t){for(var e=0;e<this.dataSource.length;e++)if(this.dataSource[e].id==t)return this.dataSource[e]}},{key:"clean",value:function(){this.canvas.clearRect(0,0,this.width*this.ratio,this.height*this.ratio),this.hitContext&&this.hitContext.clearRect(0,0,this.width,this.height)}},{key:"redraw",value:function(){0!=this.grid.length&&(this.styleMap={},this.loadResources())}},{key:"requestLabelTiles",value:function(t,e){if(this.grid=t,this.isReady){var i=this.getRequestTileUrls(t);this.sendRequest(i)}}},{key:"getLocalLabelDatas",value:function(){for(var t=[],e=0;e<this.dataSource.length;e++){var i=this.dataSource[e];if("LocalDataSource"==i.type)for(var n=0;n<i.features.length;n++){var r=i.features[n];r.inBounds(this.extent)&&(r.attributeId=r.attributes.attributeId,r.primaryId=r.attributeId,1==r.type&&(r.sourceAngleData=[[r.sourceData,0]],r.transformData(this.extent,this.res),r.label=r.getFeatureLabel(),r.iconImg=i.textures[r.style.texture],t.push(r)),2==r.type&&(r.label=r.getFeatureLabel(),r.textures=i.textures,t=t.concat(this.cutLineFeature(r,!0))))}}return t}},{key:"getRequestTileUrls",value:function(t){this.hitCacheUrls=[],this.currentTileDatas=[],this.defaultStyeTileDatas=[];for(var e={},i={},n=0;n<this.dataSource.length;n++){var r=this.dataSource[n];if("URLDataSource"==r.type)for(var a=r.url,s=0;s<t.length;s++){var o=t[s],h=a.replace("${x}",o.col).replace("{x}",o.col);if(h=(h=h.replace("${y}",o.row).replace("{y}",o.row)).replace("${z}",o.level).replace("{z}",o.level),r.urlArray.length>0){var l=r.urlArray.length-1,u=Math.round(Math.random()*l);h=r.urlArray[u]+"/mapserver"+h.split("/mapserver")[1]}this.cache.getItem(h)?this.hitCacheUrls.push({url:h,isDefaultStyle:"_default__"==r.styleId}):this.requestingTiles[h]?i[h]=!0:e[h]={url:h,xyz:o,dataSourceId:r.id,dataType:r.newEngine?"arraybuffer":"json"}}}return this.cancelRequest(i),e}},{key:"cancelRequest",value:function(t){for(var e in this.requestingTiles)if(!t[e]){var i=this.requestingTiles[e];delete this.requestingTiles[e],i.xhr.abort(),i.requestItem.cancel=!0}}},{key:"sendRequest",value:function(t){var e=0;for(var i in t){var n=t[i],r=null;"json"==n.dataType?r=Object(a.d)(n):"arraybuffer"==n.dataType&&(r=Object(a.b)(n)),this.requestingTiles[n.url]={xhr:r.xhr,requestItem:n},r.then(this.tileSuccessFunction.bind(this),this.tileFailFunction.bind(this)),e++}0==e&&this.sendSuccess([],[])}},{key:"toBuffer",value:function(e){for(var i=new t(e.byteLength),n=new Uint8Array(e),r=0;r<i.length;++r)i[r]=n[r];return i}},{key:"Utf8ArrayToStr",value:function(t){var e,i,n,r,a,s;for(e="",n=t.length,i=0;i<n;)switch((r=t[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(r);break;case 12:case 13:a=t[i++],e+=String.fromCharCode((31&r)<<6|63&a);break;case 14:a=t[i++],s=t[i++],e+=String.fromCharCode((15&r)<<12|(63&a)<<6|(63&s)<<0)}return e}},{key:"tileSuccessFunction",value:function(t){if(1!=t.param.cancel&&!this.isEmptyObject(this.requestingTiles)){var e=t.param.url;delete this.requestingTiles[e];var i=t.param.dataSourceId,n=this.getDataSourceById(i),r=null;if(n&&n.newEngine){var a=this.toBuffer(t.data),s={param:t.param,tileData:{}};if(a.length>0){for(var o=new c.a(a,4),h=o.getAllLayerNames(),f=0;f<h.length;f++)s.tileData[h[f]]={geometryType:o.getGeometryType(h[f]),props:JSON.parse(this.Utf8ArrayToStr(o.getLayerPro(h[f])))};s.vant=o}r=this.parseFeature(s,n)}else r=this.parseFeature(t,n);var p=[];null!=r.styleId?("_default__"==r.styleId?(l.a.updateFeatureAttr(r.pointFeatures,this.styleMap,this.ratio,{},!0,this.maxExtent,this.extent,this.res,this.tileSize),p=(p=p.concat(r.lineFeatures)).concat(r.pointFeatures),this.defaultStyeTileDatas.push({url:e,labelFeatures:p,avoidLineFeatures:r.avoidLineFeatures})):(this.ableAvoid?(p=u.a.fristFilter(r.pointFeatures,r.lineFeatures,this.styleMap,this.ableWeight,!0,this.tileSize,this.cellsize,1*this.tileSize,this.maxPerCell),l.a.updateFeatureAttr(p.pointFeatures,this.styleMap,this.ratio,n.textures,!0,this.maxExtent,this.extent,this.res,this.tileSize),p=u.a.scendFilter(p.pointFeatures,p.lineFeatures,this.styleMap,this.ableWeight,!0,this.tileSize,this.cellsize,1*this.tileSize),p=this.GAnnoAvoid.GLabelBox.setBox(p,this.styleMap,!1),r.avoidLineFeatures.length>0&&(p=this.GAnnoAvoid.avoid(p,this.styleMap,r.avoidLineFeatures))):(l.a.updateFeatureAttr(r.pointFeatures,this.styleMap,this.ratio,n.textures,!0,this.maxExtent,this.extent,this.res,this.tileSize),p=r.pointFeatures.concat(r.lineFeatures)),this.currentTileDatas.push({url:e,labelFeatures:p,avoidLineFeatures:r.avoidLineFeatures})),this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas,this.defaultStyeTileDatas)):this.currentTileDatas.push({url:e,labelFeatures:[],avoidLineFeatures:r.avoidLineFeatures})}}},{key:"isEmptyObject",value:function(t){for(var e in t)return!1;return!0}},{key:"tileFailFunction",value:function(t){if(1!=t.param.cancel&&!this.isEmptyObject(this.requestingTiles)){var e=t.param.url;delete this.requestingTiles[e],this.isEmptyObject(this.requestingTiles)&&this.sendSuccess(this.currentTileDatas,this.defaultStyeTileDatas)}}},{key:"sendSuccess",value:function(t,e){this.gwvtAnno.animating||(this.gwvtAnno.resetCanvasDiv(),this.clean(),this.hitDetection&&(this.features=[]),this.drawLabel(t),this.drawDefaultStyleLabel(e))}},{key:"drawDefaultStyleLabel",value:function(t){for(var e=this.mergeLabelData(t,this.hitCacheUrls,!0).labelFeatures,i=0;i<t.length;i++){var n=t[i];this.cache.push(n.url,n)}if(this.hitDetection)for(var a=0;a<e.length;a++){var s=e[a];this.features[s.id]=s}r.a.drawDefaultStyle(this.canvas,e,this.styleMap,this.ratio,!1,!1,this.hitContext,this.hitDetection)}},{key:"drawLabel",value:function(t){for(var e=this.mergeLabelData(t,this.hitCacheUrls,!1).labelFeatures,i=0;i<t.length;i++){var n=t[i];this.cache.push(n.url,n)}var a=this.getLocalLabelDatas();e=e.concat(a);var s=e=this.GAnnoAvoid.GLabelBox.setBox(e,this.styleMap,!0);if(this.ableAvoid&&(s=this.GAnnoAvoid.defaultAvoid(e,this.styleMap,!0,this.hasImportant,this.ableWeight)),this.hitDetection)for(var o=0;o<s.length;o++){var h=s[o];this.features[h.id]=h}r.a.draw(this.canvas,s,this.styleMap,this.ratio,!1,!1,this.hitContext,this.hitDetection,!1,this.debug)}},{key:"drawAvoidLine",value:function(t){this.canvas.save(),this.canvas.beginPath();for(var e=0;e<t.length;e++){var i=t[e];this.canvas.lineWidth=1,this.canvas.strokeStyle="#fff000",this.canvas.moveTo(i.datas[0],i.datas[1]);for(var n=1;n<i.datas.length/2;n++)this.canvas.lineTo(i.datas[2*n],i.datas[2*n+1])}this.canvas.stroke(),this.canvas.restore()}},{key:"parseFeature",value:function(t,e){var i={};if(e.newEngine){var n=t.tileData;for(var r in n)if(i[r]={features:[],fieldsConfig:e.serverInfo[r].fieldsConfig,serverId:e.servername,type:1},"point"==n[r].geometryType.toLowerCase()?i[r].type=1:"line"!=n[r].geometryType.toLowerCase()&&"linestring"!=n[r].geometryType.toLowerCase()&&"multilinestring"!=n[r].geometryType.toLowerCase()||(i[r].type=2),n[r].props&&n[r].props.length>0)for(var a=0;a<n[r].props.length;a++){var s=[];s.push(n[r].geometryType),s.push(n[r].props[a]),s.push(t.vant.getCoordinatesByIndex(r,a,10)),i[r].features.push(s)}}else i=t.data;var h={x:t.param.xyz.col,y:t.param.xyz.row,l:t.param.xyz.level},c=0;for(var f in i){i[f];c++}var p={pointFeatures:[],lineFeatures:[],pointImportantFeatures:[],lineImportantFeatures:[]};if(c>0&&e&&e.styleFun){var d=h.l;if(e.newEngine){var g=new o.a(i,this.styleMap,d);e.styleFun.call({},g,d)}else{var y=new o.a(i,this.styleMap,d);e.styleFun.call({},y,d)}p=l.a.parseLayerDatas(i,this.styleMap,h,!0,this.maxExtent,this.extent,this.res,this.tileSize)}var v=l.a.parseAvoidLine(i._layerAvoids,h,!0,this.maxExtent,this.extent,this.res,this.tileSize),m=u.a.removeTileOutPointFeatures(p.pointFeatures,this.tileSize),_=p.lineFeatures;return{styleId:e?e.styleId:null,pointFeatures:m,lineFeatures:_,avoidLineFeatures:v}}},{key:"setGlobalStyle",value:function(t){this.ableAvoid=!t.disableAvoid,this.ableWeight=!t.disableWeight,this.boxDistance=t.boxDistance}},{key:"mergeLabelData",value:function(t,e,i){for(var n=[],r=[],a=0;a<t.length;a++){var s=t[a];n=n.concat(s.labelFeatures),r=r.concat(s.avoidLineFeatures)}for(var o=[],h=0;h<e.length;h++){var u=e[h];u.isDefaultStyle==i&&o.push(u.url)}for(var c=0;c<o.length;c++){for(var f=this.cache.getItem(o[c]).labelFeatures,p=0;p<f.length;p++){var d=f[p];d.datas=l.a.transformData(d.sourceAngleData,d.xyz,this.maxExtent,this.extent,this.res,this.tileSize)}n=n.concat(f);for(var g=this.cache.getItem(o[c]).avoidLineFeatures,y=0;y<g.length;y++){var v=g[y];v.datas=l.a.transformAvoidLine(v.sourceDatas,v.xyz,this.maxExtent,this.extent,this.res,this.tileSize)}r=r.concat(g)}return{labelFeatures:n,avoidLineFeatures:r}}},{key:"getFeatureByXY",value:function(t,e){var i=null;if(this.hitDetection){var n,r=this.hitContext.getImageData(t,e,1,1).data;if(255===r[3]){var a=r[2]+256*(r[1]+256*r[0]);if(a){n=a-1;try{i=this.features[n]}catch(t){console.log(t)}}}}return i}},{key:"getFeaturesByXY",value:function(t,e){var i=[];for(var n in this.features){var r=this.features[n];if(1==r.type&&this.isInBox(t,e,r.box))i.push(r);else if(2==r.type)for(var a=0;a<r.boxs.length;a++){var s=r.boxs[a];if(this.isInBox(t,e,s)){i.push(r);break}}}return i}},{key:"lineToSourceAngleData",value:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],r=t[i+1];e.push([[n,r],0]),i++}return e}},{key:"transformData",value:function(t,e){for(var i=this.extent[0],n=this.extent[3],r=this.maxExtent[0],a=this.maxExtent[3],s=(i-r)/this.res,o=(a-n)/this.res,h=[],l=0;l<t.length;l++){var u=t[l][0],c=[u[0]+e.x*this.tileSize-s,u[1]+e.y*this.tileSize-o];h.push([c,t[l][1]])}return h}},{key:"isInBox",value:function(t,e,i){return t>i[0]&&t<i[2]&&e>i[1]&&e<i[3]}},{key:"highlightLabel",value:function(t,e){for(var i in this.highlightLabels){delete this.highlightLabels[i].lightColor}this.highlightLabels={};for(var n=0;n<t.length;n++){var r=t[n],a=this.features[r];a.lightColor=e,this.highlightLabels[r]=a}}}])&&f(i.prototype,s),p&&f(i,p),e}();e.a=p}).call(this,i(26).Buffer)},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=e,this.map={},this.list=[]}var e,i,r;return e=t,(i=[{key:"push",value:function(t,e){if(this.list.length>this.size-1){var i=this.list.shift();delete this.map[i]}this.list.push(t),this.map[t]=e}},{key:"getItem",value:function(t){return this.map[t]}},{key:"clean",value:function(){this.map={},this.list=[]}},{key:"length",value:function(){return this.list.length}}])&&n(e.prototype,i),r&&n(e,r),t}();e.a=r},function(t,e,i){"use strict";(function(t){var n=i(28),r=i.n(n);function a(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=o(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,h=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){h=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(h)throw a}}}}function o(t,e){if(t){if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function e(t,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.hd=i,this.intLength=4,this.vectorVarintBuffer=t,this.geometyTypeMap=new Map,this.proMap=new Map,this.varintMap=new Map,this.layerMap=new Map,this.offsetMap=new Map,this.proMapOld=new Map,this.offsetMapOld=new Map,this.addVector(t)}var i,n,o;return i=e,(n=[{key:"addVector",value:function(t){var e=this.hd,i=t.readInt32BE(e);e+=this.intLength;var n=t.toString("utf8",e,e+i);e+=i,"vector"==n?this._readVector(t,e):console.error("不是瓦片数据！")}},{key:"addLayer",value:function(t,e){var i=this.hd,n=this.vectorVarintBuffer.readInt32BE(i);i+=this.intLength;var r=this.vectorVarintBuffer.toString("utf8",i,i+n);i+=n,"vector"!=r?this._readLayer(t,this.vectorVarintBuffer):console.error("不是图层数据！")}},{key:"getBuffer",value:function(){var e,i,n,r=[],o=[],h=s(this.layerMap.keys());try{for(h.s();!(n=h.n()).done;){var l=n.value;i=this._getLayerBuffer(l),e=this._stringToByte(l),o.push.apply(o,a(this._intToBytes(e.length))),o.push.apply(o,a(e)),o.push.apply(o,a(this._intToBytes(i.length))),r.push(i)}}catch(t){h.e(t)}finally{h.f()}var u=t.from(o),c=t.concat(r),f=[],p=this._stringToByte("vector");f.push.apply(f,a(this._getHeaderArray())),f.push.apply(f,a(this._intToBytes(p.length))),f.push.apply(f,a(p)),f.push.apply(f,a(this._intToBytes(u.length)));var d=t.from(f);return t.concat([d,u,c])}},{key:"_getHeaderArray",value:function(){for(var t=[],e=0;e<this.hd;e++)t[e]=this._getRandomNum();return t}},{key:"_getLayerBuffer",value:function(e){var i=[],n=this._stringToByte(this.geometyTypeMap.get(e)),r=this._intToBytes(n.length),s=this.proMapOld.get(e),o=this._intToBytes(s.length),h=this.offsetMapOld.get(e),l=t.from(this._intToBytes(h.length)),u=this.varintMap.get(e);return i.push.apply(i,a(this._getHeaderArray())),i.push.apply(i,a(r)),i.push.apply(i,a(n)),i.push.apply(i,a(o)),t.concat([t.from(i),s,l,h,u])}},{key:"_getRandomNum",value:function(){var t=Math.random();return 50+Math.round(80*t)}},{key:"_stringToByte",value:function(e){for(var i=[],n=t.from(e,"utf8"),r=0;r<n.length;r++)i.push(n[r]);return i}},{key:"_byteToString",value:function(e){return t.from(e).toString()}},{key:"_intToBytes",value:function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}},{key:"_bytesToInt",value:function(t){return t[0]<<24|t[1]<<16|t[2]<<8|t[3]}},{key:"getAllLayerNames",value:function(){var t,e=[],i=s(this.layerMap);try{for(i.s();!(t=i.n()).done;){var n=t.value;e.push(n[0])}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"getGeometryType",value:function(t){return this.geometyTypeMap.get(t)}},{key:"getLayerPro",value:function(t){var e=this.proMap.get(t);return r.a.uncompress(e)}},{key:"getOffsetArray",value:function(t){return this.offsetMap.get(t)}},{key:"getOffsetByIndex",value:function(t,e){var i=this.offsetMap.get(t),n=[];return n.push(i[2*e]),n.push(i[2*e+1]),n}},{key:"getLayerCoordinate",value:function(t){return this.varintMap.get(t)}},{key:"getLayerFeature",value:function(t){var e=["",""],i=this.proMap.get(t),n=this.offsetMap.get(t),a=this.varintMap.get(t);return e[1]=a,i.length>0&&(e[0]=r.a.uncompress(i)),n.length,a.length,e}},{key:"getAllCoordinates",value:function(t,e){for(var i,n,r,a=this.getOffsetArray(t),s=this.varintMap.get(t),o=[],h=0;h<a.length/2;h++)i=a[2*h],n=a[2*h+1],r=s.slice(i,i+n),o.push(this._bufferToDoubleArray(r,e));return o}},{key:"getCoordinatesByIndex",value:function(t,e,i){var n=this.getOffsetByIndex(t,e),r=this.varintMap.get(t),a=n[0],s=n[1],o=r.slice(a,a+s);return this._bufferToDoubleArray(o,i)}},{key:"_readLayer",value:function(t,e){if(0!=e.length){var i=this.hd,n=e.readInt32BE(i);i+=this.intLength;var r=e.toString("utf8",i,i+n);this.geometyTypeMap.set(t,r),i+=n;var a=e.readInt32BE(i);i+=this.intLength;var s=e.slice(i,i+a);this.proMap.set(t,s),this.proMapOld.set(t,s),i+=a;var o=e.readInt32BE(i);i+=this.intLength;var h=e.slice(i,i+o),l=this._varintToIntArray(h);this.offsetMap.set(t,l),this.offsetMapOld.set(t,h),i+=o;var u=e.slice(i);this.varintMap.set(t,u)}}},{key:"_readVector",value:function(t,e){var i=t.readInt32BE(e);e+=this.intLength;var n=t.slice(e,e+i);e+=i;for(var r,a,s,o=t.slice(e,this.vectorVarintBuffer.length),h=0,l=0,u=0,c=0,f=0;f<n.length;)u=f,h=n.readInt32BE(u),c=(u+=this.intLength)+h,r=n.toString("utf8",u,c),u=c,a=n.readInt32BE(u),u+=this.intLength,s=o.slice(l,l+a),l+=a,this.layerMap.set(r,s),this._readLayer(r,s),f=u}},{key:"_bufferToDoubleArray",value:function(t,e){for(var i,n,r=[],a=0,s=[],o=0,h=0,l=!0,u=0;u<t.length;u++)0==(0|t[u]>>7&1)&&(a>0&&a<=5?(l?(i=this._varintToInt(r)+o,s.push(i/e),l=!1,o=i):(n=this._varintToInt(r)+h,s.push(n/e),l=!0,h=n),a=0,r=[]):a>5&&(o=-99999,h=-99999,a=0,r=[])),r.push(t[u]),a++;return s}},{key:"_varintToIntArray",value:function(t){for(var e=[],i=0,n=[],r=0;r<t.length;r++)0==(0|t[r]>>7&1)&&i>0&&i<=5&&(n.push(this._varintToInt(e)),e=[],i=0),e.push(t[r]),i++;return n.push(this._varintToInt(e)),n}},{key:"_varintToInt",value:function(t){for(var e=[],i=[],n=3,r=0,a=t.length-1;a>=0&&(i[0]=a-1>=0?t[a-1]<<7-r:0,-1!=n);a--)e[n]=(127&t[a])>>r|i[0],n--,r++;var s=e[0]<<24&4278190080|e[1]<<16&16711680|e[2]<<8&65280|255&e[3];return s=s>>1^-(1&s)}},{key:"_intToVarint",value:function(t){if(0==t)return[0];t=this._zigZagEncoding(t);for(var e,i=[],n=0,r=5;r>0;r--)e=t>>7*(r-1)&127,0!=n&&(e|=128),0!=e&&i.push(e),n=e;return i}},{key:"_zigZagEncoding",value:function(t){return t>>31^t<<1}}])&&l(i.prototype,n),o&&l(i,o),e}();e.a=u}).call(this,i(26).Buffer)},function(t,e,i){i(38),t.exports=i(50)},function(t,e,i){"use strict";i.r(e),function(t){var n=i(25);i.d(e,"CRS",function(){return n.a}),i.d(e,"crs",function(){return n.b});var r=i(32);i.d(e,"CustomEPSG4326",function(){return r.a});var a=i(4);i.d(e,"WMTSLayer",function(){return a.q}),i.d(e,"ImageMapLayer",function(){return a.m}),i.d(e,"SingleImageLayer",function(){return a.o}),i.d(e,"DataSource",function(){return a.a}),i.d(e,"URLDataSource",function(){return a.p}),i.d(e,"LocalDataSource",function(){return a.n}),i.d(e,"GLabelGrid",function(){return a.e}),i.d(e,"GWVTAnno",function(){return a.k}),i.d(e,"Feature",function(){return a.b}),i.d(e,"GStyleItem",function(){return a.h}),i.d(e,"GDynamicMap",function(){return a.c}),i.d(e,"GVMapGrid",function(){return a.i}),i.d(e,"GXYZ",function(){return a.l}),i.d(e,"GServiceGroup",function(){return a.g}),i.d(e,"GVMapGridUtil",function(){return a.j}),i.d(e,"GGroup",function(){return a.d}),i.d(e,"GLevels",function(){return a.f});var s=i(29),o=i(21);i.d(e,"FeatureManager",function(){return o.a}),i.d(e,"TipPopup",function(){return o.c}),i.d(e,"Geolocation",function(){return o.b});var h=i(9);i.d(e,"DrawPolyline",function(){return h.e}),i.d(e,"DrawPolygon",function(){return h.d}),i.d(e,"DrawRectangle",function(){return h.f}),i.d(e,"DrawCircle",function(){return h.a}),i.d(e,"DrawMarker",function(){return h.c}),i.d(e,"DrawEdit",function(){return h.b}),i.d(e,"MeasurePath",function(){return h.i}),i.d(e,"MeasureArea",function(){return h.h}),i.d(e,"ZoomBox",function(){return h.k}),i.d(e,"History",function(){return h.g}),i.d(e,"MousePosition",function(){return h.j});var l=i(13);i.d(e,"WMTSCapabilities",function(){return l.d}),i.d(e,"WMSCapabilities",function(){return l.c}),i.d(e,"TRouteResultFormat",function(){return l.b}),i.d(e,"TRouteResult",function(){return l.a});var u=i(11);i.d(e,"PoiService",function(){return u.c}),i.d(e,"TPoiService",function(){return u.f}),i.d(e,"RouteService",function(){return u.d}),i.d(e,"TRouteService",function(){return u.g}),i.d(e,"GeocoderService",function(){return u.b}),i.d(e,"TGeocoderService",function(){return u.e}),i.d(e,"FeatureService",function(){return u.a});var c=window||t;c.Custom=c.Custom||{},c.Custom.DataSource=a.a,c.Custom.URLDataSource=a.p,c.Custom.LocalDataSource=a.n,c.Custom.Feature=a.b,c.Custom.GGroup=a.d,c.Custom.GLevels=a.f,c.Custom.GStyleItem=a.h,c.Custom.GServiceGroup=a.g,c.Custom.GVMapGridUtil=a.j,c.Custom.Filter=s.a,c.Custom.FilterLayer=s.b}.call(this,i(18))},function(t,e,i){(function(n,r){var a,s,o;function h(t){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}o=function(){"use strict";function t(t){var e=this.constructor;return this.then(function(i){return e.resolve(t()).then(function(){return i})},function(i){return e.resolve(t()).then(function(){return e.reject(i)})})}function e(t){return new this(function(e,i){if(!t||void 0===t.length)return i(new TypeError(h(t)+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var n=Array.prototype.slice.call(t);if(0===n.length)return e([]);var r=n.length;function a(t,i){if(i&&("object"===h(i)||"function"==typeof i)){var s=i.then;if("function"==typeof s)return void s.call(i,function(e){a(t,e)},function(i){n[t]={status:"rejected",reason:i},0==--r&&e(n)})}n[t]={status:"fulfilled",value:i},0==--r&&e(n)}for(var s=0;s<n.length;s++)a(s,n[s])})}var i=setTimeout;function a(t){return Boolean(t&&void 0!==t.length)}function s(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],p(t,this)}function l(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn(function(){var i=1===t._state?e.onFulfilled:e.onRejected;if(null!==i){var n;try{n=i(t._value)}catch(t){return void c(e.promise,t)}u(e.promise,n)}else(1===t._state?u:c)(e.promise,t._value)})):t._deferreds.push(e)}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===h(e)||"function"==typeof e)){var i=e.then;if(e instanceof o)return t._state=3,t._value=e,void f(t);if("function"==typeof i)return void p((n=i,r=e,function(){n.apply(r,arguments)}),t)}t._state=1,t._value=e,f(t)}catch(e){c(t,e)}var n,r}function c(t,e){t._state=2,t._value=e,f(t)}function f(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)l(t,t._deferreds[e]);t._deferreds=null}function p(t,e){var i=!1;try{t(function(t){i||(i=!0,u(e,t))},function(t){i||(i=!0,c(e,t))})}catch(t){if(i)return;i=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var i=new this.constructor(s);return l(this,new function(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}(t,e,i)),i},o.prototype.finally=t,o.all=function(t){return new o(function(e,i){if(!a(t))return i(new TypeError("Promise.all accepts an array"));var n=Array.prototype.slice.call(t);if(0===n.length)return e([]);var r=n.length;function s(t,a){try{if(a&&("object"===h(a)||"function"==typeof a)){var o=a.then;if("function"==typeof o)return void o.call(a,function(e){s(t,e)},i)}n[t]=a,0==--r&&e(n)}catch(t){i(t)}}for(var o=0;o<n.length;o++)s(o,n[o])})},o.allSettled=e,o.resolve=function(t){return t&&"object"===h(t)&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,i){i(t)})},o.race=function(t){return new o(function(e,i){if(!a(t))return i(new TypeError("Promise.race accepts an array"));for(var n=0,r=t.length;n<r;n++)o.resolve(t[n]).then(e,i)})},o._immediateFn="function"==typeof n&&function(t){n(t)}||function(t){i(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var d=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();"function"!=typeof d.Promise?d.Promise=o:d.Promise.prototype.finally?d.Promise.allSettled||(d.Promise.allSettled=e):d.Promise.prototype.finally=t},"object"===h(e)&&void 0!==t?o():void 0===(s="function"==typeof(a=o)?a.call(e,i,e,t):a)||(t.exports=s)}).call(this,i(40).setImmediate,i(18))},function(t,e,i){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function a(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new a(r.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new a(r.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(41),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(18))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,r,a,s,o,h=1,l={},u=!1,c=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick(function(){d(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?t.MessageChannel?((a=new MessageChannel).port1.onmessage=function(t){d(t.data)},n=function(t){a.port2.postMessage(t)}):c&&"onreadystatechange"in c.createElement("script")?(r=c.documentElement,n=function(t){var e=c.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):n=function(t){setTimeout(d,0,t)}:(s="setImmediate$"+Math.random()+"$",o=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&d(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",o,!1):t.attachEvent("onmessage",o),n=function(e){t.postMessage(s+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var r={callback:t,args:e};return l[h]=r,n(h),h++},f.clearImmediate=p}function p(t){delete l[t]}function d(t){if(u)setTimeout(d,0,t);else{var e=l[t];if(e){u=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{p(t),u=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(18),i(31))},function(t,e,i){!function(e){"use strict";if(e.__disableNativeFetch||!e.fetch){o.prototype.append=function(t,e){t=a(t),e=s(e);var i=this.map[t];i||(i=[],this.map[t]=i),i.push(e)},o.prototype.delete=function(t){delete this.map[a(t)]},o.prototype.get=function(t){var e=this.map[a(t)];return e?e[0]:null},o.prototype.getAll=function(t){return this.map[a(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},o.prototype.set=function(t,e){this.map[a(t)]=[s(e)]},o.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(i){this.map[i].forEach(function(n){t.call(e,n,i,this)},this)},this)};var i={blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e},n=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this)},c.call(f.prototype),c.call(d.prototype),d.prototype.clone=function(){return new d(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},d.error=function(){var t=new d(null,{status:0,statusText:""});return t.type="error",t};var r=[301,302,303,307,308];d.redirect=function(t,e){if(-1===r.indexOf(e))throw new RangeError("Invalid status code");return new d(null,{status:e,headers:{location:t}})},e.Headers=o,e.Request=f,e.Response=d,e.fetch=function(t,e){return new Promise(function(n,r){var a;a=f.prototype.isPrototypeOf(t)&&!e?t:new f(t,e);var s=new XMLHttpRequest;var h=!1;function l(){if(4===s.readyState){var t=1223===s.status?204:s.status;if(t<100||t>599){if(h)return;return h=!0,void r(new TypeError("Network request failed"))}var e={status:t,statusText:s.statusText,headers:function(t){var e=new o;return t.getAllResponseHeaders().trim().split("\n").forEach(function(t){var i=t.trim().split(":"),n=i.shift().trim(),r=i.join(":").trim();e.append(n,r)}),e}(s),url:"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0},i="response"in s?s.response:s.responseText;h||(h=!0,n(new d(i,e)))}}s.onreadystatechange=l,s.onload=l,s.onerror=function(){h||(h=!0,r(new TypeError("Network request failed")))},s.open(a.method,a.url,!0);try{"include"===a.credentials&&("withCredentials"in s?s.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(t){console&&console.warn&&console.warn("set withCredentials error:"+t)}"responseType"in s&&i.blob&&(s.responseType="blob"),a.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.send(void 0===a._bodyInit?null:a._bodyInit)})},e.fetch.polyfill=!0,t.exports&&(t.exports=e.fetch)}function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function s(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function h(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function l(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function u(t){var e=new FileReader;return e.readAsArrayBuffer(t),l(e)}function c(){return this.bodyUsed=!1,this._initBody=function(t,e){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(i.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t,this._options=e;else if(i.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(t){if(!i.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText=""},i.blob?(this.blob=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(u)},this.text=function(){var t,e,i,n,r,a,s,o=h(this);if(o)return o;if(this._bodyBlob)return t=this._bodyBlob,e=this._options,i=new FileReader,n=e.headers.map["content-type"]?e.headers.map["content-type"].toString():"",r=/charset\=[0-9a-zA-Z\-\_]*;?/,a=t.type.match(r)||n.match(r),s=[t],a&&s.push(a[0].replace(/^charset\=/,"").replace(/;$/,"")),i.readAsText.apply(i,s),l(i);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=h(this);return t||Promise.resolve(this._bodyText)},i.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t,e){var i,r,a=(e=e||{}).body;if(f.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,a||(a=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new o(e.headers)),this.method=(i=e.method||this.method||"GET",r=i.toUpperCase(),n.indexOf(r)>-1?r:i),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&a)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(a,e)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(r))}}),e}function d(t,e){e||(e={}),this._initBody(t,e),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof o?e.headers:new o(e.headers),this.url=e.url||""}}("undefined"!=typeof self?self:this)},function(t,e,i){"use strict";function n(t,e,i){t.setRequestHeader(e,i)}function r(){}i.r(e),i.d(e,"get",function(){return h}),i.d(e,"post",function(){return l}),i.d(e,"patch",function(){return u}),i.d(e,"json",function(){return c});var a=!1,s=!1;function o(t,e,i,o,h){var l,u={success:r,error:r};if(!a){var c=navigator.appVersion.split(";");if(c[1]){var f=c[1].replace(/[ ]/g,"");s="MSIE9.0"==f}a=!0}l=s?new window.XDomainRequest:window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),h&&(l.responseType="arraybuffer");var p="POST"===e||"PATCH"===e||"DELETE"===e;l.open(e,t,!0),s||(i?(n(l,"Content-Type","application/json"),n(l,"Accept","application/json")):h||n(l,"Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),p&&i&&(o=JSON.stringify(o)),l.onreadystatechange=function(){4===l.readyState&&(l.status>=200&&l.status<300?h?u.success.call(l,l.response,l):u.success.call(l,l.responseText,l):u.error.call(l,l.responseText,l))},l.onerror=function(){h?u.error.call(l,l.statusText,l):u.error.call(l,l.responseText,l)},l.onload=function(){h?u.success.call(l,l.response,l):u.success.call(l,l.responseText,l)},p?l.send(o):l.send();var d={success:function(t){return u.success=t,d},error:function(t){return u.error=t,d},request:l};return d}var h=function(t,e){return o(t,"GET",!1,null,e)},l=function(t,e){return o(t,"POST",!1,e)},u=function(t,e){return o(t,"PATCH",!1,e)},c={get:function(t){return o(t,"GET",!0,null)},post:function(t,e){return o(t,"POST",!0,e)},patch:function(t,e){return o(t,"PATCH",!0,e)}}},function(t,e,i){"use strict";e.byteLength=function(t){var e=l(t),i=e[0],n=e[1];return 3*(i+n)/4-n},e.toByteArray=function(t){var e,i,n=l(t),s=n[0],o=n[1],h=new a(function(t,e,i){return 3*(e+i)/4-i}(0,s,o)),u=0,c=o>0?s-4:s;for(i=0;i<c;i+=4)e=r[t.charCodeAt(i)]<<18|r[t.charCodeAt(i+1)]<<12|r[t.charCodeAt(i+2)]<<6|r[t.charCodeAt(i+3)],h[u++]=e>>16&255,h[u++]=e>>8&255,h[u++]=255&e;2===o&&(e=r[t.charCodeAt(i)]<<2|r[t.charCodeAt(i+1)]>>4,h[u++]=255&e);1===o&&(e=r[t.charCodeAt(i)]<<10|r[t.charCodeAt(i+1)]<<4|r[t.charCodeAt(i+2)]>>2,h[u++]=e>>8&255,h[u++]=255&e);return h},e.fromByteArray=function(t){for(var e,i=t.length,r=i%3,a=[],s=0,o=i-r;s<o;s+=16383)a.push(u(t,s,s+16383>o?o:s+16383));1===r?(e=t[i-1],a.push(n[e>>2]+n[e<<4&63]+"==")):2===r&&(e=(t[i-2]<<8)+t[i-1],a.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return a.join("")};for(var n=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=s.length;o<h;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function u(t,e,i){for(var r,a,s=[],o=e;o<i;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),s.push(n[(a=r)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,i,n,r){var a,s,o=8*r-n-1,h=(1<<o)-1,l=h>>1,u=-7,c=i?r-1:0,f=i?-1:1,p=t[e+c];for(c+=f,a=p&(1<<-u)-1,p>>=-u,u+=o;u>0;a=256*a+t[e+c],c+=f,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=n;u>0;s=256*s+t[e+c],c+=f,u-=8);if(0===a)a=1-l;else{if(a===h)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),a-=l}return(p?-1:1)*s*Math.pow(2,a-n)},e.write=function(t,e,i,n,r,a){var s,o,h,l=8*a-r-1,u=(1<<l)-1,c=u>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:a-1,d=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-s))<1&&(s--,h*=2),(e+=s+c>=1?f/h:f*Math.pow(2,1-c))*h>=2&&(s++,h/=2),s+c>=u?(o=0,s=u):s+c>=1?(o=(e*h-1)*Math.pow(2,r),s+=c):(o=e*Math.pow(2,c-1)*Math.pow(2,r),s=0));r>=8;t[i+p]=255&o,p+=d,o/=256,r-=8);for(s=s<<r|o,l+=r;l>0;t[i+p]=255&s,p+=d,s/=256,l-=8);t[i+p-d]|=128*g}},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){"use strict";var n=[0,255,65535,16777215,4294967295];function r(t,e,i,n,r){var a;for(a=0;a<r;a++)i[n+a]=t[e+a]}function a(t,e,i,n){var r;for(r=0;r<n;r++)t[e+r]=t[e-i+r]}function s(t){this.array=t,this.pos=0}s.prototype.readUncompressedLength=function(){for(var t,e,i=0,n=0;n<32&&this.pos<this.array.length;){if(t=this.array[this.pos],this.pos+=1,(e=127&t)<<n>>>n!==e)return-1;if(i|=e<<n,t<128)return i;n+=7}return-1},s.prototype.uncompressToBuffer=function(t){for(var e,i,s,o,h=this.array,l=h.length,u=this.pos,c=0;u<h.length;)if(e=h[u],u+=1,0==(3&e)){if((i=1+(e>>>2))>60){if(u+3>=l)return!1;s=i-60,i=1+((i=h[u]+(h[u+1]<<8)+(h[u+2]<<16)+(h[u+3]<<24))&n[s]),u+=s}if(u+i>l)return!1;r(h,u,t,c,i),u+=i,c+=i}else{switch(3&e){case 1:i=4+(e>>>2&7),o=h[u]+(e>>>5<<8),u+=1;break;case 2:if(u+1>=l)return!1;i=1+(e>>>2),o=h[u]+(h[u+1]<<8),u+=2;break;case 3:if(u+3>=l)return!1;i=1+(e>>>2),o=h[u]+(h[u+1]<<8)+(h[u+2]<<16)+(h[u+3]<<24),u+=4}if(0===o||o>c)return!1;a(t,c,o,i),c+=i}return!0},e.SnappyDecompressor=s},function(t,e,i){"use strict";var n=14,r=new Array(n+1);function a(t,e){return 506832829*t>>>e}function s(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)}function o(t,e,i){return t[e]===t[i]&&t[e+1]===t[i+1]&&t[e+2]===t[i+2]&&t[e+3]===t[i+3]}function h(t,e,i,n,r){return i<=60?(n[r]=i-1<<2,r+=1):i<256?(n[r]=240,n[r+1]=i-1,r+=2):(n[r]=244,n[r+1]=i-1&255,n[r+2]=i-1>>>8,r+=3),function(t,e,i,n,r){var a;for(a=0;a<r;a++)i[n+a]=t[e+a]}(t,e,n,r,i),r+i}function l(t,e,i,n){return n<12&&i<2048?(t[e]=1+(n-4<<2)+(i>>>8<<5),t[e+1]=255&i,e+2):(t[e]=2+(n-1<<2),t[e+1]=255&i,t[e+2]=i>>>8,e+3)}function u(t,e,i,n){for(;n>=68;)e=l(t,e,i,64),n-=64;return n>64&&(e=l(t,e,i,60),n-=60),l(t,e,i,n)}function c(t,e,i,l,c){for(var f=1;1<<f<=i&&f<=n;)f+=1;var p=32-(f-=1);void 0===r[f]&&(r[f]=new Uint16Array(1<<f));var d,g=r[f];for(d=0;d<g.length;d++)g[d]=0;var y,v,m,_,w,b,x,M,L,k,S=e+i,C=e,T=e,P=!0;if(i>=15)for(y=S-15,m=a(s(t,e+=1),p);P;){b=32,_=e;do{if(v=m,x=b>>>5,b+=1,_=(e=_)+x,e>y){P=!1;break}m=a(s(t,_),p),w=C+g[v],g[v]=e-C}while(!o(t,e,w));if(!P)break;c=h(t,T,e-T,l,c);do{for(M=e,L=4;e+L<S&&t[e+L]===t[w+L];)L+=1;if(e+=L,c=u(l,c,M-w,L),T=e,e>=y){P=!1;break}g[a(s(t,e-1),p)]=e-1-C,w=C+g[k=a(s(t,e),p)],g[k]=e-C}while(o(t,e,w));if(!P)break;m=a(s(t,e+=1),p)}return T<S&&(c=h(t,T,S-T,l,c)),c}function f(t){this.array=t}f.prototype.maxCompressedLength=function(){var t=this.array.length;return 32+t+Math.floor(t/6)},f.prototype.compressToBuffer=function(t){var e,i=this.array,n=i.length,r=0,a=0;for(a=function(t,e,i){do{e[i]=127&t,(t>>>=7)>0&&(e[i]+=128),i+=1}while(t>0);return i}(n,t,a);r<n;)a=c(i,r,e=Math.min(n-r,65536),t,a),r+=e;return a},e.SnappyCompressor=f},function(t,e,i){var n;function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}void 0===(n=function(){return t=function(t,e){return t.substring(0,e.length)===e},e=function(t,e){return t.substring(t.length-e.length)===e},(i=function(t){return t instanceof i?t:this instanceof i?void(this._wrapped=t):new i(t)}).delimiter=" ",i.isArray=function(t){return!(!t||t.constructor!==Array)},i.trim=function(i,n){for(n=n||" ";t(i,n);)i=i.substring(1);for(;e(i,n);)i=i.substring(0,i.length-1);return i},i.Wkt=function(t){this.delimiter=i.delimiter||" ",this.wrapVertices=!0,this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+|\+/,numeric:/-*\d+(\.*\d+)?/,comma:/\s*,\s*/,parenComma:/\)\s*,\s*\(/,coord:/-*\d+\.*\d+ -*\d+\.*\d+/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,ogcTypes:/^(multi)?(point|line|polygon|box)?(string)?$/i,crudeJson:/^{.*"(type|coordinates|geometries|features)":.*}$/},this._stripWhitespaceAndParens=function(t){return t.trim().replace(/^\(?(.*?)\)?$/,"$1")},this.components=void 0,t&&"string"==typeof t?this.read(t):t&&void 0!==r(t)&&this.fromObject(t)},i.Wkt.prototype.isCollection=function(){switch(this.type.slice(0,5)){case"multi":case"polyg":return!0;default:return!1}},i.Wkt.prototype.sameCoords=function(t,e){return t.x===e.x&&t.y===e.y},i.Wkt.prototype.fromObject=function(t){var e;return e=t.hasOwnProperty("type")&&t.hasOwnProperty("coordinates")?this.fromJson(t):this.deconstruct.call(this,t),this.components=e.components,this.isRectangle=e.isRectangle||!1,this.type=e.type,this},i.Wkt.prototype.toObject=function(t){var e=this.construct[this.type].call(this,t);return"object"!==r(e)||i.isArray(e)||(e.properties=this.properties),e},i.Wkt.prototype.toString=function(t){return this.write()},i.Wkt.prototype.fromJson=function(t){var e,n,r,a,s,o;if(this.type=t.type.toLowerCase(),this.components=[],t.hasOwnProperty("geometry"))return this.fromJson(t.geometry),this.properties=t.properties,this;if(a=t.coordinates,i.isArray(a[0])){for(e in a)if(a.hasOwnProperty(e))if(i.isArray(a[e][0])){for(n in o=[],a[e])if(a[e].hasOwnProperty(n))if(i.isArray(a[e][n][0])){for(r in s=[],a[e][n])a[e][n].hasOwnProperty(r)&&s.push({x:a[e][n][r][0],y:a[e][n][r][1]});o.push(s)}else o.push({x:a[e][n][0],y:a[e][n][1]});this.components.push(o)}else"multipoint"===this.type?this.components.push([{x:a[e][0],y:a[e][1]}]):this.components.push({x:a[e][0],y:a[e][1]})}else this.components.push({x:a[0],y:a[1]});return this},i.Wkt.prototype.toJson=function(){var t,e,n,r,a,s,o;if(t=this.components,e={coordinates:[],type:function(){var t,e,i;for(t in i=[],e=this.regExes.ogcTypes.exec(this.type).slice(1))e.hasOwnProperty(t)&&void 0!==e[t]&&i.push(e[t].toLowerCase().slice(0,1).toUpperCase()+e[t].toLowerCase().slice(1));return i}.call(this).join("")},"box"===this.type.toLowerCase()){for(n in e.type="Polygon",e.bbox=[],t)t.hasOwnProperty(n)&&(e.bbox=e.bbox.concat([t[n].x,t[n].y]));return e.coordinates=[[[t[0].x,t[0].y],[t[0].x,t[1].y],[t[1].x,t[1].y],[t[1].x,t[0].y],[t[0].x,t[0].y]]],e}for(n in t)if(t.hasOwnProperty(n))if(i.isArray(t[n])){for(r in o=[],t[n])if(t[n].hasOwnProperty(r))if(i.isArray(t[n][r])){for(a in s=[],t[n][r])t[n][r].hasOwnProperty(a)&&s.push([t[n][r][a].x,t[n][r][a].y]);o.push(s)}else t[n].length>1?o.push([t[n][r].x,t[n][r].y]):o=o.concat([t[n][r].x,t[n][r].y]);e.coordinates.push(o)}else t.length>1?e.coordinates.push([t[n].x,t[n].y]):e.coordinates=e.coordinates.concat([t[n].x,t[n].y]);return e},i.Wkt.prototype.merge=function(t){var e=this.type.slice(0,5);if(this.type!==t.type&&this.type.slice(5,this.type.length)!==t.type)throw TypeError("The input geometry types must agree or the calling this.Wkt.Wkt instance must be a multigeometry of the other");switch(e){case"point":this.components=[this.components.concat(t.components)];break;case"multi":this.components=this.components.concat("multi"===t.type.slice(0,5)?t.components:[t.components]);break;default:this.components=[this.components,t.components]}return"multi"!==e&&(this.type="multi"+this.type),this},i.Wkt.prototype.read=function(t){var e;if(e=this.regExes.typeStr.exec(t))this.type=e[1].toLowerCase(),this.base=e[2],this.ingest[this.type]&&(this.components=this.ingest[this.type].apply(this,[this.base]));else{if(!this.regExes.crudeJson.test(t))throw console.log("Invalid WKT string provided to read()"),{name:"WKTError",message:"Invalid WKT string provided to read()"};if("object"!==("undefined"==typeof JSON?"undefined":r(JSON))||"function"!=typeof JSON.parse)throw console.log("JSON.parse() is not available; cannot parse GeoJSON strings"),{name:"JSONError",message:"JSON.parse() is not available; cannot parse GeoJSON strings"};this.fromJson(JSON.parse(t))}return this},i.Wkt.prototype.write=function(t){var e,i,n;for(t=t||this.components,(i=[]).push(this.type.toUpperCase()+"("),e=0;e<t.length;e+=1){if(this.isCollection()&&e>0&&i.push(","),!this.extract[this.type])return null;n=this.extract[this.type].apply(this,[t[e]]),this.isCollection()&&"multipoint"!==this.type?i.push("("+n+")"):(i.push(n),e!==t.length-1&&"multipoint"!==this.type&&i.push(","))}return i.push(")"),i.join("")},i.Wkt.prototype.extract={point:function(t){return String(t.x)+this.delimiter+String(t.y)},multipoint:function(t){var e,i,n=[];for(e=0;e<t.length;e+=1)i=this.extract.point.apply(this,[t[e]]),this.wrapVertices&&(i="("+i+")"),n.push(i);return n.join(",")},linestring:function(t){return this.extract.point.apply(this,[t])},multilinestring:function(t){var e,i=[];if(t.length)for(e=0;e<t.length;e+=1)i.push(this.extract.linestring.apply(this,[t[e]]));else i.push(this.extract.point.apply(this,[t]));return i.join(",")},polygon:function(t){return this.extract.multilinestring.apply(this,[t])},multipolygon:function(t){var e,i=[];for(e=0;e<t.length;e+=1)i.push("("+this.extract.polygon.apply(this,[t[e]])+")");return i.join(",")},box:function(t){return this.extract.linestring.apply(this,[t])},geometrycollection:function(t){console.log("The geometrycollection WKT type is not yet supported.")}},i.Wkt.prototype.ingest={point:function(t){var e=i.trim(t).split(this.regExes.spaces);return[{x:parseFloat(this.regExes.numeric.exec(e[0])[0]),y:parseFloat(this.regExes.numeric.exec(e[1])[0])}]},multipoint:function(t){var e,n,r;for(n=[],r=i.trim(t).split(this.regExes.comma),e=0;e<r.length;e+=1)n.push(this.ingest.point.apply(this,[r[e]]));return n},linestring:function(t){var e,i,n;for(i=this.ingest.multipoint.apply(this,[t]),n=[],e=0;e<i.length;e+=1)n=n.concat(i[e]);return n},multilinestring:function(t){var e,n,r,a;for(n=[],1===(a=i.trim(t).split(this.regExes.doubleParenComma)).length&&(a=i.trim(t).split(this.regExes.parenComma)),e=0;e<a.length;e+=1)r=this._stripWhitespaceAndParens(a[e]),n.push(this.ingest.linestring.apply(this,[r]));return n},polygon:function(t){var e,n,r,a,s,o;for(o=i.trim(t).split(this.regExes.parenComma),r=[],e=0;e<o.length;e+=1){for(s=this._stripWhitespaceAndParens(o[e]).split(this.regExes.comma),a=[],n=0;n<s.length;n+=1){var h=s[n].split(this.regExes.spaces);if(h.length>2&&(h=h.filter(function(t){return""!=t})),2===h.length){var l=h[0],u=h[1];a.push({x:parseFloat(l),y:parseFloat(u)})}}r.push(a)}return r},box:function(t){var e,i,n;for(i=this.ingest.multipoint.apply(this,[t]),n=[],e=0;e<i.length;e+=1)n=n.concat(i[e]);return n},multipolygon:function(t){var e,n,r,a;for(n=[],a=i.trim(t).split(this.regExes.doubleParenComma),e=0;e<a.length;e+=1)r=this._stripWhitespaceAndParens(a[e]),n.push(this.ingest.polygon.apply(this,[r]));return n},geometrycollection:function(t){console.log("The geometrycollection WKT type is not yet supported.")}},i;var t,e,i}.call(e,i,e,t))||(t.exports=n)},function(t,e,i){"use strict";i.r(e);i(51),i(53),i(57),i(58)},function(t,e){},,function(t,e){},,,,function(t,e){},function(t,e){}]);